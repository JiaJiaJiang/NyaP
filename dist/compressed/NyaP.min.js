!function e(t,n,i){function a(r,s){if(!n[r]){if(!t[r]){var u="function"==typeof require&&require;if(!s&&u)return u(r,!0);if(o)return o(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[r]={exports:{}};t[r][0].call(c.exports,function(e){var n=t[r][1][e];return a(n?n:e)},c,c.exports,e,t,n,i)}return n[r].exports}for(var o="function"==typeof require&&require,r=0;r<i.length;r++)a(i[r]);return a}({1:[function(e,t,n){"use strict";function i(e,t){var n=void 0,o=void 0,r=void 0;if("string"==typeof e)return document.createTextNode(e);if("_"in e!=!1&&"string"==typeof e._&&""!=e._){if(n=document.createElement(e._),"object"===a(e.attr))for(o in e.attr)n.setAttribute(o,e.attr[o]);if("object"===a(e.prop))for(o in e.prop)n[o]=e.prop[o];if("object"===a(e.event))for(o in e.event)n.addEventListener(o,e.event[o]);return"object"===a(e.child)&&e.child.length>0&&e.child.forEach(function(e){r=e instanceof Node?e:i(e,t),r instanceof Node&&n.appendChild(r)}),t&&t(n),n}}Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.default=i,n.Object2HTML=i},{}],2:[function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,a){"function"==typeof define&&define.amd?define(a):"object"===("undefined"==typeof n?"undefined":i(n))?t.exports=a():e.ResizeSensor=a()}(void 0,function(){function e(e,t){var n=Object.prototype.toString.call(e),i="[object Array]"===n||"[object NodeList]"===n||"[object HTMLCollection]"===n||"[object Object]"===n||"undefined"!=typeof jQuery&&e instanceof jQuery||"undefined"!=typeof Elements&&e instanceof Elements,a=0,o=e.length;if(i)for(;a<o;a++)t(e[a]);else t(e)}if("undefined"==typeof window)return null;var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,20)},n=function n(i,a){function o(){var e=[];this.add=function(t){e.push(t)};var t,n;this.call=function(){for(t=0,n=e.length;t<n;t++)e[t].call()},this.remove=function(i){var a=[];for(t=0,n=e.length;t<n;t++)e[t]!==i&&a.push(e[t]);e=a},this.length=function(){return e.length}}function r(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.style[t]}function s(e,n){if(e.resizedAttached)return void e.resizedAttached.add(n);e.resizedAttached=new o,e.resizedAttached.add(n),e.resizeSensor=document.createElement("div"),e.resizeSensor.className="resize-sensor";var i="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;",a="position: absolute; left: 0; top: 0; transition: 0s;";e.resizeSensor.style.cssText=i,e.resizeSensor.innerHTML='<div class="resize-sensor-expand" style="'+i+'"><div style="'+a+'"></div></div><div class="resize-sensor-shrink" style="'+i+'"><div style="'+a+' width: 200%; height: 200%"></div></div>',e.appendChild(e.resizeSensor),"static"==r(e,"position")&&(e.style.position="relative");var s,u,l,c,d=e.resizeSensor.childNodes[0],f=d.childNodes[0],h=e.resizeSensor.childNodes[1],m=e.offsetWidth,v=e.offsetHeight,p=function(){f.style.width="100000px",f.style.height="100000px",d.scrollLeft=1e5,d.scrollTop=1e5,h.scrollLeft=1e5,h.scrollTop=1e5};p();var y=function(){u=0,s&&(m=l,v=c,e.resizedAttached&&e.resizedAttached.call())},k=function(){l=e.offsetWidth,c=e.offsetHeight,s=l!=m||c!=v,s&&!u&&(u=t(y)),p()},g=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)};g(d,"scroll",k),g(h,"scroll",k)}e(i,function(e){s(e,a)}),this.detach=function(e){n.detach(i,e)}};return n.detach=function(t,n){e(t,function(e){e.resizedAttached&&"function"==typeof n&&(e.resizedAttached.remove(n),e.resizedAttached.length())||e.resizeSensor&&(e.contains(e.resizeSensor)&&e.removeChild(e.resizeSensor),delete e.resizeSensor,delete e.resizedAttached)})},n})},{}],3:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=function(n){n.split(/\,/g).forEach(function(i){return e.addEventListener(i,t[n])})};for(var i in t)n(i)}Object.defineProperty(n,"__esModule",{value:!0}),n.ResizeSensor=n.DanmakuFrameModule=n.DanmakuFrame=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=e("../lib/ResizeSensor.js"),u=i(s),l=function(){function e(t){var n=this;a(this,e),this.container=t||document.createElement("div"),this.container.id="danmaku_container",this.rate=1,this.timeBase=0,this.media=null,this.fps=0,this.working=!1,this.modules={},this.moduleList=[];for(var i in e.moduleList)this.initModule(i);setTimeout(function(){n.container.ResizeSensor=new u.default(n.container,function(){n.resize()}),n.resize()},0);var o=function e(){n.moduleFunction("draw"),0===n.fps?requestAnimationFrame(e):setTimeout(e,1e3/n.fps)};o()}return r(e,[{key:"enable",value:function(e){var t=this.modules[e];return t?(t.enabled=!0,t.enable&&t.enable(),!0):this.initModule(e)}},{key:"disable",value:function(e){var t=this.modules[e];return!!t&&(t.enabled=!1,t.disable&&t.disable(),!0)}},{key:"initModule",value:function(t){var n=e.moduleList[t];if(!n)throw"Module ["+t+"] does not exist.";var i=new n(this);if(i instanceof c==!1)throw"Constructor of "+t+" is not extended from DanmakuFrameModule";return i.enabled=!0,this.modules[t]=i,this.moduleList.push(t),console.debug("Mod Inited: "+t),!0}},{key:"load",value:function(e){this.moduleFunction("load")}},{key:"loadList",value:function(e){this.moduleFunction("loadList",e)}},{key:"unload",value:function(e){this.moduleFunction("unload",e)}},{key:"start",value:function(){this.working||(this.working=!0,this.moduleFunction("start"))}},{key:"pause",value:function(){this.working=!1,this.moduleFunction("pause")}},{key:"resize",value:function(){this.moduleFunction("resize")}},{key:"moduleFunction",value:function(e,t){for(var n,i=0;i<this.moduleList.length;i++)n=this.modules[this.moduleList[i]],n[e]&&n[e](t)}},{key:"setMedia",value:function(e){var t=this;this.media=e,o(e,{playing:function(){t.start()},pause:function(){t.pause()},ratechange:function(){t.rate=t.media.playbackRate}}),this.moduleFunction("media",e)}},{key:"time",set:function(e){this.media||(this.timeBase=Date.now()-e),this.moduleFunction("time",e)},get:function(){return this.media?1e3*this.media.currentTime|0:Date.now()-this.timeBase}}],[{key:"addModule",value:function(e,t){return e in this.moduleList?void console.warn('The module "'+e+'" has already been added.'):void(this.moduleList[e]=t)}}]),e}();l.moduleList={};var c=function e(t){a(this,e),this.frame=t,this.enabled=!1};n.DanmakuFrame=l,n.DanmakuFrameModule=c,n.ResizeSensor=u.default},{"../lib/ResizeSensor.js":2}],4:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){"function"==typeof define&&define.amd?define(e):"object"===("undefined"==typeof n?"undefined":o(n))?t.exports=e():(0,eval)("this").Mat=e()}(function(){function e(t){function o(e,n,i){var a=new t(e*n);return Object.setPrototypeOf(a,r),Object.defineProperty(a,"length",{value:e*n}),Object.defineProperty(a,"row",{value:e}),Object.defineProperty(a,"column",{value:n}),arguments.length>=3&&(r._instanceofTypedArray&&0===i||("number"==typeof i?a.fill(i):i.length&&a.set(i))),a}var r=function(){function e(){i(this,e)}return a(e,[{key:"length",get:function(){return this._len}}],[{key:"leftMultiply",value:function(e){return this.set(o.multiply(e,this,o(e.row,this.column)))}},{key:"rightMultiply",value:function(e){return this.set(o.multiply(this,e,o(this.row,e,column)))}},{key:"fill",value:function(e){arguments.length||(e=0);for(var t=this.length;t--;)this[t]=e;return this}},{key:"set",value:function(e,t){t||(t=0);for(var n=e.length+t<=this.length?e.length:this.length-t;n--;)this[t+n]=e[n];return this}},{key:"put",value:function(e,t,n){return o.put(this,e,t||0,n||0),this}},{key:"rotate2d",value:function(e){return this.set(o.rotate2d(this,e,o.Matrixes.T3))}},{key:"translate2d",value:function(e,t){return this.set(o.translate2d(this,e,t,o.Matrixes.T3))}},{key:"scale2d",value:function(e,t){return this.set(o.scale2d(this,e,t,o.Matrixes.T3))}},{key:"rotate3d",value:function(e,t,n){return this.set(o.rotate3d(this,e,t,n,o.Matrixes.T4))}},{key:"scale3d",value:function(e,t,n){return this.set(o.scale3d(this,e,t,n,o.Matrixes.T4))}},{key:"translate3d",value:function(e,t,n){return this.set(o.translate3d(this,e,t,n,o.Matrixes.T4))}},{key:"rotateX",value:function(e){return this.set(o.rotateX(this,e,o.Matrixes.T4))}},{key:"rotateY",value:function(e){return this.set(o.rotateY(this,e,o.Matrixes.T4))}},{key:"rotateZ",value:function(e){return this.set(o.rotateZ(this,e,o.Matrixes.T4))}},{key:"clone",value:function(){return o(this.row,this.column,this)}},{key:"toString",value:function(){if(0===this.length)return"";for(var e=0,t=[],n=[];e<this.length;e++)e&&e%this.column===0&&(t.push(n.join("\t")),n.length=0),n.push(this[e]||0);return t.push(n.join("\t")),t.join("\n")}}]),e}(),s=function(){function t(){i(this,t)}return a(t,null,[{key:"Identity",value:function(e){for(var t=o(e,e,0),n=e;n--;)t[n*e+n]=1;return t}},{key:"Perspective",value:function(e,t,n,i,a){var r=n*Math.tan(e*Math.PI/360),s=r*t,u=a||o(4,4,0);return u[0]=2*n/(s+s),u[5]=2*n/(r+r),u[10]=-(i+n)/(i-n),u[14]=-2*i*n/(i-n),u[11]=-1,a&&(u[1]=u[2]=u[3]=u[4]=u[6]=u[7]=u[8]=u[9]=u[12]=u[13]=u[15]=0),u}},{key:"multiply",value:function(e,t,n){if(e.column!==t.row)throw"wrong matrix";for(var i=e.row,a=Math.min(e.column,t.column),r=n||o(i,a),s=void 0,u=void 0,l=void 0,c=i;c--;)for(s=a;s--;)for(r[l=c*r.column+s]=0,u=e.column;u--;)r[l]+=e[c*e.column+u]*t[s+u*t.column];return r}},{key:"multiplyString",value:function(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.column!==t.row)throw"wrong matrix";var a,r,s,u,l=n||o(e.row,t.column);for(a=e.row;a--;)for(r=t.column;r--;)for(l[u=a*t.column+r]="",s=0;s<e.column;s++)(!i||0!=e[a*e.column+s]&&0!=t[r+s*t.column])&&(l[u]+=(s&&l[u]?"+":"")+"("+e[a*e.column+s]+")*("+t[r+s*t.column]+")");return l}},{key:"add",value:function(e,t,n){if(e.column!==t.column||e.row!==t.row)throw"wrong matrix";for(var i=n||o(e.row,t.column),a=e.length;a--;)i[a]=e[a]+t[a];return i}},{key:"minus",value:function(e,t,n){if(e.column!==t.column||e.row!==t.row)throw"wrong matrix";for(var i=n||o(e.row,t.column),a=e.length;a--;)i[a]=e[a]-t[a];return i}},{key:"rotate2d",value:function(e,t,n){var i=o.Matrixes.rotate2d;return i[0]=i[4]=Math.cos(t),i[1]=-(i[3]=Math.sin(t)),o.multiply(i,e,n||o(3,3))}},{key:"scale2d",value:function(e,t,n,i){var a=o.Matrixes.scale2d;return a[0]=t,a[4]=n,o.multiply(a,e,i||o(3,3))}},{key:"translate2d",value:function(e,t,n,i){var a=o.Matrixes.translate2d;return a[2]=t,a[5]=n,o.multiply(a,e,i||o(3,3))}},{key:"rotate3d",value:function(e,t,n,i,a){var r=Math.cos(t),s=Math.sin(t),u=Math.cos(n),l=Math.sin(n),c=Math.cos(i),d=Math.sin(i),f=o.Matrixes.rotate3d;return f[0]=c*u,f[1]=c*l*s-d*r,f[2]=c*l*r+d*s,f[4]=d*u,f[5]=d*l*s+c*r,f[6]=d*l*r-c*s,f[8]=-l,f[9]=u*s,f[10]=u*r,o.multiply(f,e,a||o(4,4))}},{key:"rotateX",value:function(e,t,n){var i=o.Matrixes.rotateX;return i[10]=i[5]=Math.cos(t),i[6]=-(i[9]=Math.sin(t)),o.multiply(i,e,n||o(4,4))}},{key:"rotateY",value:function(e,t,n){var i=o.Matrixes.rotateY;return i[10]=i[0]=Math.cos(t),i[8]=-(i[2]=Math.sin(t)),o.multiply(i,e,n||o(4,4))}},{key:"rotateZ",value:function(e,t,n){var i=o.Matrixes.rotateZ;return i[5]=i[0]=Math.cos(t),i[1]=-(i[4]=Math.sin(t)),o.multiply(i,e,n||o(4,4))}},{key:"scale3d",value:function(e,t,n,i,a){var r=o.Matrixes.scale3d;return r[0]=t,r[5]=n,r[10]=i,o.multiply(r,e,a||o(4,4))}},{key:"translate3d",value:function(e,t,n,i,a){var r=o.Matrixes.translate3d;return r[12]=t,r[13]=n,r[14]=i,o.multiply(r,e,a||o(4,4))}},{key:"put",value:function(e,t,n,i){var a=void 0;n||(n=0),i||(i=0);for(var o=t.row;o--;)if(!(o+n>=e.row))for(a=t.column;a--;)a+i>=e.column||(e[(o+n)*e.column+a+i]=t[o*t.column+a])}},{key:"createClass",value:function(t){return e(t)}}]),t}(),u=new t(1);return Object.defineProperty(r,"_instanceofTypedArray",{value:!(!n||!n.isPrototypeOf(u))}),u=null,Object.setPrototypeOf(r,t.prototype),Object.setPrototypeOf(o,s),o.Matrixes={I2:o.Identity(2),I3:o.Identity(3),I4:o.Identity(4),T3:o(3,3,0),T4:o(4,4,0),rotate2d:o.Identity(3),translate2d:o.Identity(3),scale2d:o.Identity(3),translate3d:o.Identity(4),rotate3d:o.Identity(4),rotateX:o.Identity(4),rotateY:o.Identity(4),rotateZ:o.Identity(4),scale3d:o.Identity(4)},o}var t=(0,eval)("this"),n=t.Float32Array&&t.Float32Array.prototype;return e(t.Float32Array?Float32Array:Array)})},{}],5:[function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function n(){}function a(e,t){return function(){e.apply(t,arguments)}}function o(e){if("object"!==i(this))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],d(e,this)}function r(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void o._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null===n)return void(1===e._state?s:u)(t.promise,e._value);var i;try{i=n(e._value)}catch(e){return void u(t.promise,e)}s(t.promise,i)}))}function s(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"===("undefined"==typeof t?"undefined":i(t))||"function"==typeof t)){var n=t.then;if(t instanceof o)return e._state=3,e._value=t,void l(e);if("function"==typeof n)return void d(a(n,t),e)}e._state=1,e._value=t,l(e)}catch(t){u(e,t)}}function u(e,t){e._state=2,e._value=t,l(e)}function l(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)r(e,e._deferreds[t]);e._deferreds=null}function c(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function d(e,t){var n=!1;try{e(function(e){n||(n=!0,s(t,e))},function(e){n||(n=!0,u(t,e))})}catch(e){if(n)return;n=!0,u(t,e)}}var f=setTimeout;o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,t){var i=new this.constructor(n);return r(this,new c(e,t,i)),i},o.all=function(e){var t=Array.prototype.slice.call(e);return new o(function(e,n){function a(r,s){try{if(s&&("object"===("undefined"==typeof s?"undefined":i(s))||"function"==typeof s)){var u=s.then;if("function"==typeof u)return void u.call(s,function(e){a(r,e)},n)}t[r]=s,0===--o&&e(t)}catch(e){n(e)}}if(0===t.length)return e([]);for(var o=t.length,r=0;r<t.length;r++)a(r,t[r])})},o.resolve=function(e){return e&&"object"===("undefined"==typeof e?"undefined":i(e))&&e.constructor===o?e:new o(function(t){t(e)})},o.reject=function(e){return new o(function(t,n){n(e)})},o.race=function(e){return new o(function(t,n){for(var i=0,a=e.length;i<a;i++)e[i].then(t,n)})},o._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){f(e,0)},o._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},o._setImmediateFn=function(e){o._immediateFn=e},o._setUnhandledRejectionFn=function(e){o._unhandledRejectionFn=e},"undefined"!=typeof t&&t.exports?t.exports=o:e.Promise||(e.Promise=o)}(void 0)},{}],6:[function(e,t,n){(function(e,t){"use strict";!function(t,n){function i(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return v[m]=i,h(m),m++}function a(e){delete v[e]}function o(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i)}}function r(e){if(p)setTimeout(r,0,e);else{var t=v[e];if(t){p=!0;try{o(t)}finally{a(e),p=!1}}}}function s(){h=function(t){e.nextTick(function(){r(t)})}}function u(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}function l(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&r(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),h=function(n){t.postMessage(e+n,"*")}}function c(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;r(t)},h=function(t){e.port2.postMessage(t)}}function d(){var e=y.documentElement;h=function(t){var n=y.createElement("script");n.onreadystatechange=function(){r(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}function f(){h=function(e){setTimeout(r,0,e)}}if(!t.setImmediate){var h,m=1,v={},p=!1,y=t.document,k=Object.getPrototypeOf&&Object.getPrototypeOf(t);k=k&&k.setTimeout?k:t,"[object process]"==={}.toString.call(t.process)?s():u()?l():t.MessageChannel?c():y&&"onreadystatechange"in y.createElement("script")?d():f(),k.setImmediate=i,k.clearImmediate=a}}("undefined"==typeof self?"undefined"==typeof t?void 0:t:self)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:10}],7:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){function n(e,t,n,i){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(0===e.length)return 0;for(var o=n,r=i;n<=i;)o=n+i>>1,t<=e[o].time?i=o-1:n=o+1;if(a)for(;n>0&&e[n-1].time===t;)n--;else for(;n<=r&&e[n].time===t;)n++;return n}var i=Object.defineProperty,s=window.requestIdleCallback||setImmediate,c=!1,d=function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.list=[],n.indexMark=0,n.tunnel=new m,n.paused=!0,n.defaultStyle={fontStyle:null,fontWeight:300,fontVariant:null,color:"#fff",lineHeight:null,fontSize:30,fontFamily:"Arial",strokeWidth:1.5,strokeColor:"#888",shadowBlur:5,textAlign:"start",shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0,fill:!0,reverse:!1,opacity:1},i(n,"renderMode",{configurable:!0}),i(n,"activeRenderMode",{configurable:!0,value:{}}),n.textDanmakuContainer=document.createElement("div"),n.textDanmakuContainer.classList.add("NyaP_fullfill"),n.canvas=document.createElement("canvas"),n.canvas.classList.add("NyaP_fullfill"),n.canvas.id="text2d",n.canvas3d=document.createElement("canvas"),n.canvas3d.classList.add("NyaP_fullfill"),n.canvas3d.id="text3d",n.canvas.hidden=n.canvas3d.hidden=!0,n.context2d=n.canvas.getContext("2d");try{n.context3d=n.canvas3d.getContext("webgl")}catch(e){console.warn("WebGL not supported")}return n.textDanmakuContainer.appendChild(n.canvas),n.textDanmakuContainer.appendChild(n.canvas3d),e.container.appendChild(n.textDanmakuContainer),n.text2d=new h.default(n),n.text3d=new v.default(n),n.GraphCache=[],n.DanmakuText=[],n.cacheCleanTime=0,n.danmakuMoveTime=0,n.danmakuCheckSwitch=!0,n.options={allowLines:!1,screenLimit:0,clearWhenTimeReset:!0,speed:6.5},document.addEventListener("visibilitychange",function(e){document.hidden?n.pause():(n.reCheckIndexMark(),n.frame.working?n.start():n.draw(!0))}),n._checkNewDanmaku=n._checkNewDanmaku.bind(n),n._cleanCache=n._cleanCache.bind(n),setInterval(n._cleanCache,5e3),n.setRenderMode(3),n}return r(t,e),l(t,[{key:"setRenderMode",value:function(e){if(this.renderMode!==e)if(this.clear(),2===e){if(!this.text2d.supported)return;this.canvas.hidden=!(this.canvas3d.hidden=!0),c=!0,i(this,"activeRenderMode",{value:this.text2d}),i(this,"renderMode",{value:e})}else if(3===e){if(!this.text3d.supported)return;this.canvas3d.hidden=!(this.canvas.hidden=!0),c=!1,i(this,"activeRenderMode",{value:this.text3d}),i(this,"renderMode",{value:e})}}},{key:"media",value:function(e){var t=this;u(e,{seeked:function(){t.start(),t.time(),t._clearCanvas()},seeking:function(){t.pause()},stalled:function(){t.pause()}})}},{key:"start",value:function(){this.paused=!1}},{key:"pause",value:function(){this.paused=!0}},{key:"load",value:function(e){if(!e||"text"!==e._)return!1;if("string"!=typeof e.text)return console.error("wrong danmaku object:",e),!1;var t=(e.time,void 0),i=this.list;return t=n(i,e.time,0,i.length-1,!1),i.splice(t,0,e),t<this.indexMark&&this.indexMark++,e.size=e.size+.5|0,NaN!==e.size&&e.size!==1/0||(e.size=this.defaultStyle.fontSize),e}},{key:"loadList",value:function(e){var t=this;e.forEach(function(e){return t.load(e)})}},{key:"unload",value:function(e){if(!e||"text"!==e._)return!1;var t=this.list.indexOf(e);return!(t<0)&&(this.list.splice(t,1),t<this.indexMark&&this.indexMark--,!0)}},{key:"_checkNewDanmaku",value:function(){var e=void 0,t=this.frame.time,n=document.hidden;if(this.list.length)for(;this.indexMark<this.list.length&&(e=this.list[this.indexMark])&&e.time<=t;this.indexMark++)this.options.screenLimit>0&&this.DanmakuText.length>=this.options.screenLimit||n||this._addNewDanmaku(e);this._calcDanmakuPosition()}},{key:"_addNewDanmaku",value:function(e){var t=this.canvas.height,n=this.canvas.width,i=void 0;i=this.GraphCache.length?this.GraphCache.shift():new f,i.danmaku=e,i.drawn=!1,i.text=this.options.allowLines?e.text:e.text.replace(/\n/g," "),i.time=e.time,Object.setPrototypeOf(i.font,this.defaultStyle),Object.assign(i.font,e.style),e.style.color&&i.font.color&&"#"!==i.font.color[0]&&(i.font.color="#"+e.style.color),e.mode>1&&(i.font.textAlign="center"),i.prepare();var a=this.tunnel.getTunnel(i,t),o=(a<0?0:a)%t;switch(e.mode){case 0:case 1:case 3:i.style.y=o;break;case 2:i.style.y=t-o-i.style.height-1}e.mode>1?i.style.x=(n-i.style.width)/2:i.style.x=n,this.DanmakuText.push(i),this.activeRenderMode.newDanmaku&&this.activeRenderMode.newDanmaku(i)}},{key:"_calcDanmakuPosition",value:function(){var e=this.frame,t=e.time;if(this.danmakuMoveTime!==t&&!this.paused){var n=this.canvas.width,i=void 0,a=void 0,o=void 0;for(this.danmakuMoveTime=t,a=this.DanmakuText.length;a--;)if(o=this.DanmakuText[a],o.time>t)this.removeText(o);else switch(o.danmaku.mode){case 0:case 1:if(i=!o.danmaku.mode,o.style.x=(i?n:-o.style.width)+(i?-1:1)*e.rate*(o.style.width+n)*(t-o.time)*this.options.speed/6e4,i&&o.style.x<-o.style.width||!i&&o.style.x>n+o.style.width){this.removeText(o);continue}o.tunnelNumber>=0&&(i&&o.style.x+o.style.width+10<n||!i&&o.style.x>10)&&this.tunnel.removeMark(o);break;case 2:case 3:t-o.time>1e3*this.options.speed/e.rate&&this.removeText(o)}}}},{key:"_cleanCache",value:function(){var e=Date.now();if(this.GraphCache.length>30)for(var t=0;t<this.GraphCache.length&&e-this.GraphCache[t].removeTime>1e4;t++)this.activeRenderMode.deleteTextObject&&this.activeRenderMode.deleteTextObject(this.GraphCache[t]),this.GraphCache.splice(t,1)}},{key:"draw",value:function(e){!this.enabled||!e&&this.paused||(this._clearCanvas(e),this.activeRenderMode.draw&&this.activeRenderMode.draw(e),s(this._checkNewDanmaku))}},{key:"removeText",value:function(e){var t=this.DanmakuText.indexOf(e);e._bitmap=null,t>=0&&this.DanmakuText.splice(t,1),this.tunnel.removeMark(e),e.danmaku=null,e.removeTime=Date.now(),this.GraphCache.push(e)}},{key:"resize",value:function(){var e=this.canvas.width=this.canvas3d.width=this.frame.container.offsetWidth,t=this.canvas.height=this.canvas3d.height=this.frame.container.offsetHeight;this.text2d.resize(e,t),this.text3d.resize(e,t),this.draw(!0)}},{key:"_evaluateIfFullClearMode",value:function(){if(3===this.renderMode)return!0;if(this.DanmakuText.length>3)return!0;var e=this.GraphCache[this.GraphCache.length-1];return!(!e||!e.drawn)&&(e.drawn=!1,!0)}},{key:"_clearCanvas",value:function(e){switch(this.renderMode){case 2:e||(e=this._evaluateIfFullClearMode()),this.text2d.clear(e);break;case 3:this.text3d.clear()}}},{key:"clear",value:function(){for(var e,t=this.DanmakuText.length;t--;)e=this.DanmakuText[t],e.danmaku&&this.removeText(e);this.tunnel.reset(),this._clearCanvas(!0)}},{key:"reCheckIndexMark",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.frame.time;this.indexMark=n(this.list,e,0,this.list.length-1,!0)}},{key:"time",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.frame.time;this.reCheckIndexMark(e),this.options.clearWhenTimeReset?this.clear():this.resetTimeOfDanmakuOnScreen()}},{key:"resetTimeOfDanmakuOnScreen",value:function(e){var t=this;void 0===e&&(e=this.frame.time),this.DanmakuText.forEach(function(n){n.danmaku&&(n.time=e-(t.danmakuMoveTime-n.time))})}},{key:"danmakuAt",value:function(e,t){var n=[];return this.enabled?(this.DanmakuText.forEach(function(i){i.danmaku&&i.style.x<=e&&i.style.x+i.style.width>=e&&i.style.y<=t&&i.style.y+i.style.height>=t&&n.push(i.danmaku)}),n):n}},{key:"enable",value:function(){this.textDanmakuContainer.hidden=!1}},{key:"disable",value:function(){this.textDanmakuContainer.hidden=!0,this.pause(),this.clear()}}]),t}(t),f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";a(this,e),this._fontString="",this._renderList=null,this.style={},this.font={},this.text=t,this._renderToCache=this._renderToCache.bind(this),i(this,"_cache",{configurable:!0})}return l(e,[{key:"prepare",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._cache||i(this,"_cache",{value:document.createElement("canvas")});var t=[];this.font.fontStyle&&t.push(this.font.fontStyle),this.font.fontVariant&&t.push(this.font.fontVariant),this.font.fontWeight&&t.push(this.font.fontWeight),t.push(this.font.fontSize+"px"),this.font.fontFamily&&t.push(this.font.fontFamily),this._fontString=t.join(" ");var n=this._cache,a=n.ctx2d||(n.ctx2d=n.getContext("2d"));a.font=this._fontString,this._renderList=this.text.split(/\n/g),this.estimatePadding=Math.max(this.font.shadowBlur+5+Math.max(Math.abs(this.font.shadowOffsetY),Math.abs(this.font.shadowOffsetX)),this.font.strokeWidth+3);for(var o=0,r=void 0,u="number"==typeof this.font.lineHeigh?this.font.lineHeigh:this.font.fontSize,l=this._renderList.length;l--;)r=a.measureText(this._renderList[l]).width,r>o&&(o=r);n.width=(this.style.width=o)+2*this.estimatePadding,n.height=(this.style.height=this._renderList.length*u)+(u<this.font.fontSize?2*this.font.fontSize:0)+2*this.estimatePadding,a.translate(this.estimatePadding,this.estimatePadding),e?s(this._renderToCache):this._renderToCache()}},{key:"_renderToCache",value:function(){var e=this;this.render(this._cache.ctx2d),c&&"function"==typeof createImageBitmap&&createImageBitmap(this._cache).then(function(t){e._bitmap&&e._bitmap.close(),e._bitmap=t})}},{key:"render",value:function(e){if(this._renderList){e.save(),e.font=this._fontString,e.textBaseline="top",e.lineWidth=this.font.strokeWidth,e.fillStyle=this.font.color,e.strokeStyle=this.font.strokeColor,e.shadowBlur=this.font.shadowBlur,e.shadowColor=this.font.shadowColor,e.shadowOffsetX=this.font.shadowOffsetX,e.shadowOffsetY=this.font.shadowOffsetY,e.textAlign=this.font.textAlign;var t="number"==typeof this.font.lineHeigh?this.font.lineHeigh:this.font.fontSize,n=void 0;switch(this.font.textAlign){case"left":case"start":n=0;break;case"center":n=this.style.width/2;break;case"right":case"end":n=this.style.width}for(var i=this._renderList.length;i--;)this.font.strokeWidth&&e.strokeText(this._renderList[i],n,t*i),this.font.fill&&e.fillText(this._renderList[i],n,t*i);e.restore()}}}]),e}(),m=function(){function e(){a(this,e),this.reset()}return l(e,[{key:"reset",value:function(){this.right={},this.left={},this.bottom={},this.top={}}},{key:"getTunnel",value:function(e,t){var n=this.tunnel(e.danmaku.mode),i=e.style.height,a=0,o=-1;if(("number"!=typeof i||i<0)&&(console.error("Incorrect size:"+i),i=1),i>t)return 0;for(;o<0;)for(var r=a+i-1;a<=r;){if(n[a]){a+=n[a].tunnelHeight;break}if(0!==a&&a%(t-1)===0){a++;break}if(a===r){o=a-i+1;break}a++}return e.tunnelNumber=o,e.tunnelHeight=e.style.y+i>t?1:i,this.addMark(e),o}},{key:"addMark",value:function(e){var t=this.tunnel(e.danmaku.mode);t[e.tunnelNumber]||(t[e.tunnelNumber]=e)}},{key:"removeMark",value:function(e){var t=void 0,n=e.tunnelNumber;n>=0&&(t=this.tunnel(e.danmaku.mode))[n]===e&&(delete t[n],e.tunnelNumber=-1)}},{key:"tunnel",value:function(e){return this[p[e]]}}]),e}(),p=["right","left","bottom","top"];e.addModule("TextDanmaku",d)}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=function(n){n.split(/\,/g).forEach(function(i){return e.addEventListener(i,t[n])})};for(var i in t)n(i)}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();e("../lib/setImmediate/setImmediate.js");var c=e("../lib/promise/promise.js"),d=i(c),f=e("./text2d.js"),h=i(f),m=e("./text3d.js"),v=i(m);window.Promise||(window.Promise=d.default),n.default=s},{"../lib/promise/promise.js":5,"../lib/setImmediate/setImmediate.js":6,"./text2d.js":8,"./text3d.js":9}],8:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){return i(this,e),this.supported=!1,this.dText=t,t.context2d?void(this.supported=!0):void console.warn("text 2d not supported")}return a(e,[{key:"draw",value:function(e){for(var t,n=this.dText.context2d,i=0,a=this.dText,o=a.DanmakuText.length;i<o;i++)t=a.DanmakuText[i],t.drawn||(t.drawn=!0),t.danmaku.highlight&&(n.fillStyle="rgba(255,255,255,0.3)",n.beginPath(),n.rect(t.style.x,t.style.y,t.style.width,t.style.height),n.fill()),n.drawImage(t._bitmap?t._bitmap:t._cache,t.style.x-t.estimatePadding,t.style.y-t.estimatePadding)}},{key:"clear",value:function(e){var t=this.dText.context2d;if(e)return void t.clearRect(0,0,this.dText.canvas.width,this.dText.canvas.height);for(var n,i=this.dText.DanmakuText.length;i--;)n=this.dText.DanmakuText[i],
n.drawn&&t.clearRect(n.style.x-n.estimatePadding,n.style.y-n.estimatePadding,n._cache.width,n._cache.height)}},{key:"resize",value:function(e,t){}}]),e}();n.default=o},{}],9:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("../lib/Mat/Mat.js"),s=i(r),u=function(){function e(t){function n(e){var t=i.createShader(o[e][0]);if(i.shaderSource(t,o[e][1]),i.compileShader(t),!i.getShaderParameter(t,i.COMPILE_STATUS))throw"An error occurred compiling the shaders: "+i.getShaderInfoLog(t);return t}if(a(this,e),this.dText=t,this.supported=!1,!t.context3d)return void console.warn("text 3d not supported");this.supported=!0;var i=this.gl=t.context3d,o=(t.canvas3d,{danmakuFrag:[i.FRAGMENT_SHADER,"\n\t\t\tvarying lowp vec2 vDanmakuTexCoord;\n\t\t\tuniform sampler2D uSampler;\n\n\t\t\tvoid main(void) {\n\t\t\t\tgl_FragColor = texture2D(uSampler, vec2(vDanmakuTexCoord.s, vDanmakuTexCoord.t));\n\t\t\t}"],danmakuVert:[i.VERTEX_SHADER,"\n\t\t\tattribute vec2 aVertexPosition;\n\t\t\tattribute vec2 aDanmakuTexCoord;\n\n\t\t\tuniform mat4 u2dCoordinate;\n\t\t\tuniform vec2 uDanmakuPos;\n\n\t\t\tvarying lowp vec2 vDanmakuTexCoord;\n\n\t\t\tvoid main(void) {\n\t\t\t\tgl_Position = u2dCoordinate * vec4(aVertexPosition+uDanmakuPos,0,1);\n\t\t\t\tvDanmakuTexCoord = aDanmakuTexCoord;\n\t\t\t}"]}),r=n("danmakuFrag"),s=n("danmakuVert"),u=this.shaderProgram=i.createProgram();i.attachShader(u,s),i.attachShader(u,r),i.linkProgram(u),i.getProgramParameter(u,i.LINK_STATUS)||console.error("Unable to initialize the shader program."),i.useProgram(u),i.clearColor(0,0,0,0),i.enable(i.BLEND),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA),this.maxTexSize=i.getParameter(i.MAX_TEXTURE_SIZE),console.info("MAX_TEXTURE_SIZE",this.maxTexSize),this.uSampler=i.getUniformLocation(u,"uSampler"),this.u2dCoord=i.getUniformLocation(u,"u2dCoordinate"),this.uDanmakuPos=i.getUniformLocation(u,"uDanmakuPos"),this.aVertexPosition=i.getAttribLocation(u,"aVertexPosition"),this.atextureCoord=i.getAttribLocation(u,"aDanmakuTexCoord"),i.enableVertexAttribArray(this.aVertexPosition),i.enableVertexAttribArray(this.atextureCoord),this.commonTexCoordBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.commonTexCoordBuffer),i.bufferData(i.ARRAY_BUFFER,l,i.STATIC_DRAW),i.vertexAttribPointer(this.atextureCoord,2,i.FLOAT,!1,0,0),i.vertexAttribPointer(this.aVertexPosition,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),i.uniform1i(this.uSampler,0)}return o(e,[{key:"draw",value:function(e){for(var t,n=this.gl,i=this.dText.DanmakuText.length,a=0;a<i;a++)t=this.dText.DanmakuText[a],t.glDanmaku&&(n.uniform2f(this.uDanmakuPos,t.style.x-t.estimatePadding,t.style.y-t.estimatePadding),n.bindBuffer(n.ARRAY_BUFFER,t.verticesBuffer),n.vertexAttribPointer(this.aVertexPosition,2,n.FLOAT,!1,0,0),n.bindTexture(n.TEXTURE_2D,t.texture),n.drawArrays(n.TRIANGLE_STRIP,0,4))}},{key:"clear",value:function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}},{key:"deleteTextObject",value:function(e){var t=this.gl;e.texture&&t.deleteTexture(e.texture),e.verticesBuffer&&t.deleteBuffer(e.verticesBuffer),e.textureCoordBuffer&&t.deleteBuffer(e.textureCoordBuffer)}},{key:"resize",value:function(e,t){if(this.supported){var n=this.gl,i=this.dText.canvas3d;n.viewport(0,0,i.width,i.height),n.uniformMatrix4fv(this.u2dCoord,!1,s.default.Identity(4).translate3d(-1,1,0).scale3d(2/i.width,-2/i.height,0))}}},{key:"newDanmaku",value:function(e){var t=this.gl;if(e._cache.height>this.maxTexSize||e._cache.width>this.maxTexSize)return e.glDanmaku=!1,void console.warn("Ignore a danmaku width too large size",e.danmaku);var n=e.texture||(e.texture=t.createTexture());e.glDanmaku=!0,t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e._cache),e.verticesBuffer||(e.verticesBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,e.verticesBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,e._cache.width,0,0,e._cache.height,e._cache.width,e._cache.height]),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null)}}]),e}(),l=new Float32Array([0,0,1,0,0,1,1,1]);n.default=u},{"../lib/Mat/Mat.js":4}],10:[function(e,t,n){function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(d===setTimeout)return setTimeout(e,0);if((d===i||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function r(e){if(f===clearTimeout)return clearTimeout(e);if((f===a||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function s(){p&&m&&(p=!1,m.length?v=m.concat(v):y=-1,v.length&&u())}function u(){if(!p){var e=o(s);p=!0;for(var t=v.length;t;){for(m=v,v=[];++y<t;)m&&m[y].run();y=-1,t=v.length}m=null,p=!1,r(e)}}function l(e,t){this.fun=e,this.array=t}function c(){}var d,f,h=t.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:i}catch(e){d=i}try{f="function"==typeof clearTimeout?clearTimeout:a}catch(e){f=a}}();var m,v=[],p=!1,y=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];v.push(new l(e,t)),1!==v.length||p||o(u)},l.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=c,h.addListener=c,h.once=c,h.off=c,h.removeListener=c,h.removeAllListeners=c,h.emit=c,h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],11:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("./i18n.js"),l=e("../lib/Object2HTML/Object2HTML.js"),c=i(l),d=e("./NyaPCore.js"),f=u.i18n._,h="0123456789abcdef",m={autoHideDanmakuInput:!0,danmakuColors:["fff","6cf","ff0","f00","0f0","00f","f0f","000"],danmakuModes:[0,3,2,1],defaultDanmakuColor:null,defaultDanmakuMode:0,danmakuSend:function(e,t){t(!1)},danmakuSizes:[25,30,45],defaultDanmakuSize:30},v=function(e){function t(e){function n(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=h[e];return(0,c.default)({_:"span",event:t,attr:n,prop:{id:"icon_span_"+e,innerHTML:"<svg height="+i[1]+" width="+i[0]+' id="icon_'+e+'"">'+i[2]+"</svg>"}})}function i(e){(0,d.toArray)(e.querySelectorAll("*")).forEach(function(e){e.id&&!u[e.id]&&(u[e.id]=e)})}a(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Object.assign({},m,e)));e=r.opt;var s=r,u=r.eles={};r._.playerMode="normal";var l=r.video,h={play:[30,30,'<path d="m10.063,8.856l9.873,6.143l-9.873,6.143v-12.287z" stroke-width="3" stroke-linejoin="round"/>'],addDanmaku:[30,30,'<path stroke-width="1.5" d="m20.514,20.120l0.551,-1.365l2.206,-0.341l-2.757,1.706h-13.787v-10.240h16.544v8.533" stroke-linejoin="round"/><path style="fill-opacity:1;stroke-width:0" d="m12.081,13.981h1.928v-1.985h1.978v1.985h1.928v2.036h-1.928v1.985h-1.978v-1.985h-1.928v-2.036z"/>'],danmakuStyle:[30,30,'<path style="fill-opacity:1!important" d="m21.781,9.872l-1.500,-1.530c-0.378,-0.385 -0.997,-0.391 -1.384,-0.012l-0.959,0.941l2.870,2.926l0.960,-0.940c0.385,-0.379 0.392,-0.998 0.013,-1.383zm-12.134,7.532l2.871,2.926l7.593,-7.448l-2.872,-2.927l-7.591,7.449l0.000,0.000zm-1.158,2.571l-0.549,1.974l1.984,-0.511l1.843,-0.474l-2.769,-2.824l-0.509,1.835z" stroke-width="0"/>'],fullPage:[30,30,'<path stroke-linejoin="round" d="m11.166,9.761l-5.237,5.239l5.237,5.238l1.905,-1.905l-3.333,-3.333l3.332,-3.333l-1.904,-1.906zm7.665,0l-1.903,1.905l3.332,3.333l-3.332,3.332l1.903,1.905l5.238,-5.238l-5.238,-5.237z" stroke-width="1.3" />'],fullScreen:[30,30,'<rect stroke-linejoin="round" height="11.169" width="17.655" y="9.415" x="6.172" stroke-width="1.5"/><path stroke-linejoin="round" d="m12.361,11.394l-3.604,3.605l3.605,3.605l1.311,-1.311l-2.294,-2.294l2.293,-2.294l-1.311,-1.311zm5.275,0l-1.310,1.311l2.293,2.294l-2.293,2.293l1.310,1.311l3.605,-3.605l-3.605,-3.605z"/>'],loop:[30,30,'<path stroke-linejoin="round" stroke-width="1" d="m14.632,10.097h5.524c2.373,0 4.297,2.147 4.297,4.796c0,1.272 -0.452,2.491 -1.258,3.391c-0.805,0.899 -1.898,1.404 -3.038,1.404h-0.613v1.370l-2.455,-2.740l2.455,-2.740v1.370h0.613c1.017,0 1.841,-0.920 1.841,-2.055c0,-1.135 -0.824,-2.055 -1.841,-2.055h-5.524v-2.740z"/><path stroke-linejoin="round" stroke-width="1" d="m15.367,19.902h-5.524c-2.373,0 -4.297,-2.147 -4.297,-4.796c0,-1.272 0.452,-2.491 1.258,-3.391c0.805,-0.899 1.898,-1.404 3.038,-1.404h0.613v-1.370l2.455,2.740l-2.455,2.740v-1.370h-0.613c-1.017,0 -1.841,0.920 -1.841,2.055c0,1.135 0.824,2.055 1.841,2.055h5.524v2.740z"/>'],volume:[30,30,'<ellipse id="volume_circle" style="fill-opacity:.6!important" ry="5" rx="5" cy="15" cx="15" stroke-dasharray="32 90" stroke-width="1.8"/>'],danmakuMode0:[30,30,'<path style="fill-opacity:1!important" stroke-width="0" d="m14.981,17.821l-7.937,-2.821l7.937,-2.821l0,1.409l7.975,0l0,2.821l-7.975,0l0,1.409l0,0.002z"/>'],danmakuMode1:[30,30,'<path style="fill-opacity:1!important" stroke-width="0" d="m15.019,12.178l7.937,2.821l-7.937,2.821l0,-1.409l-7.975,0l0,-2.821l7.975,0l0,-1.409l0,-0.002z"/>'],danmakuMode3:[30,30,'<path stroke-width="3" d="m7.972,7.486l14.054,0"/>'],danmakuMode2:[30,30,'<path stroke-width="3" d="m7.972,22.513l14.054,0"/>'],settings:[30,30,'<path stroke="null" style="fill-opacity:1!important" d="m19.770,13.364l-0.223,-0.530c0.766,-1.732 0.715,-1.784 0.566,-1.934l-0.979,-0.956l-0.097,-0.081l-0.113,0c-0.059,0 -0.238,0 -1.727,0.675l-0.547,-0.220c-0.708,-1.755 -0.780,-1.755 -0.988,-1.755l-1.381,0c-0.207,0 -0.287,-0.000 -0.944,1.761l-0.545,0.221c-1.006,-0.424 -1.596,-0.639 -1.755,-0.639l-0.130,0.004l-1.053,1.032c-0.159,0.150 -0.215,0.203 0.594,1.909l-0.223,0.528c-1.793,0.693 -1.793,0.760 -1.793,0.972l0,1.354c0,0.212 0,0.287 1.799,0.932l0.223,0.528c-0.766,1.731 -0.714,1.783 -0.566,1.932l0.979,0.958l0.097,0.083l0.114,0c0.058,0 0.235,0 1.726,-0.676l0.547,0.222c0.708,1.755 0.780,1.754 0.988,1.754l1.381,0c0.211,0 0.286,0 0.945,-1.760l0.548,-0.221c1.004,0.424 1.593,0.640 1.751,0.640l0.131,-0.003l1.061,-1.039c0.151,-0.152 0.204,-0.204 -0.602,-1.903l0.221,-0.529c1.795,-0.694 1.795,-0.766 1.795,-0.974l0,-1.353c-0.000,-0.213 -0.000,-0.287 -1.801,-0.929zm-4.770,3.888c-1.266,0 -2.298,-1.011 -2.298,-2.254c0,-1.241 1.031,-2.252 2.298,-2.252c1.266,0 2.295,1.010 2.295,2.252c-0.000,1.242 -1.029,2.254 -2.295,2.254z"/>']};r._.player=(0,c.default)({_:"div",attr:{class:"NyaP"},child:[{_:"div",attr:{id:"video_frame"},child:[l,r.danmakuFrame.container]},{_:"div",attr:{id:"control"},child:[{_:"span",attr:{id:"control_left"},child:[n("play",{click:function(e){return r.playToggle()}},{title:f("play")})]},{_:"span",attr:{id:"control_center"},child:[{_:"div",prop:{id:"progress_info"},child:[{_:"span",child:[{_:"canvas",prop:{id:"progress",pad:10}}]},{_:"span",prop:{id:"time"},child:[{_:"span",prop:{id:"current_time"},child:["00:00"]},"/",{_:"span",prop:{id:"total_time"},child:["00:00"]}]}]},{_:"div",prop:{id:"danmaku_input_frame"},child:[{_:"span",prop:{id:"danmaku_style"},child:[{_:"div",attr:{id:"danmaku_style_pannel"},child:[{_:"div",attr:{id:"danmaku_color_box"}},{_:"input",attr:{id:"danmaku_color",placeholder:f("hex color"),maxlength:"6"}},{_:"span",attr:{id:"danmaku_mode_box"}},{_:"span",attr:{id:"danmaku_size_box"}}]},n("danmakuStyle")]},{_:"input",attr:{id:"danmaku_input",placeholder:f("Input danmaku here")}},{_:"span",prop:{id:"danmaku_submit",innerHTML:f("Send")}}]}]},{_:"span",attr:{id:"control_right"},child:[n("addDanmaku",{click:function(e){return r.danmakuInput()}},{title:f("danmaku input")}),n("volume",{},{title:f("volume($0)","100%")}),n("loop",{click:function(e){return r.loop()}},{title:f("loop")}),{_:"span",prop:{id:"player_mode"},child:[n("fullPage",{click:function(e){return r.playerMode("fullPage")}},{title:f("full page")}),n("fullScreen",{click:function(e){return r.playerMode("fullScreen")}},{title:f("full screen")})]}]}]}]}),i(r._.player),e.danmakuSizes.forEach(function(e,t){var n=(0,c.default)({_:"span",attr:{style:"font-size:"+(12+3*t)+"px;",title:e},prop:{size:e},child:["A"]});u.danmaku_size_box.appendChild(n)}),e.danmakuColors.forEach(function(e){var t=(0,c.default)({_:"span",attr:{style:"background-color:#"+e+";",title:e},prop:{color:e}});u.danmaku_color_box.appendChild(t)}),e.danmakuModes.forEach(function(e){u.danmaku_mode_box.appendChild(n("danmakuMode"+e))}),i(u.danmaku_mode_box),setTimeout(function(){u.control.ResizeSensor=new d.ResizeSensor(u.control,function(){return r.refreshProgress()}),r.refreshProgress()},0),r._.progressContext=u.progress.getContext("2d"),(0,d.addEvents)(window,{keydown:function(e){switch(e.code){case"Escape":"fullPage"===r._.playerMode&&r.playerMode("normal")}}});var v={main_video:{playing:function(e){u.icon_span_play.classList.add("active_icon")},pause:function(e){u.icon_span_play.classList.remove("active_icon")},stalled:function(e){u.icon_span_play.classList.remove("active_icon")},timeupdate:function(e){Date.now()-r._.lastTimeUpdate<30||(r._setTimeInfo((0,d.formatTime)(l.currentTime,l.duration)),r.drawProgress(),r._.lastTimeUpdate=Date.now())},loadedmetadata:function(e){r._setTimeInfo(null,(0,d.formatTime)(l.duration,l.duration))},volumechange:function(e){(0,d.setAttrs)(u.volume_circle,{"stroke-dasharray":10*l.volume*Math.PI+" 90",style:"fill-opacity:"+(l.muted?.2:.6)+"!important"}),u.icon_span_volume.setAttribute("title",f("volume($0)",l.muted?f("muted"):(100*l.volume|0)+"%"))},progress:function(e){r.drawProgress()},_loopChange:function(e){r.eles.icon_span_loop.classList[e.value?"add":"remove"]("active_icon")},click:function(e){return r.playToggle()},mouseup:function(e){2===e.button&&(e.preventDefault(),r.menu([e.offsetX,e.offsetY]))},contextmenu:function(e){e.preventDefault()}},progress:{mousemove:function(e){r._.progressX=e.offsetX,r.drawProgress();var t=e.target,n=(e.offsetX-t.pad)/(t.offsetWidth-2*t.pad);n=(0,d.limitIn)(n,0,1),r._setTimeInfo(null,(0,d.formatTime)(n*l.duration,l.duration))},mouseout:function(e){r._.progressX=void 0,r.drawProgress(),r._setTimeInfo(null,(0,d.formatTime)(l.duration,l.duration))},click:function(e){var t=e.target,n=(e.offsetX-t.pad)/(t.offsetWidth-2*t.pad);n=(0,d.limitIn)(n,0,1),l.currentTime=n*l.duration}},danmaku_color:{"input,change":function(e){var t=e.target,n=void 0;(n=t.value.match(/^([\da-f\$]{3}){1,2}$/i))?(n=n[0],t.style.backgroundColor="#"+n,r._.danmakuColor=n):(r._.danmakuColor=void 0,t.style.backgroundColor="")}},icon_span_volume:{click:function(e){l.muted=!l.muted},wheel:function(e){if(e.preventDefault(),0===e.deltaMode){var t=void 0;t=e.shiftKey?e.deltaY>0?10:-10:e.deltaY>10||e.deltaY<-10?e.deltaY/10:e.deltaY,l.volume=(0,d.limitIn)(l.volume+t/100,0,1)}}},danmakuModeSwitch:{click:function(){var e=1*this.id.match(/\d$/)[0];void 0!==s._.danmakuMode&&u["icon_span_danmakuMode"+s._.danmakuMode].classList.remove("active"),u["icon_span_danmakuMode"+e].classList.add("active"),s._.danmakuMode=e}},danmaku_input:{keydown:function(e){"Enter"===e.code&&r.send()}},danmaku_submit:{click:function(e){r.send()}},danmaku_size_box:{click:function(e){var t=e.target;t.size&&((0,d.toArray)(u.danmaku_size_box.childNodes).forEach(function(e){r._.danmakuSize===e.size&&e.classList.remove("active")}),t.classList.add("active"),r._.danmakuSize=t.size)}},danmaku_color_box:{click:function(e){e.target.color&&(u.danmaku_color.value=e.target.color,u.danmaku_color.dispatchEvent(new Event("change")))}}};for(var p in u){var y=v[p];p.startsWith("icon_span_danmakuMode")&&(y=v.danmakuModeSwitch),y&&(0,d.addEvents)(u[p],y)}return u["icon_span_danmakuMode"+e.defaultDanmakuMode].click(),(0,d.toArray)(u.danmaku_size_box.childNodes).forEach(function(t){t.size===e.defaultDanmakuSize&&t.click()}),r}return r(t,e),s(t,[{key:"_setTimeInfo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;requestAnimationFrame(function(){null!==t&&(e.eles.current_time.innerHTML=t),null!==n&&(e.eles.total_time.innerHTML=n)})}},{key:"settingsBoxToggle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.eles.settings_box.style.display;this.eles.settings_box.style.display=e?"flex":""}},{key:"danmakuInput",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.eles.danmaku_input_frame.offsetHeight,t=this.eles;t.danmaku_input_frame.style.display=e?"flex":"",t.icon_span_addDanmaku.classList[e?"add":"remove"]("active_icon"),e&&t.danmaku_input.focus()}},{key:"playerMode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal";if("normal"!==e||this._.playerMode!==e){var t=this.eles;switch("fullPage"===this._.playerMode?(this.player.style.position="",t.icon_span_fullPage.classList.remove("active_icon")):"fullScreen"===this._.playerMode&&(t.icon_span_fullScreen.classList.remove("active_icon"),(0,d.exitFullscreen)()),"normal"!==e&&this._.playerMode===e&&(e="normal"),e){case"fullPage":this.player.style.position="fixed",t.icon_span_fullPage.classList.add("active_icon");break;case"fullScreen":t.icon_span_fullScreen.classList.add("active_icon"),(0,d.requestFullscreen)(this.player)}this._.playerMode=e,this.emit("playerModeChange",e)}}},{key:"loop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.video.loop;this.video.loop=e}},{key:"refreshProgress",value:function(){var e=this.eles.progress;e.width=e.offsetWidth,e.height=e.offsetHeight,this.drawProgress(),this.emit("progressRefresh")}},{key:"send",value:function(){var e=this,t=this._.danmakuColor||this.opt.defaultDanmakuColor,n=this.eles.danmaku_input.value,i=this._.danmakuSize,a=this._.danmakuMode,o=this.danmakuFrame.time;t&&(t=t.replace(/\$/g,function(){return h[(0,d.limitIn)(16*Math.random()|0,0,15)]}));var r={color:t,text:n,size:i,mode:a,time:o};this.opt.danmakuSend&&this.opt.danmakuSend(r,function(t){t&&"text"===t._&&(e.eles.danmaku_input.value="");var n=e.danmakuFrame.modules.TextDanmaku.load(t);n.highlight=!0})}},{key:"menu",value:function(e){if(console.log("position",e),e){var t=this.danmakuFrame.modules.TextDanmaku.danmakuAt(e[0],e[1]);console.log(t)}}},{key:"_progressDrawer",value:function(){var e=this._.progressContext,t=this.eles.progress,n=t.width,i=t.height,a=this.video,o=a.duration,r=a.currentTime,s=t.pad,u=n-2*s;e.clearRect(0,0,n,i),e.lineCap="round",e.beginPath(),e.strokeStyle="#eee",e.lineWidth=7,e.moveTo(s,15),e.lineTo(s+u,15),e.stroke(),e.beginPath(),e.strokeStyle="#C0BBBB",e.lineWidth=2,c=a.buffered;for(var l=c.length;l--;)e.moveTo(s+c.start(l)/o*u,18),e.lineTo(s+c.end(l)/o*u,18);e.stroke(),e.beginPath(),e.strokeStyle="#6cf",e.lineWidth=5,e.moveTo(s,15),e.lineTo(s+u*r/o,15),e.stroke(),e.beginPath(),e.strokeStyle="rgba(255,255,255,.3)",e.lineWidth=5;for(var c=a.played,l=c.length;l--;)e.moveTo(s+c.start(l)/o*u,15),e.lineTo(s+c.end(l)/o*u,15);e.stroke(),this._.progressX&&(e.beginPath(),e.strokeStyle="rgba(0,0,0,.05)",e.moveTo(s+u*r/o,15),e.lineTo((0,d.limitIn)(this._.progressX,s,s+u),15),e.stroke()),this._.drawingProgress=!1}},{key:"drawProgress",value:function(){var e=this;this._.drawingProgress||(this._.drawingProgress=!0,requestAnimationFrame(function(){e._progressDrawer()}))}}]),t}(d.NyaPlayerCore);window.NyaP=v},{"../lib/Object2HTML/Object2HTML.js":1,"./NyaPCore.js":12,"./i18n.js":13}],12:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=function(n){n.split(/\,/g).forEach(function(i){return e.addEventListener(i,t[n])})};for(var i in t)n(i)}function l(e){try{(e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen).call(e)}catch(e){console.error(e),alert(_("Failed to change to fullscreen mode"))}}function c(){var e=document;(e.exitFullscreen||e.msExitFullscreen||e.mozCancelFullScreen||e.webkitCancelFullScreen).call(e)}function d(){var e=document;return!!(e.fullscreen||e.mozFullScreen||e.webkitIsFullScreen||e.msFullscreenElement)}function f(e,t){var n=void 0,i=0|e,a=i/3600|0;return t>=3600&&(i%=3600),n=[h(i/60|0),h(i%60)],t>=3600&&n.unshift(a),n.join(":")}function h(e){return e>9&&e||"0"+e}function m(e,t){for(var n in t)e.setAttribute(n,t[n])}function v(e,t,n){return e<t?t:e>n?n:e}function p(e){return[].concat(a(e))}Object.defineProperty(n,"__esModule",{value:!0}),n.ResizeSensor=n.toArray=n.limitIn=n.setAttrs=n.padTime=n.formatTime=n.isFullscreen=n.exitFullscreen=n.requestFullscreen=n.addEvents=n.NyaPlayerCore=void 0;var y=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),k=e("../lib/danmaku-frame/src/danmaku-frame.js"),g=e("../lib/danmaku-text/src/danmaku-text.js"),b=i(g),w=e("../lib/Object2HTML/Object2HTML.js"),x=i(w);(0,b.default)(k.DanmakuFrame,k.DanmakuFrameModule);var T={muted:!1,volume:1,loop:!1,textStyle:{},danmakuOption:{}},M=function(){function e(){s(this,e),this._events={}}return y(e,[{key:"emit",value:function(e,t){this._resolve(e,t)}},{key:"_resolve",value:function(e,t){var n=this;if(e in this._events){var i=this._events[e];try{i.forEach(function(i){i.call(n,e,t)})}catch(e){console.error(e)}}}},{key:"on",value:function(e,t){t instanceof Function&&(e in this._events||(this._events[e]=[]),this._events[e].push(t))}},{key:"removeEvent",value:function(e,t){if(e in this._events){if(1===arguments.length)return void delete this._events[e];var n=void 0;(n=this._events[e].indexOf(t)>=0)&&this._events[e].splice(n,1),0===this._events[e].length&&delete this._events[e]}}}]),e}(),S=function(e){function t(e){s(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e=n.opt=Object.assign({},T,e),n._={};var i=n._.video=(0,x.default)({_:"video",attr:{id:"main_video"}});return n.danmakuFrame=new k.DanmakuFrame,n.danmakuFrame.setMedia(i),n.danmakuFrame.enable("TextDanmaku"),n.setDanmakuOptions(e.danmakuOption),n.setDanmakuOptions(e.textStyle),setTimeout(function(t){["src","muted","volume","loop"].forEach(function(t){void 0!==e[t]&&(n.video[t]=e[t])})},0),!function(){var e=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"loop");Object.defineProperty(i,"loop",{get:e.get,set:function(t){t!==this.loop&&(this.dispatchEvent(Object.assign(new Event("_loopChange"),{value:t})),e.set.call(this,t))}})}(),n.emit("coreLoad"),n}return r(t,e),y(t,[{key:"play",value:function(){this.video.paused&&this.video.play()}},{key:"pause",value:function(){this.video.paused||this.video.pause()}},{key:"playToggle",value:function(){this[this.video.paused?"play":"pause"]()}},{key:"seek",value:function(e){this.video.currentTime=e/1e3}},{key:"loadDanmaku",value:function(e){this.danmakuFrame.load(e)}},{key:"loadDanmakuList",value:function(e){this.danmakuFrame.loadList(e)}},{key:"removeDanmaku",value:function(e){this.danmakuFrame.unload(e)}},{key:"danmakuToggle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.danmakuFrame.working;this.danmakuFrame[e?"strat":"stop"]()}},{key:"setDefaultTextStyle",value:function(e){if(e)for(var t in e)this.TextDanmaku.defaultStyle[t]=e[t]}},{key:"setDanmakuOptions",value:function(e){if(e)for(var t in e)this.TextDanmaku.options[t]=e[t]}},{key:"player",get:function(){return this._.player}},{key:"video",get:function(){return this._.video}},{key:"src",get:function(){return this.video.src},set:function(e){this.video.src=e}},{key:"TextDanmaku",get:function(){return this.danmakuFrame.modules.TextDanmaku}},{key:"videoSize",get:function(){return[this.video.videoWidth,this.video.videoHeight]}}]),t}(M);String.prototype.startsWith||(String.prototype.startsWith=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.substr(t,e.length)===e}),n.default=S,n.NyaPlayerCore=S,n.addEvents=u,n.requestFullscreen=l,n.exitFullscreen=c,n.isFullscreen=d,n.formatTime=f,n.padTime=h,n.setAttrs=m,n.limitIn=v,n.toArray=p,n.ResizeSensor=k.ResizeSensor},{"../lib/Object2HTML/Object2HTML.js":1,"../lib/danmaku-frame/src/danmaku-frame.js":3,"../lib/danmaku-text/src/danmaku-text.js":7}],13:[function(e,t,n){"use strict";function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0});var a={lang:null,langs:{},_:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var o=a.lang&&a.langs[a.lang][e]||e;return n.length&&n.forEach(function(e,t){o=o.replace("$"+t,e)}),o}};a.langs["zh-CN"]={play:"播放",loop:"循环",Send:"发送",pause:"暂停",muted:"静音",settings:"设置","full page":"全页模式","full screen":"全屏模式","volume($0)":"音量（$0）","hex color":"Hex颜色","danmaku input":"弹幕输入框","Input danmaku here":"在这里输入弹幕","Failed to change to fullscreen mode":"无法切换到全屏模式"},navigator.languages||(navigator.languages=[navigator.language]),navigator.languages;for(var o=[].concat(i(navigator.languages)),r=0;r<o.length;r++){var s=o[r];if(a.langs[s]){a.lang=s;break}var u=s.match(/^\w+/)[0];for(var l in a.langs)if(l.startsWith(u)){a.lang=l;break}if(a.lang)break}console.debug("Language:"+a.lang),n.i18n=a},{}]},{},[11]);