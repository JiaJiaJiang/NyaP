!function e(t,n,a){function r(i,u){if(!n[i]){if(!t[i]){var l="function"==typeof require&&require;if(!u&&l)return l(i,!0);if(o)return o(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var c=n[i]={exports:{}};t[i][0].call(c.exports,function(e){var n=t[i][1][e];return r(n||e)},c,c.exports,e,t,n,a)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<a.length;i++)r(a[i]);return r}({1:[function(e,t,n){"use strict";function a(e){return"object"==(void 0===e?"undefined":o(e))}function r(e,t){var n=void 0,i=void 0,u=void 0;if("string"==typeof e||"number"==typeof e)return document.createTextNode(e);if(null!==e&&"object"===(void 0===e?"undefined":o(e))&&"_"in e!=!1&&"string"==typeof e._&&""!=e._){if(n=document.createElement(e._),a(e.attr))for(i in e.attr)n.setAttribute(i,e.attr[i]);if(a(e.prop))for(i in e.prop)n[i]=e.prop[i];if(a(e.event))for(i in e.event)n.addEventListener(i,e.event[i]);return a(e.child)&&e.child.length>0&&e.child.forEach(function(e){(u=e instanceof Node?e:r(e,t))instanceof Node&&n.appendChild(u)}),t&&t(n),n}}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.default=r,n.Object2HTML=r},{}],2:[function(e,t,n){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,r){"function"==typeof define&&define.amd?define(r):"object"===(void 0===n?"undefined":a(n))?t.exports=r():e.ResizeSensor=r()}(void 0,function(){function e(e,t){var n=Object.prototype.toString.call(e),a="[object Array]"===n||"[object NodeList]"===n||"[object HTMLCollection]"===n||"[object Object]"===n||"undefined"!=typeof jQuery&&e instanceof jQuery||"undefined"!=typeof Elements&&e instanceof Elements,r=0,o=e.length;if(a)for(;r<o;r++)t(e[r]);else t(e)}if("undefined"==typeof window)return null;var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,20)},n=function n(a,r){function o(){var e=[];this.add=function(t){e.push(t)};var t,n;this.call=function(){for(t=0,n=e.length;t<n;t++)e[t].call()},this.remove=function(a){var r=[];for(t=0,n=e.length;t<n;t++)e[t]!==a&&r.push(e[t]);e=r},this.length=function(){return e.length}}function i(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.style[t]}function u(e,n){if(e.resizedAttached)e.resizedAttached.add(n);else{e.resizedAttached=new o,e.resizedAttached.add(n),e.resizeSensor=document.createElement("div"),e.resizeSensor.className="resize-sensor";var a="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;",r="position: absolute; left: 0; top: 0; transition: 0s;";e.resizeSensor.style.cssText=a,e.resizeSensor.innerHTML='<div class="resize-sensor-expand" style="'+a+'"><div style="'+r+'"></div></div><div class="resize-sensor-shrink" style="'+a+'"><div style="'+r+' width: 200%; height: 200%"></div></div>',e.appendChild(e.resizeSensor),"static"==i(e,"position")&&(e.style.position="relative");var u,l,s,c,d=e.resizeSensor.childNodes[0],f=d.childNodes[0],h=e.resizeSensor.childNodes[1],m=e.offsetWidth,v=e.offsetHeight,p=function(){f.style.width="100000px",f.style.height="100000px",d.scrollLeft=1e5,d.scrollTop=1e5,h.scrollLeft=1e5,h.scrollTop=1e5};p();var y=function(){l=0,u&&(m=s,v=c,e.resizedAttached&&e.resizedAttached.call())},g=function(){s=e.offsetWidth,c=e.offsetHeight,(u=s!=m||c!=v)&&!l&&(l=t(y)),p()},k=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)};k(d,"scroll",g),k(h,"scroll",g)}}e(a,function(e){u(e,r)}),this.detach=function(e){n.detach(a,e)}};return n.detach=function(t,n){e(t,function(e){e.resizedAttached&&"function"==typeof n&&(e.resizedAttached.remove(n),e.resizedAttached.length())||e.resizeSensor&&(e.contains(e.resizeSensor)&&e.removeChild(e.resizeSensor),delete e.resizeSensor,delete e.resizedAttached)})},n})},{}],3:[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var n in t)!function(n){n.split(/\,/g).forEach(function(a){return e.addEventListener(a,t[n])})}(n)}Object.defineProperty(n,"__esModule",{value:!0}),n.ResizeSensor=n.DanmakuFrameModule=n.DanmakuFrame=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(e("../lib/ResizeSensor.js")),u=function(){function e(t){a(this,e);var n=this;n.container=t||document.createElement("div"),n.rate=1,n.timeBase=n.width=n.height=n.fps=0,n.fpsTmp=0,n.fpsRec=n.fps||60,n.media=null,n.working=!1,n.enabled=!0,n.modules={},n.moduleList=[];var r=document.createElement("style");document.head.appendChild(r),n.styleSheet=r.sheet;for(var o in e.moduleList)n.initModule(o);setTimeout(function(){n.container.ResizeSensor=new i.default(n.container,function(){n.resize()}),n.resize()},0),setInterval(function(){n.fpsRec=n.fpsTmp,n.fpsTmp=0},1e3),n.draw=n.draw.bind(n)}return o(e,[{key:"enable",value:function(e){if(!e)return this.enabled=!0,this.media?this.media.paused||this.start():this.start(),void(this.container.hidden=!1);var t=this.modules[e];return t?(t.enabled=!0,t.enable&&t.enable(),!0):this.initModule(e)}},{key:"disable",value:function(e){if(!e)return this.pause(),this.moduleFunction("clear"),this.enabled=!1,void(this.container.hidden=!0);var t=this.modules[e];return!!t&&(t.enabled=!1,t.disable&&t.disable(),!0)}},{key:"addStyle",value:function(e){var t=this;"string"==typeof e&&(e=[e]),e instanceof Array!=!1&&e.forEach(function(e){return t.styleSheet.insertRule(e,t.styleSheet.cssRules.length)})}},{key:"initModule",value:function(t){var n=e.moduleList[t];if(!n)throw"Module ["+t+"] does not exist.";var a=new n(this);if(a instanceof l==!1)throw"Constructor of "+t+" is not extended from DanmakuFrameModule";return a.enabled=!0,this.modules[t]=a,this.moduleList.push(t),console.debug("Mod Inited: "+t),!0}},{key:"draw",value:function(e){var t=this;this.working&&(this.fpsTmp++,this.moduleFunction("draw",e),0===this.fps?requestAnimationFrame(function(){return t.draw()}):setTimeout(this.draw,1e3/this.fps))}},{key:"load",value:function(e){this.moduleFunction("load",e)}},{key:"loadList",value:function(e){this.moduleFunction("loadList",e)}},{key:"unload",value:function(e){this.moduleFunction("unload",e)}},{key:"start",value:function(){!this.working&&this.enabled&&(this.working=!0,this.moduleFunction("start"),this.draw(!0))}},{key:"pause",value:function(){this.enabled&&(this.working=!1,this.moduleFunction("pause"))}},{key:"resize",value:function(){this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.moduleFunction("resize")}},{key:"moduleFunction",value:function(e,t){for(var n,a=0;a<this.moduleList.length;a++)(n=this.modules[this.moduleList[a]]).enabled&&n[e]&&n[e](t)}},{key:"setMedia",value:function(e){var t=this;t.media=e,r(e,{playing:function(){return t.start()},"pause,stalled,seeking":function(){return t.pause()},ratechange:function(){t.rate=t.media.playbackRate,t.moduleFunction("rate",t.rate)}}),t.moduleFunction("media",e)}},{key:"time",set:function(e){this.media||(this.timeBase=Date.now()-e),this.moduleFunction("time",e)},get:function(){return this.media?1e3*this.media.currentTime|0:Date.now()-this.timeBase}}],[{key:"addModule",value:function(e,t){e in this.moduleList?console.warn('The module "'+e+'" has already been added.'):this.moduleList[e]=t}}]),e}();u.moduleList={};var l=function e(t){a(this,e),this.frame=t,this.enabled=!1};n.DanmakuFrame=u,n.DanmakuFrameModule=l,n.ResizeSensor=i.default},{"../lib/ResizeSensor.js":2}],4:[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){"function"==typeof define&&define.amd?define(e):"object"===(void 0===n?"undefined":o(n))?t.exports=e():(0,eval)("this").Mat=e()}(function(){function e(t){var o=function(){function n(e,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;a(this,n),this.array=new t(e*r),Object.defineProperty(this.array,"row",{value:e}),Object.defineProperty(this.array,"column",{value:r}),3==arguments.length&&(n._instanceofTypedArray&&0===o||("number"==typeof o?this.fill(o):o.length&&this.set(o)))}return r(n,[{key:"leftMultiply",value:function(e){return this.set(n.multiply(e,this,new n(e.row,this.column)))}},{key:"rightMultiply",value:function(e){return this.set(n.multiply(this,e,new n(this.row,e,column)))}},{key:"fill",value:function(e){arguments.length||(e=0);for(var t=this.length;t--;)this.array[t]=e;return this}},{key:"set",value:function(e,t){t||(t=0),e instanceof n&&(e=e.array);for(var a=e.length+t<=this.length?e.length:this.length-t;a--;)this.array[t+a]=e[a];return this}},{key:"put",value:function(e,t,a){return n.put(this,e,t||0,a||0),this}},{key:"rotate2d",value:function(e){return this.set(n.rotate2d(this,e,n.Matrixes.T3))}},{key:"translate2d",value:function(e,t){return this.set(n.translate2d(this,e,t,n.Matrixes.T3))}},{key:"scale2d",value:function(e,t){return this.set(n.scale2d(this,e,t,n.Matrixes.T3))}},{key:"rotate3d",value:function(e,t,a){return this.set(n.rotate3d(this,e,t,a,n.Matrixes.T4))}},{key:"scale3d",value:function(e,t,a){return this.set(n.scale3d(this,e,t,a,n.Matrixes.T4))}},{key:"translate3d",value:function(e,t,a){return this.set(n.translate3d(this,e,t,a,n.Matrixes.T4))}},{key:"rotateX",value:function(e){return this.set(n.rotateX(this,e,n.Matrixes.T4))}},{key:"rotateY",value:function(e){return this.set(n.rotateY(this,e,n.Matrixes.T4))}},{key:"rotateZ",value:function(e){return this.set(n.rotateZ(this,e,n.Matrixes.T4))}},{key:"clone",value:function(){return new n(this.row,this.column,this)}},{key:"toString",value:function(){if(0===this.length)return"";for(var e=0,t=[],n=[];e<this.length;e++)e&&e%this.column==0&&(t.push(n.join("\t")),n.length=0),n.push(this.array[e]||0);return t.push(n.join("\t")),t.join("\n")}},{key:"length",get:function(){return this.array.length}},{key:"row",get:function(){return this.array.row}},{key:"column",get:function(){return this.array.column}}],[{key:"Identity",value:function(e){for(var t=new n(e,e,0),a=e;a--;)t.array[a*e+a]=1;return t}},{key:"Perspective",value:function(e,t,a,r,o){var i=a*Math.tan(e*Math.PI/360),u=i*t,l=o||new n(4,4,0),s=l.array;return s[0]=2*a/(u+u),s[5]=2*a/(i+i),s[10]=-(r+a)/(r-a),s[14]=-2*r*a/(r-a),s[11]=-1,o&&(s[1]=s[2]=s[3]=s[4]=s[6]=s[7]=s[8]=s[9]=s[12]=s[13]=s[15]=0),l}},{key:"multiply",value:function(e,t,a){if(e.column!==t.row)throw"wrong matrix";for(var r=e.row,o=Math.min(e.column,t.column),i=a||new n(r,o),u=void 0,l=void 0,s=void 0,c=r;c--;)for(u=o;u--;)for(i.array[s=c*i.column+u]=0,l=e.column;l--;)i.array[s]+=e.array[c*e.column+l]*t.array[u+l*t.column];return i}},{key:"multiplyString",value:function(e,t,a){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.column!==t.row)throw"wrong matrix";var o,i,u,l,s=a||new n(e.row,t.column);for(o=e.row;o--;)for(i=t.column;i--;)for(s.array[l=o*t.column+i]="",u=0;u<e.column;u++)(!r||0!=e.array[o*e.column+u]&&0!=t.array[i+u*t.column])&&(s.array[l]+=(u&&s.array[l]?"+":"")+"("+e.array[o*e.column+u]+")*("+t.array[i+u*t.column]+")");return s}},{key:"add",value:function(e,t,a){if(e.column!==t.column||e.row!==t.row)throw"wrong matrix";for(var r=a||new n(e.row,t.column),o=e.length;o--;)r.array[o]=e.array[o]+t.array[o];return r}},{key:"minus",value:function(e,t,a){if(e.column!==t.column||e.row!==t.row)throw"wrong matrix";for(var r=a||new n(e.row,t.column),o=e.length;o--;)r.array[o]=e.array[o]-t.array[o];return r}},{key:"rotate2d",value:function(e,t,a){var r=n.Matrixes.rotate2d;return r.array[0]=r.array[4]=Math.cos(t),r.array[1]=-(r.array[3]=Math.sin(t)),n.multiply(r,e,a||new n(3,3))}},{key:"scale2d",value:function(e,t,a,r){var o=n.Matrixes.scale2d;return o.array[0]=t,o.array[4]=a,n.multiply(o,e,r||new n(3,3))}},{key:"translate2d",value:function(e,t,a,r){var o=n.Matrixes.translate2d;return o.array[2]=t,o.array[5]=a,n.multiply(o,e,r||new n(3,3))}},{key:"rotate3d",value:function(e,t,a,r,o){var i=Math.cos(t),u=Math.sin(t),l=Math.cos(a),s=Math.sin(a),c=Math.cos(r),d=Math.sin(r),f=n.Matrixes.rotate3d;return f.array[0]=c*l,f.array[1]=c*s*u-d*i,f.array[2]=c*s*i+d*u,f.array[4]=d*l,f.array[5]=d*s*u+c*i,f.array[6]=d*s*i-c*u,f.array[8]=-s,f.array[9]=l*u,f.array[10]=l*i,n.multiply(f,e,o||new n(4,4))}},{key:"rotateX",value:function(e,t,a){var r=n.Matrixes.rotateX;return r.array[10]=r.array[5]=Math.cos(t),r.array[6]=-(r.array[9]=Math.sin(t)),n.multiply(r,e,a||new n(4,4))}},{key:"rotateY",value:function(e,t,a){var r=n.Matrixes.rotateY;return r.array[10]=r.array[0]=Math.cos(t),r.array[8]=-(r.array[2]=Math.sin(t)),n.multiply(r,e,a||new n(4,4))}},{key:"rotateZ",value:function(e,t,a){var r=n.Matrixes.rotateZ;return r.array[5]=r.array[0]=Math.cos(t),r.array[1]=-(r.array[4]=Math.sin(t)),n.multiply(r,e,a||new n(4,4))}},{key:"scale3d",value:function(e,t,a,r,o){var i=n.Matrixes.scale3d;return i.array[0]=t,i.array[5]=a,i.array[10]=r,n.multiply(i,e,o||new n(4,4))}},{key:"translate3d",value:function(e,t,a,r,o){var i=n.Matrixes.translate3d;return i.array[12]=t,i.array[13]=a,i.array[14]=r,n.multiply(i,e,o||new n(4,4))}},{key:"put",value:function(e,t,n,a){var r=void 0;n||(n=0),a||(a=0);for(var o=t.row;o--;)if(!(o+n>=e.row))for(r=t.column;r--;)r+a>=e.column||(e.array[(o+n)*e.column+r+a]=t.array[o*t.column+r])}},{key:"createClass",value:function(t){return e(t)}}]),n}(),i=new t(1);return Object.defineProperty(o,"_instanceofTypedArray",{value:!(!n||!n.isPrototypeOf(i))}),i=null,o.Matrixes={I2:o.Identity(2),I3:o.Identity(3),I4:o.Identity(4),T3:new o(3,3,0),T4:new o(4,4,0),rotate2d:o.Identity(3),translate2d:o.Identity(3),scale2d:o.Identity(3),translate3d:o.Identity(4),rotate3d:o.Identity(4),rotateX:o.Identity(4),rotateY:o.Identity(4),rotateZ:o.Identity(4),scale3d:o.Identity(4)},o}var t=(0,eval)("this"),n=t.Float32Array&&t.Float32Array.prototype;return e(t.Float32Array?Float32Array:Array)})},{}],5:[function(e,t,n){(function(e,t){"use strict";!function(t,n){function a(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var a={callback:e,args:t};return s[l]=a,u(l),l++}function r(e){delete s[e]}function o(e){var t=e.callback,a=e.args;switch(a.length){case 0:t();break;case 1:t(a[0]);break;case 2:t(a[0],a[1]);break;case 3:t(a[0],a[1],a[2]);break;default:t.apply(n,a)}}function i(e){if(c)setTimeout(i,0,e);else{var t=s[e];if(t){c=!0;try{o(t)}finally{r(e),c=!1}}}}if(!t.setImmediate){var u,l=1,s={},c=!1,d=t.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(t);f=f&&f.setTimeout?f:t,"[object process]"==={}.toString.call(t.process)?function(){u=function(t){e.nextTick(function(){i(t)})}}():function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?function(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&i(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),u=function(n){t.postMessage(e+n,"*")}}():t.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){i(e.data)},u=function(t){e.port2.postMessage(t)}}():d&&"onreadystatechange"in d.createElement("script")?function(){var e=d.documentElement;u=function(t){var n=d.createElement("script");n.onreadystatechange=function(){i(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():function(){u=function(e){setTimeout(i,0,e)}}(),f.setImmediate=a,f.clearImmediate=r}}("undefined"==typeof self?void 0===t?void 0:t:self)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:11}],6:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){function n(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(0===e.length)return 0;for(var o=n,i=a;n<=a;)t<=e[o=n+a>>1].time?a=o-1:n=o+1;if(r)for(;n>0&&e[n-1].time===t;)n--;else for(;n<=i&&e[n].time===t;)n++;return n}var a=Object.defineProperty,u=window.requestIdleCallback||setImmediate,m=!1,v=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=n;i.list=[],i.indexMark=0,i.tunnel=new y,i.paused=!0,i.randomText="danmaku_text_"+(999999*Math.random()|0),i.defaultStyle={fontStyle:null,fontWeight:300,fontVariant:null,color:"#fff",fontSize:24,fontFamily:"Arial",strokeWidth:1,strokeColor:"#888",shadowBlur:5,textAlign:"start",shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0,fill:!0},e.addStyle("."+i.randomText+"_fullfill{top:0;left:0;width:100%;height:100%;position:absolute;}"),a(i,"rendererMode",{configurable:!0}),a(i,"activeRendererMode",{configurable:!0,value:null});var u=i.container=document.createElement("div");return u.classList.add(i.randomText+"_fullfill"),e.container.appendChild(u),i.text2d=new d.default(i),i.text3d=new f.default(i),i.textCanvas=new h.default(i),i.textCanvasContainer.hidden=i.canvas.hidden=i.canvas3d.hidden=!0,i.modes={1:i.textCanvas,2:i.text2d,3:i.text3d},i.GraphCache=[],i.DanmakuText=[],i.renderingDanmakuManager=new k(i),i.cacheCleanTime=0,i.danmakuMoveTime=0,i.danmakuCheckTime=0,i.danmakuCheckSwitch=!0,i.options={allowLines:!1,screenLimit:0,clearWhenTimeReset:!0,speed:6.5,autoShiftRenderingMode:!0},l(document,{visibilitychange:function(e){i.danmakuCheckSwitch=!document.hidden,document.hidden||i.recheckIndexMark()}}),i._checkNewDanmaku=i._checkNewDanmaku.bind(i),i._cleanCache=i._cleanCache.bind(i),setInterval(i._cleanCache,5e3),i.setRendererMode(1),n}return i(t,e),c(t,[{key:"setRendererMode",value:function(e){var t=this;return!!(t.rendererMode!==e&&e in t.modes&&t.modes[e].supported)&&(t.activeRendererMode&&t.activeRendererMode.disable(),a(t,"activeRendererMode",{value:t.modes[e]}),a(t,"rendererMode",{value:e}),t.activeRendererMode.resize(),t.activeRendererMode.enable(),console.log("rendererMode:",t.rendererMode),!0)}},{key:"media",value:function(e){var t=this;l(e,{seeked:function(){t.time(),t._clearScreen(!0)},seeking:function(){return t.pause()}})}},{key:"start",value:function(){this.paused=!1,this.recheckIndexMark(),this.activeRendererMode.start()}},{key:"pause",value:function(){this.paused=!0,this.activeRendererMode.pause()}},{key:"load",value:function(e,t){if(!e||"text"!==e._)return!1;if("string"!=typeof e.text)return console.error("wrong danmaku object:",e),!1;e.time;var a=void 0,r=this.list;return a=n(r,e.time,0,r.length-1,!1),r.splice(a,0,e),a<this.indexMark&&this.indexMark++,"object"!==s(e.style)&&(e.style={}),e.style.fontSize=e.style.fontSize?e.style.fontSize+.5|0:this.defaultStyle.fontSize,(isNaN(e.style.fontSize)||e.style.fontSize===1/0||0===e.style.fontSize)&&(e.style.fontSize=this.defaultStyle.fontSize),"number"!=typeof e.mode&&(e.mode=0),t&&this._addNewDanmaku(e),e}},{key:"loadList",value:function(e){var t=this;e.forEach(function(e){return t.load(e)})}},{key:"unload",value:function(e){if(!e||"text"!==e._)return!1;var t=this,n=t.list.indexOf(e);return!(n<0)&&(t.list.splice(n,1),n<t.indexMark&&t.indexMark--,!0)}},{key:"_checkNewDanmaku",value:function(e){if(!this.paused||e){var t=this,n=void 0,a=t.frame.time;if(t.danmakuCheckTime!==a&&t.danmakuCheckSwitch){if(t.list.length)for(;t.indexMark<t.list.length&&(n=t.list[t.indexMark])&&n.time<=a;t.indexMark++)t.options.screenLimit>0&&t.DanmakuText.length>=t.options.screenLimit||t._addNewDanmaku(n);t.danmakuCheckTime=a}}}},{key:"_addNewDanmaku",value:function(e){var t=this,n=t.height,a=t.width,r=t.GraphCache.length?t.GraphCache.shift():new p;r.danmaku=e,r.drawn=!1,r.text=t.options.allowLines?e.text:e.text.replace(/\n/g," "),r.time=e.time,r.font=Object.create(t.defaultStyle),Object.assign(r.font,e.style),r.font.lineHeight||(r.font.lineHeight=r.font.fontSize+2||1),e.style.color&&r.font.color&&"#"!==r.font.color[0]&&(r.font.color="#"+e.style.color),e.mode>1&&(r.font.textAlign="center"),r.prepare(3!==t.rendererMode);var o=t.tunnel.getTunnel(r,n),i=(o<0?0:o)%n;switch(e.mode){case 0:case 1:case 3:r.style.y=i;break;case 2:r.style.y=n-i-r.style.height-1}switch(e.mode){case 0:r.style.x=a;break;case 1:r.style.x=-r.style.width;break;case 2:case 3:r.style.x=(a-r.style.width)/2}t.renderingDanmakuManager.add(r),t.activeRendererMode.newDanmaku(r)}},{key:"_calcSideDanmakuPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.frame.time,n=!e.danmaku.mode,a=e.style;return(n?this.frame.width:-a.width)+(n?-1:1)*this.frame.rate*(a.width+1024)*(t-e.time)*this.options.speed/6e4}},{key:"_calcDanmakusPosition",value:function(e){var t=this,n=t.frame.time;if(!t.paused||e){var a=t.width,r=t.frame.rate,o=void 0,i=void 0,u=void 0,l=void 0,s=void 0;for(t.danmakuMoveTime=n,i=t.DanmakuText.length;i--;)if((u=t.DanmakuText[i]).time>n)t.removeText(u);else switch(l=u.style,u.danmaku.mode){case 0:case 1:if(o=!u.danmaku.mode,l.x=s=t._calcSideDanmakuPosition(u,n),u.tunnelNumber>=0&&(o&&s+l.width+10<a||!o&&s>10))t.tunnel.removeMark(u);else if(o&&s<-l.width-20||!o&&s>a+l.width+20){t.removeText(u);continue}break;case 2:case 3:n-u.time>1e3*t.options.speed/r&&t.removeText(u)}}}},{key:"_cleanCache",value:function(e){var t=this,n=Date.now();if(t.GraphCache.length>30||e)for(var a=0;a<t.GraphCache.length&&(e||n-t.GraphCache[a].removeTime>1e4);a++)t.activeRendererMode.deleteTextObject(t.GraphCache[a]),t.GraphCache.splice(a,1)}},{key:"draw",value:function(e){var t=this;!e&&this.paused||!this.enabled||(this._calcDanmakusPosition(e),this.activeRendererMode.draw(e),requestAnimationFrame(function(){t._checkNewDanmaku(e)}))}},{key:"removeText",value:function(e){this.renderingDanmakuManager.remove(e),this.tunnel.removeMark(e),e._bitmap=e.danmaku=null,e.removeTime=Date.now(),this.GraphCache.push(e),this.activeRendererMode.remove(e)}},{key:"resize",value:function(){this.activeRendererMode&&this.activeRendererMode.resize(),this.draw(!0)}},{key:"_clearScreen",value:function(e){this.activeRendererMode&&this.activeRendererMode.clear(e)}},{key:"clear",value:function(){for(var e,t=this.DanmakuText.length;t--;)(e=this.DanmakuText[t]).danmaku&&this.removeText(e);this.tunnel.reset(),this._clearScreen(!0)}},{key:"recheckIndexMark",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.frame.time;this.indexMark=n(this.list,e,0,this.list.length-1,!0)}},{key:"rate",value:function(e){this.activeRendererMode&&this.activeRendererMode.rate(e)}},{key:"time",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.frame.time;this.recheckIndexMark(e),this.options.clearWhenTimeReset?this.clear():this.resetTimeOfDanmakuOnScreen()}},{key:"resetTimeOfDanmakuOnScreen",value:function(e){var t=this;void 0===e&&(e=this.frame.time),this.DanmakuText.forEach(function(n){n.danmaku&&(n.time=e-(t.danmakuMoveTime-n.time))})}},{key:"danmakuAt",value:function(e,t){var n=[];return this.enabled?(this.DanmakuText.forEach(function(a){a.danmaku&&a.style.x<=e&&a.style.x+a.style.width>=e&&a.style.y<=t&&a.style.y+a.style.height>=t&&n.push(a.danmaku)}),n):n}},{key:"enable",value:function(){this.textCanvasContainer.hidden=!1,this.frame.working&&this.start()}},{key:"disable",value:function(){this.textCanvasContainer.hidden=!0,this.pause(),this.clear()}},{key:"useImageBitmap",set:function(e){m="function"==typeof createImageBitmap&&e},get:function(){return m}},{key:"width",get:function(){return this.frame.width}},{key:"height",get:function(){return this.frame.height}}]),t}(t),p=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";r(this,e);var n=this;n._fontString="",n._renderList=null,n.style={},n.font={},n.text=t,n._renderToCache=n._renderToCache.bind(n),a(n,"_cache",{configurable:!0})}return c(e,[{key:"prepare",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;t._cache||a(t,"_cache",{value:document.createElement("canvas")});var n=[];t.font.fontStyle&&n.push(t.font.fontStyle),t.font.fontVariant&&n.push(t.font.fontVariant),t.font.fontWeight&&n.push(t.font.fontWeight),n.push(t.font.fontSize+"px"),t.font.fontFamily&&n.push(t.font.fontFamily),t._fontString=n.join(" ");var r=t._cache,o=r.ctx2d||(r.ctx2d=r.getContext("2d"));o.font=t._fontString,t._renderList=t.text.split(/\n/g),t.estimatePadding=Math.max(t.font.shadowBlur+5+Math.max(Math.abs(t.font.shadowOffsetY),Math.abs(t.font.shadowOffsetX)),t.font.strokeWidth+3);for(var i=0,l=void 0,s="number"==typeof t.font.lineHeight?t.font.lineHeight:t.font.fontSize,c=t._renderList.length;c--;)(l=o.measureText(t._renderList[c]).width)>i&&(i=l);r.width=(t.style.width=i)+2*t.estimatePadding,r.height=(t.style.height=t._renderList.length*s)+(s<t.font.fontSize?2*t.font.fontSize:0)+2*t.estimatePadding,o.translate(t.estimatePadding,t.estimatePadding),e?u(t._renderToCache):t._renderToCache()}},{key:"_renderToCache",value:function(){var e=this;e.danmaku&&(e.render(e._cache.ctx2d),m&&(e._bitmap&&(e._bitmap.close(),e._bitmap=null),createImageBitmap(e._cache).then(function(t){e._bitmap=t})))}},{key:"render",value:function(e){var t=this;if(t._renderList){e.save(),t.danmaku.highlight&&(e.fillStyle="rgba(255,255,255,0.3)",e.beginPath(),e.rect(0,0,t.style.width,t.style.height),e.fill()),e.font=t._fontString,e.textBaseline="middle",e.lineWidth=t.font.strokeWidth,e.fillStyle=t.font.color,e.strokeStyle=t.font.strokeColor,e.shadowBlur=t.font.shadowBlur,e.shadowColor=t.font.shadowColor,e.shadowOffsetX=t.font.shadowOffsetX,e.shadowOffsetY=t.font.shadowOffsetY,e.textAlign=t.font.textAlign;var n="number"==typeof t.font.lineHeight?t.font.lineHeight:t.font.fontSize,a=void 0;switch(t.font.textAlign){case"left":case"start":a=0;break;case"center":a=t.style.width/2;break;case"right":case"end":a=t.style.width}for(var r=t._renderList.length;r--;)t.font.strokeWidth&&e.strokeText(t._renderList[r],a,n*(r+.5)),t.font.fill&&e.fillText(t._renderList[r],a,n*(r+.5));e.restore()}}}]),e}(),y=function(){function e(){r(this,e),this.reset()}return c(e,[{key:"reset",value:function(){this.right={},this.left={},this.bottom={},this.top={}}},{key:"getTunnel",value:function(e,t){var n=this.tunnel(e.danmaku.mode),a=e.style.height,r=0,o=-1;if(("number"!=typeof a||a<=0)&&(console.error("Incorrect size:"+a),a=24),a>t)return 0;for(;o<0;)for(var i=r+a-1;r<=i;){if(n[r]){r+=n[r].tunnelHeight;break}if(0!==r&&r%(t-1)==0){r++;break}if(r===i){o=r-a+1;break}r++}return e.tunnelNumber=o,e.tunnelHeight=e.style.y+a>t?1:a,this.addMark(e),o}},{key:"addMark",value:function(e){var t=this.tunnel(e.danmaku.mode);t[e.tunnelNumber]||(t[e.tunnelNumber]=e)}},{key:"removeMark",value:function(e){var t=void 0,n=e.tunnelNumber;n>=0&&(t=this.tunnel(e.danmaku.mode))[n]===e&&(delete t[n],e.tunnelNumber=-1)}},{key:"tunnel",value:function(e){return this[g[e]]}}]),e}(),g=["right","left","bottom","top"],k=function(){function e(t){var n=this;r(this,e),this.dText=t,this.totalArea=0,this.limitArea=1/0,t.text2d.supported&&(this.timer=setInterval(function(){return n.rendererModeCheck()},1500))}return c(e,[{key:"add",value:function(e){this.dText.DanmakuText.push(e),this.totalArea+=e._cache.width*e._cache.height}},{key:"remove",value:function(e){var t=this.dText.DanmakuText.indexOf(e);t>=0&&(this.dText.DanmakuText.splice(t,1),this.totalArea-=e._cache.width*e._cache.height)}},{key:"rendererModeCheck",value:function(){var e=this.dText;this.dText.options.autoShiftRenderingMode&&!e.paused&&(e.frame.fpsRec<.95*(e.frame.fps||60)?this.limitArea>this.totalArea&&(this.limitArea=this.totalArea):this.limitArea<this.totalArea&&(this.limitArea=this.totalArea),1==e.rendererMode&&this.totalArea>this.limitArea?e.text2d.supported&&e.setRendererMode(2):2==e.rendererMode&&this.totalArea<.5*this.limitArea&&e.textCanvas.supported&&e.setRendererMode(1))}}]),e}();e.addModule("TextDanmaku",v)}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var n in t)!function(n){n.split(/\,/g).forEach(function(a){return e.addEventListener(a,t[n])})}(n)}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();e("../lib/setImmediate/setImmediate.js");var d=a(e("./text2d.js")),f=a(e("./text3d.js")),h=a(e("./textCanvas.js"));n.default=u},{"../lib/setImmediate/setImmediate.js":5,"./text2d.js":7,"./text3d.js":8,"./textCanvas.js":9}],7:[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=function(e){function t(e){a(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.supported=!1,e.canvas=document.createElement("canvas"),e.context2d=e.canvas.getContext("2d"),e.context2d?(e.canvas.classList.add(e.randomText+"_fullfill"),e.canvas.id=e.randomText+"_text2d",e.container.appendChild(e.canvas),n.supported=!0,n):(console.warn("text 2d not supported"),r(n))}return o(t,e),i(t,[{key:"draw",value:function(e){var t=this.dText.context2d,n=t.canvas.width,a=this.dText.DanmakuText,r=a.length,o=void 0,i=void 0,u=void 0,l=void 0,s=this.dText.useImageBitmap;for(t.globalCompositeOperation="destination-over",this.clear(e);r--;)(o=a[r]).drawn||(o.drawn=!0),u=(i=o.style.x-o.estimatePadding)+o._cache.width,i>n||u<0||(!s&&n>=o._cache.width?t.drawImage(o._bitmap||o._cache,i,o.style.y-o.estimatePadding):(l=o._cache.width+(i<0?i:0)-(u>n?u-n:0),t.drawImage(o._bitmap||o._cache,i<0?-i:0,0,l,o._cache.height,i<0?0:i,o.style.y-o.estimatePadding,l,o._cache.height)))}},{key:"clear",value:function(e){var t=this.dText;if(e||this._evaluateIfFullClearMode())t.context2d.clearRect(0,0,t.canvas.width,t.canvas.height);else for(var n,a=t.DanmakuText.length;a--;)(n=t.DanmakuText[a]).drawn&&t.context2d.clearRect(n.style.x-n.estimatePadding,n.style.y-n.estimatePadding,n._cache.width,n._cache.height)}},{key:"_evaluateIfFullClearMode",value:function(){if(this.dText.DanmakuText.length>3)return!0;var e=this.dText.GraphCache[this.dText.GraphCache.length-1];return!(!e||!e.drawn)&&(e.drawn=!1,!0)}},{key:"resize",value:function(){var e=this.dText,t=e.canvas;t.width=e.width,t.height=e.height}},{key:"enable",value:function(){this.draw(),this.dText.useImageBitmap=!(this.dText.canvas.hidden=!1)}},{key:"disable",value:function(){this.dText.canvas.hidden=!0,this.clear(!0)}}]),t}(function(e){return e&&e.__esModule?e:{default:e}}(e("./textModuleTemplate.js")).default);n.default=u},{"./textModuleTemplate.js":10}],8:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=a(e("../lib/Mat/Mat.js")),s=a(e("./textModuleTemplate.js")),c=window.requestIdleCallback||setImmediate,d=function(e){function t(e){function n(e){var t=u.createShader(l[e][0]);if(u.shaderSource(t,l[e][1]),u.compileShader(t),!u.getShaderParameter(t,u.COMPILE_STATUS))throw"An error occurred compiling the shaders: "+u.getShaderInfoLog(t);return t}r(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.supported=!1;var i=a.c3d=e.canvas3d=document.createElement("canvas");if(i.classList.add(e.randomText+"_fullfill"),i.id=e.randomText+"_text3d",e.context3d=i.getContext("webgl")||i.getContext("experimental-webgl"),!e.context3d)return console.warn("text 3d not supported"),o(a);e.container.appendChild(i);var u=a.gl=e.context3d,l={danmakuFrag:[u.FRAGMENT_SHADER,"\n\t\t\t\t#pragma optimize(on)\n\t\t\t\tprecision lowp float;\n\t\t\t\tvarying lowp vec2 vDanmakuTexCoord;\n\t\t\t\tuniform sampler2D uSampler;\n\t\t\t\tvoid main(void) {\n\t\t\t\t\tvec4 co=texture2D(uSampler,vDanmakuTexCoord);\n\t\t\t\t\tif(co.a == 0.0)discard;\n\t\t\t\t\tgl_FragColor = co;\n\t\t\t\t}"],danmakuVert:[u.VERTEX_SHADER,"\n\t\t\t\t#pragma optimize(on)\n\t\t\t\tattribute vec2 aVertexPosition;\n\t\t\t\tattribute vec2 aDanmakuTexCoord;\n\t\t\t\tuniform mat4 u2dCoordinate;\n\t\t\t\tvarying lowp vec2 vDanmakuTexCoord;\n\t\t\t\tvoid main(void) {\n\t\t\t\t\tgl_Position = u2dCoordinate * vec4(aVertexPosition,0,1);\n\t\t\t\t\tvDanmakuTexCoord = aDanmakuTexCoord;\n\t\t\t\t}"]},s=n("danmakuFrag"),c=n("danmakuVert"),d=a.shaderProgram=u.createProgram();return u.attachShader(d,c),u.attachShader(d,s),u.linkProgram(d),u.getProgramParameter(d,u.LINK_STATUS)?(u.useProgram(d),u.clearColor(0,0,0,0),u.enable(u.BLEND),u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA),a.maxTexSize=u.getParameter(u.MAX_TEXTURE_SIZE),a.uSampler=u.getUniformLocation(d,"uSampler"),a.u2dCoord=u.getUniformLocation(d,"u2dCoordinate"),a.aVertexPosition=u.getAttribLocation(d,"aVertexPosition"),a.atextureCoord=u.getAttribLocation(d,"aDanmakuTexCoord"),u.enableVertexAttribArray(a.aVertexPosition),u.enableVertexAttribArray(a.atextureCoord),a.commonTexCoordBuffer=u.createBuffer(),a.commonVertCoordBuffer=u.createBuffer(),u.activeTexture(u.TEXTURE0),u.uniform1i(a.uSampler,0),a.supported=!0,a):(console.error("Unable to initialize the shader program."),o(a))}return i(t,e),u(t,[{key:"draw",value:function(e){for(var t,n=this.gl,a=this.dText.DanmakuText.length,r=this.c3d.width,o=void 0,i=void 0,u=void 0,l=0;l<a;l++)(t=this.dText.DanmakuText[l])&&t.glDanmaku&&(i=(o=t.style.x-t.estimatePadding)+t._cache.width,u=t._cache.width+(o<0?o:0)-(i>r?i-r:0),o>r||i<0||(t.vertCoord[0]=t.vertCoord[4]=o<0?0:o,t.vertCoord[2]=t.vertCoord[6]=t.vertCoord[0]+u,n.bindBuffer(n.ARRAY_BUFFER,this.commonVertCoordBuffer),n.bufferData(n.ARRAY_BUFFER,t.vertCoord,n.DYNAMIC_DRAW),n.vertexAttribPointer(this.aVertexPosition,2,n.FLOAT,!1,0,0),f[0]=f[4]=o<0?-o/t._cache.width:0,f[2]=f[6]=f[0]+u/t._cache.width,n.bindBuffer(n.ARRAY_BUFFER,this.commonTexCoordBuffer),n.bufferData(n.ARRAY_BUFFER,f,n.DYNAMIC_DRAW),n.vertexAttribPointer(this.atextureCoord,2,n.FLOAT,!1,0,0),n.bindTexture(n.TEXTURE_2D,t.texture),n.drawArrays(n.TRIANGLE_STRIP,0,4)));n.flush()}},{key:"clear",value:function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}},{key:"deleteTextObject",value:function(e){var t=this.gl;e.texture&&t.deleteTexture(e.texture)}},{key:"resize",value:function(e,t){var n=this.gl,a=this.c3d;a.width=this.dText.width,a.height=this.dText.height,n.viewport(0,0,a.width,a.height),n.uniformMatrix4fv(this.u2dCoord,!1,l.default.Identity(4).translate3d(-1,1,0).scale3d(2/a.width,-2/a.height,0).array)}},{key:"enable",value:function(){var e=this;this.dText.DanmakuText.forEach(function(t){e.newDanmaku(t,!1)}),this.dText.useImageBitmap=this.c3d.hidden=!1,requestAnimationFrame(function(){return e.draw()})}},{key:"disable",value:function(){this.clear(),this.c3d.hidden=!0}},{key:"newDanmaku",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.gl;if(e.glDanmaku=!1,e._cache.height>this.maxTexSize||e._cache.width>this.maxTexSize)console.warn("Ignore a danmaku width too large size",e.danmaku);else{var a=void 0;(a=e.texture)||(a=e.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,a),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),t?c(function(){n.bindTexture(n.TEXTURE_2D,a),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e._cache),e.glDanmaku=!0}):(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e._cache),e.glDanmaku=!0);var r=e.style.y-e.estimatePadding;e.vertCoord=new Float32Array([0,r,0,r,0,r+e._cache.height,0,r+e._cache.height])}}}]),t}(s.default),f=new Float32Array([0,0,1,0,0,1,1,1]);n.default=d},{"../lib/Mat/Mat.js":4,"./textModuleTemplate.js":10}],9:[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=function(e){function t(e){a(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.supported=e.text2d.supported,n.supported?(e.frame.addStyle(["#"+e.randomText+"_textCanvasContainer canvas{will-change:transform;top:0;left:0;position:absolute;}","#"+e.randomText+"_textCanvasContainer.moving canvas{transition:transform 500s linear;}","#"+e.randomText+"_textCanvasContainer{will-change:transform;pointer-events:none;overflow:hidden;}"]),n.container=e.textCanvasContainer=document.createElement("div"),n.container.classList.add(e.randomText+"_fullfill"),n.container.id=e.randomText+"_textCanvasContainer",e.container.appendChild(n.container),n):r(n)}return o(t,e),i(t,[{key:"_toggle",value:function(e){var t=this,n=this.dText,a=n.frame.time;this.container.classList[e?"add":"remove"]("moving");for(var r,o=n.DanmakuText.length;o--;){(function(o,i){if((i=n.DanmakuText[o]).danmaku.mode>=2)return"continue";e?requestAnimationFrame(function(){return t._move(i)}):t._move(i,a),r=i})(o,r)}}},{key:"pause",value:function(){this._toggle(!1)}},{key:"start",value:function(){this._toggle(!0)}},{key:"rate",value:function(){this.resetPos()}},{key:"_move",value:function(e,t){e.danmaku&&(void 0===t&&(t=this.dText.frame.time+5e5),e._cache.style.transform="translate3d("+(10*(this.dText._calcSideDanmakuPosition(e,t)-e.estimatePadding)|0)/10+"px,"+(e.style.y-e.estimatePadding)+"px,0)")}},{key:"resetPos",value:function(){var e=this;this.pause(),this.dText.paused||requestAnimationFrame(function(){return e.start()})}},{key:"resize",value:function(){this.resetPos()}},{key:"remove",value:function(e){e._cache.parentNode&&this.container.removeChild(e._cache)}},{key:"enable",value:function(){var e=this;requestAnimationFrame(function(){e.dText.DanmakuText.forEach(function(t){return e.newDanmaku(t)})}),this.container.hidden=!1}},{key:"disable",value:function(){this.container.hidden=!0,this.container.innerHTML=""}},{key:"newDanmaku",value:function(e){var t=this;e._cache.style.transform="translate3d("+(e.style.x-e.estimatePadding)+"px,"+(e.style.y-e.estimatePadding)+"px,0)",this.container.appendChild(e._cache),e.danmaku.mode<2&&!this.dText.paused&&requestAnimationFrame(function(){return t._move(e)})}}]),t}(function(e){return e&&e.__esModule?e:{default:e}}(e("./textModuleTemplate.js")).default);n.default=u},{"./textModuleTemplate.js":10}],10:[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=function(){function e(t){a(this,e),this.dText=t}return r(e,[{key:"draw",value:function(){}},{key:"rate",value:function(){}},{key:"pause",value:function(){}},{key:"start",value:function(){}},{key:"clear",value:function(){}},{key:"resize",value:function(){}},{key:"remove",value:function(){}},{key:"enable",value:function(){}},{key:"disable",value:function(){}},{key:"newDanmaku",value:function(){}},{key:"deleteTextObject",value:function(){}}]),e}();n.default=o},{}],11:[function(e,t,n){function a(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(d===setTimeout)return setTimeout(e,0);if((d===a||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function i(e){if(f===clearTimeout)return clearTimeout(e);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function u(){p&&m&&(p=!1,m.length?v=m.concat(v):y=-1,v.length&&l())}function l(){if(!p){var e=o(u);p=!0;for(var t=v.length;t;){for(m=v,v=[];++y<t;)m&&m[y].run();y=-1,t=v.length}m=null,p=!1,i(e)}}function s(e,t){this.fun=e,this.array=t}function c(){}var d,f,h=t.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:a}catch(e){d=a}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(e){f=r}}();var m,v=[],p=!1,y=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];v.push(new s(e,t)),1!==v.length||p||o(l)},s.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=c,h.addListener=c,h.once=c,h.off=c,h.removeListener=c,h.removeAllListeners=c,h.emit=c,h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],12:[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){Array.isArray(e)||(e=[e]);for(var n in t)!function(n){n.split(/\,/g).forEach(function(a){e.forEach(function(e){e.addEventListener(a,t[n])})})}(n)}function s(e){try{(e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen).call(e)}catch(e){console.error(e),alert(w("Failed to change to fullscreen mode"))}}function c(){var e=document;(e.exitFullscreen||e.msExitFullscreen||e.mozCancelFullScreen||e.webkitCancelFullScreen).call(e)}function d(){var e=document;return!!(e.fullscreen||e.mozFullScreen||e.webkitIsFullScreen||e.msFullscreenElement)}function f(e,t){void 0==t&&(t=e);var n=void 0,a=0|e,r=a/3600|0;return t>=3600&&(a%=3600),n=[h(a/60|0),h(a%60)],t>=3600&&n.unshift(r),n.join(":")}function h(e){return e>9&&e||"0"+e}function m(e,t){for(var n in t)e.setAttribute(n,t[n])}function v(e,t,n){return e<t?t:e>n?n:e}function p(e,t){return e+Math.random()*(t-e)+.5|0}function y(e){return e instanceof Array?e.slice():void 0!==e.length?Array.prototype.slice.call(e):[].concat(r(e))}Object.defineProperty(n,"__esModule",{value:!0}),n.toArray=n.limitIn=n.setAttrs=n.padTime=n.rand=n.formatTime=n.isFullscreen=n.exitFullscreen=n.requestFullscreen=n.addEvents=n.NyaPlayerCore=void 0;var g=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),k=e("./i18n.js"),_=a(e("./danmaku.js")),b=a(e("../lib/Object2HTML/Object2HTML.js")),w=k.i18n._;window.Object2HTML=b.default;var T={muted:!1,volume:1,loop:!1,defaultDanmakuColor:null,defaultDanmakuMode:0,defaultDanmakuSize:24,danmakuSend:function(e,t){t(!1)},textStyle:{},danmakuOption:{}},x=function(e){function t(e){u(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e=n.opt=Object.assign({},T,e);var a=n.$={document:document,window:window,NP:n};n._={video:(0,b.default)({_:"video",attr:{id:"main_video"}}),playerMode:"normal"},n.container=(0,b.default)({_:"div",prop:{id:"danmaku_container"}}),n.videoFrame=(0,b.default)({_:"div",attr:{id:"video_frame"},child:[n.video,n.container,{_:"div",attr:{id:"loading_frame"},child:[{_:"div",attr:{id:"loading_anime"},child:["(๑•́ ω •̀๑)"]},{_:"div",attr:{id:"loading_info"}}]}]}),n.collectEles(n.videoFrame),n.loadingInfo(w("Loading danmaku frame")),n.Danmaku=new _.default(n),n._.loadingAnimeInterval=setInterval(function(){a.loading_anime.style.transform="translate("+p(-20,20)+"px,"+p(-20,20)+"px) rotate("+p(-10,10)+"deg)"},80),setTimeout(function(t){["src","muted","volume","loop"].forEach(function(t){void 0!==e[t]&&(n.video[t]=e[t])})},0);var r=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"loop");return Object.defineProperty(n.video,"loop",{get:r.get,set:function(e){e!==this.loop&&(this.dispatchEvent(Object.assign(new Event("_loopChange"),{value:e})),r.set.call(this,e))}}),l(n.video,{loadedmetadata:function(e){clearInterval(n._.loadingAnimeInterval),a.loading_frame.parentNode.removeChild(a.loading_frame)},error:function(e){clearInterval(n._.loadingAnimeInterval),loading_anime.style.transform="",loading_anime.innerHTML="(๑• . •๑)"}}),n.emit("coreLoad"),n}return i(t,e),g(t,[{key:"playToggle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.video.paused;this.video[e?"play":"pause"]()}},{key:"loadingInfo",value:function(e){this.$.loading_info.appendChild((0,b.default)({_:"div",child:[e]}))}},{key:"collectEles",value:function(e){var t=this.$;e.id&&!t[e.id]&&(t[e.id]=e),y(e.querySelectorAll("*")).forEach(function(e){e.id&&!t[e.id]&&(t[e.id]=e)})}},{key:"playerMode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal";if("normal"!==e||this._.playerMode!==e){switch("fullPage"===this._.playerMode?this.player.style.position="":"fullScreen"===this._.playerMode&&c(),"normal"!==e&&this._.playerMode===e&&(e="normal"),e){case"fullPage":this.player.style.position="fixed",this.player.setAttribute("playerMode","fullPage");break;case"fullScreen":this.player.setAttribute("playerMode","fullScreen"),s(this.player);break;default:this.player.setAttribute("playerMode","normal")}this._.playerMode=e,this.emit("playerModeChange",e)}}},{key:"isFullscreen",value:function(){var e=document;return(e.webkitFullscreenElement||e.msFullscreenElement||e.mozFullScreenElement||e.fullscreenElement)==this.player}},{key:"danmakuFrame",get:function(){return this.Danmaku.danmakuFrame}},{key:"player",get:function(){return this._.player}},{key:"video",get:function(){return this._.video}},{key:"src",get:function(){return this.video.src},set:function(e){this.video.src=e}},{key:"TextDanmaku",get:function(){return this.danmakuFrame.modules.TextDanmaku}},{key:"videoSize",get:function(){return[this.video.videoWidth,this.video.videoHeight]}}]),t}(function(){function e(){u(this,e),this._events={}}return g(e,[{key:"emit",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];this._resolve.apply(this,[e].concat(n)),this.globalHandle.apply(this,[e].concat(n))}},{key:"_resolve",value:function(e){for(var t=this,n=arguments.length,a=Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];if(e in this._events){var o=this._events[e];try{o.forEach(function(e){e.apply(t,a)})}catch(e){console.error(e)}}}},{key:"addEventListener",value:function(e,t){this.on(e,t)}},{key:"on",value:function(e,t){t instanceof Function&&(e in this._events||(this._events[e]=[]),this._events[e].push(t))}},{key:"removeEvent",value:function(e,t){if(e in this._events)if(1!==arguments.length){var n=void 0;(n=this._events[e].indexOf(t)>=0)&&this._events[e].splice(n,1),0===this._events[e].length&&delete this._events[e]}else delete this._events[e]}},{key:"globalHandle",value:function(e){}}]),e}());String.prototype.startsWith||(String.prototype.startsWith=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.substr(t,e.length)===e}),Object.assign||(Object.assign=function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),a=1;a<arguments.length;a++){var r=arguments[a];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])}return n}),Array.from||(Array.from=function(e,t){e instanceof Array||(e=y(e));for(var n=new Array(e.length),a=e.length;a--;)n[a]=t?t(e[a],a):e[a];return n}),Number.isInteger||(Number.isInteger=function(e){return(0|e)===e}),n.default=x,n.NyaPlayerCore=x,n.addEvents=l,n.requestFullscreen=s,n.exitFullscreen=c,n.isFullscreen=d,n.formatTime=f,n.rand=p,n.padTime=h,n.setAttrs=m,n.limitIn=v,n.toArray=y},{"../lib/Object2HTML/Object2HTML.js":1,"./danmaku.js":14,"./i18n.js":15}],13:[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t,n,a){return Math.sqrt((e-n)*(e-n)+(t-a)*(t-a))}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=e("./i18n.js"),s=e("../lib/Object2HTML/Object2HTML.js"),c=function(e){return e&&e.__esModule?e:{default:e}}(s),d=e("./NyaPCore.js"),f=l.i18n._,h={danmakuColors:["fff","6cf","ff0","f00","0f0","00f","f0f","000"],danmakuModes:[0,3,2,1],danmakuSizes:[20,24,36],dragToSeek:!0,dragToChangeVolume:!0,bottomControlHeight:50,progressBarHeight:14,progressPad:10},m=function(e){function t(e){function n(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=m[e];return(0,c.default)({_:"span",event:t,attr:n,prop:{id:"icon_span_"+e,innerHTML:'<svg height="'+i.opt.bottomControlHeight+'" width="'+i.opt.bottomControlHeight/a[1]*a[0]+'" viewBox="0,0,'+a[0]+","+a[1]+'" id="icon_'+e+'"">'+a[2]+"</svg>"}})}a(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Object.assign({},h,e)));e=o.opt;var i=o,u=i.$,l=i.video,m={play:[30,30,'<path d="m10.063,8.856l9.873,6.143l-9.873,6.143v-12.287z" stroke-width="3" stroke-linejoin="round"/>'],fullScreen:[30,30,'<rect stroke-linejoin="round" height="11.169" width="17.655" y="9.415" x="6.172" stroke-width="1.5"/><path stroke-linejoin="round" d="m12.361,11.394l-3.604,3.605l3.605,3.605l1.311,-1.311l-2.294,-2.294l2.293,-2.294l-1.311,-1.311zm5.275,0l-1.310,1.311l2.293,2.294l-2.293,2.293l1.310,1.311l3.605,-3.605l-3.605,-3.605z"/>'],loop:[30,30,'<path stroke-linejoin="round" stroke-width="1" d="m20.945,15.282c-0.204,-0.245 -0.504,-0.387 -0.823,-0.387c-0.583,0 -1.079,0.398 -1.205,0.969c-0.400,1.799 -2.027,3.106 -3.870,3.106c-2.188,0 -3.969,-1.780 -3.969,-3.969c0,-2.189 1.781,-3.969 3.969,-3.969c0.720,0 1.412,0.192 2.024,0.561l-0.334,0.338c-0.098,0.100 -0.127,0.250 -0.073,0.380c0.055,0.130 0.183,0.213 0.324,0.212l2.176,0.001c0.255,-0.002 0.467,-0.231 0.466,-0.482l-0.008,-2.183c-0.000,-0.144 -0.085,-0.272 -0.217,-0.325c-0.131,-0.052 -0.280,-0.022 -0.379,0.077l-0.329,0.334c-1.058,-0.765 -2.340,-1.182 -3.649,-1.182c-3.438,0 -6.236,2.797 -6.236,6.236c0,3.438 2.797,6.236 6.236,6.236c2.993,0 5.569,-2.133 6.126,-5.072c0.059,-0.314 -0.022,-0.635 -0.227,-0.882z"/>'],danmakuStyle:[30,30,'<path style="fill-opacity:1!important" d="m21.781,9.872l-1.500,-1.530c-0.378,-0.385 -0.997,-0.391 -1.384,-0.012l-0.959,0.941l2.870,2.926l0.960,-0.940c0.385,-0.379 0.392,-0.998 0.013,-1.383zm-12.134,7.532l2.871,2.926l7.593,-7.448l-2.872,-2.927l-7.591,7.449l0.000,0.000zm-1.158,2.571l-0.549,1.974l1.984,-0.511l1.843,-0.474l-2.769,-2.824l-0.509,1.835z" stroke-width="0"/>'],danmakuToggle:[30,30,'<path d="m8.569,10.455l0,0c0,-0.767 0.659,-1.389 1.473,-1.389l0.669,0l0,0l3.215,0l6.028,0c0.390,0 0.765,0.146 1.041,0.406c0.276,0.260 0.431,0.613 0.431,0.982l0,3.473l0,0l0,2.083l0,0c0,0.767 -0.659,1.389 -1.473,1.389l-6.028,0l-4.200,3.532l0.985,-3.532l-0.669,0c-0.813,0 -1.473,-0.621 -1.473,-1.389l0,0l0,-2.083l0,0l0,-3.473z"/>'],volume:[30,30,'<ellipse id="volume_circle" style="fill-opacity:.6!important" ry="6" rx="6" cy="15" cx="15" stroke-dasharray="38 90" stroke-width="1.8"/>'],danmakuMode0:[30,30,'<path style="fill-opacity:1!important" stroke-width="0" d="m14.981,17.821l-7.937,-2.821l7.937,-2.821l0,1.409l7.975,0l0,2.821l-7.975,0l0,1.409l0,0.002z"/>'],danmakuMode1:[30,30,'<path style="fill-opacity:1!important" stroke-width="0" d="m15.019,12.178l7.937,2.821l-7.937,2.821l0,-1.409l-7.975,0l0,-2.821l7.975,0l0,-1.409l0,-0.002z"/>'],danmakuMode3:[30,30,'<path stroke-width="3" d="m7.972,7.486l14.054,0"/>'],danmakuMode2:[30,30,'<path stroke-width="3" d="m7.972,22.513l14.054,0"/>']};i.loadingInfo(f("Creating player")),i._.player=(0,s.Object2HTML)({_:"div",attr:{class:"NyaPTouch",id:"NyaPTouch"},child:[i.videoFrame,{_:"div",prop:{id:"controls"},child:[{_:"div",prop:{id:"control_bottom"},child:[{_:"div",attr:{id:"control_bottom_first"},child:[{_:"div",attr:{id:"progress_leftside_button"},child:[n("play",{click:function(e){return i.playToggle()}})]},{_:"div",prop:{id:"progress_info"},child:[{_:"span",attr:{id:"progress_frame"},child:[{_:"div",prop:{id:"progress_wrap"},child:[{_:"div",prop:{id:"buffed_bar"}},{_:"div",prop:{id:"progress_bar"}},{_:"div",prop:{id:"seekTo_bar",hidden:!0}}]}]},{_:"span",prop:{id:"time"},child:[{_:"span",prop:{id:"current_time"},child:["00:00"]},"/",{_:"span",prop:{id:"total_time"},child:["00:00"]}]}]},{_:"span",prop:{id:"progress_rightside_button"},child:[n("fullScreen",{click:function(e){return i.playerMode("fullScreen")}})]}]},{_:"div",attr:{id:"control_bottom_second"},child:[{_:"span",attr:{id:"danmakuStyleEditor",tabindex:0},child:[n("danmakuStyle",{click:function(e){return i.danmakuStyleToggle()}}),{_:"div",attr:{id:"danmaku_size_box"}},{_:"div",attr:{id:"danmaku_mode_box"}},{_:"div",attr:{id:"danmaku_color_box"}}]},{_:"input",attr:{id:"danmaku_input",placeholder:f("Input danmaku here")}},n("danmakuToggle",{click:function(e){return o.Danmaku.toggle()}}),n("loop",{click:function(e){return l.loop=!l.loop}}),n("volume",{click:function(e){return l.muted=!l.muted}})]}]}]}]}),i.videoFrame.appendChild((0,c.default)({_:"div",attr:{id:"msg_box"}})),i.collectEles(i._.player),Object.assign(i._,{currentDragMode:null,touchStartPoint:[0,0],bottomControlDraging:void 0,bottomControlTransformY:0,preVideoStat:!1,volumeBox:new v("","info",u.msg_box)}),Object.assign(u.progress_wrap.style,{left:i.opt.progressPad+"px",right:i.opt.progressPad+"px",height:i.opt.progressBarHeight+"px",marginTop:-i.opt.progressBarHeight/2+1+"px"}),u.control_bottom.style.marginTop="-"+i.opt.bottomControlHeight+"px",y.touchdrag(u.main_video,{allowMultiTouch:!1,preventDefaultX:!0}),y.touchdrag(u.control_bottom,{allowMultiTouch:!1,preventDefaultY:!0}),e.danmakuSizes&&e.danmakuSizes.forEach(function(e,t){var n=(0,c.default)({_:"span",attr:{style:"font-size:"+(16+3*t)+"px;",title:e},prop:{size:e},child:["A"]});u.danmaku_size_box.appendChild(n)}),e.danmakuColors&&e.danmakuColors.forEach(function(e){var t=(0,c.default)({_:"span",attr:{style:"background-color:#"+e+";",title:e},prop:{color:e}});u.danmaku_color_box.appendChild(t)}),e.danmakuModes&&e.danmakuModes.forEach(function(e){u.danmaku_mode_box.appendChild(n("danmakuMode"+e))}),i.collectEles(u.danmaku_mode_box);var p={document:{"fullscreenchange,mozfullscreenchange,webkitfullscreenchange,msfullscreenchange":function(e){"fullScreen"!=i._.playerMode||i.isFullscreen()||i.playerMode("normal")},visibilitychange:function(e){document.hidden&&(i._.preVideoStat=!1)}},main_video:{playing:function(e){return i._iconActive("play",!0)},"pause,stalled":function(e){i._iconActive("play",!1)},loadedmetadata:function(e){i._setTimeInfo(null,(0,d.formatTime)(l.duration,l.duration))},_loopChange:function(e){return i._iconActive("loop",e.value)},volumechange:function(e){i._.volumeBox.renew(f("volume")+":"+(100*l.volume).toFixed(0)+"%"+(l.muted?"("+f("muted")+")":"")),(0,d.setAttrs)(u.volume_circle,{"stroke-dasharray":12*l.volume*Math.PI+" 90",style:"fill-opacity:"+(l.muted?.2:.6)+"!important"})},progress:function(e){return i.drawProgress()},click:function(e){e.preventDefault(),i.controlsToggle()},dblclick:function(e){return i.playToggle()},timeupdate:function(e){Date.now()-i._.lastTimeUpdate<30||(i._setTimeInfo((0,d.formatTime)(l.currentTime,l.duration)),i.drawProgress(),i._.lastTimeUpdate=Date.now())},touchstart:function(e){var t=e.changedTouches[0];i._.currentDragMode||(i._.touchStartPoint=[t.clientX,t.clientY])},touchmove:function(e){i._.currentDragMode&&e.preventDefault()},touchdrag:function(t){switch(i._.currentDragMode||e.dragToSeek&&Math.abs(t.deltaX)>Math.abs(t.deltaY)&&(i._.currentDragMode="seek",i._.seekTo=l.currentTime),i._.currentDragMode){case"volume":l.volume=(0,d.limitIn)(l.volume-t.deltaY/200,0,1);break;case"seek":var n=1+Math.abs(t.touches[0].clientY-i._.touchStartPoint[1])/5;i._.seekTo=(0,d.limitIn)(i._.seekTo+t.deltaX/100*n,0,l.duration),i.emit("seekMark",i._.seekTo)}},touchend:function(e){"seek"===i._.currentDragMode&&(l.currentTime=i._.seekTo,u.progress_bar.style.width=(i._.seekTo/l.duration*100).toFixed(2)+"%",i.$.seekTo_bar.hidden=!0,i._setTimeInfo(null,(0,d.formatTime)(l.duration,l.duration))),i._.currentDragMode=null},contextmenu:function(t){t.preventDefault(),e.dragToChangeVolume&&(i._.currentDragMode="volume",i._.volumeBox.renew(f("volume")+":"+(100*l.volume).toFixed(0)+"%"+(l.muted?"("+f("muted")+")":"")))}},control_bottom:{touchdrag:function(e){void 0===i._.bottomControlDraging&&(i._.bottomControlDraging=Math.abs(e.deltaY)>Math.abs(e.deltaX)),i._.bottomControlDraging&&i._bottomControlTransformY((0,d.limitIn)(i._.bottomControlTransformY-e.deltaY,0,u.control_bottom.offsetHeight-i.opt.bottomControlHeight))},touchend:function(e){if(void 0!=i._.bottomControlDraging){i._.bottomControlDraging=void 0;var t=u.control_bottom.offsetHeight-i.opt.bottomControlHeight;i._bottomControlTransformY(i._.bottomControlTransformY<t/2?0:t)}}},progress_frame:{click:function(e){var t=e.target,n=i.opt.progressPad,a=(0,d.limitIn)((e.offsetX-n)/(t.offsetWidth-2*n),0,1);l.currentTime=a*l.duration}},danmaku_input:{keydown:function(e){"Enter"==e.key&&i.send()},focus:function(e){i._.preVideoStat=!l.paused,l.pause(),i.isFullscreen()&&(u.control_bottom.style.top=0,i._bottomControlTransformY(0))},blur:function(e){setTimeout(function(){i._.preVideoStat&&l.play()},100),""!=u.control_bottom.style.top&&(u.control_bottom.style.top="",i._bottomControlTransformY(u.control_bottom.offsetHeight-i.opt.bottomControlHeight))}},danmakuStyleEditor:{blur:function(e){return i.danmakuStyleToggle(!1)}},danmaku_mode_box:{click:function(e){var t=e.target;if(t.id.startsWith("icon_span_danmakuMode")){var n=1*t.id.match(/\d$/)[0];void 0!==i._.danmakuMode&&u["icon_span_danmakuMode"+i._.danmakuMode].classList.remove("active"),u["icon_span_danmakuMode"+n].classList.add("active"),i._.danmakuMode=n}}},danmaku_size_box:{click:function(e){var t=e.target;t.size&&((0,d.toArray)(u.danmaku_size_box.childNodes).forEach(function(e){i._.danmakuSize===e.size&&e.classList.remove("active")}),t.classList.add("active"),i._.danmakuSize=t.size)}},danmaku_color_box:{click:function(e){if(e.target.color){var t=i.Danmaku.isVaildColor(e.target.color);t?(i._.danmakuColor=t,(0,d.toArray)(u.danmaku_color_box.childNodes).forEach(function(t){t===e.target?t.classList.add("active"):t.classList.remove("active")})):(i._.danmakuColor=void 0,t=i.Danmaku.isVaildColor(i.opt.defaultDanmakuColor),(0,d.toArray)(u.danmaku_color_box.childNodes).forEach(function(e){return e.classList.remove("active")}))}}},NP:{danmakuFrameToggle:function(e){return o._iconActive("danmakuToggle",e)},seekMark:function(e){u.seekTo_bar.hidden&&(u.seekTo_bar.hidden=!1),u.seekTo_bar.style.width=(e/l.duration*100).toFixed(2)+"%",i._setTimeInfo(null,(0,d.formatTime)(e,l.duration))},playerModeChange:function(e){["fullScreen"].forEach(function(t){i._iconActive(t,e===t)})}}};for(var g in u){var k=p[g];k&&(0,d.addEvents)(u[g],k)}return Number.isInteger(e.defaultDanmakuMode)&&u["icon_span_danmakuMode"+e.defaultDanmakuMode].click(),"number"==typeof e.defaultDanmakuSize&&(0,d.toArray)(u.danmaku_size_box.childNodes).forEach(function(t){t.size===e.defaultDanmakuSize&&t.click()}),i.danmakuFrame.modules.TextDanmaku.enabled&&i._iconActive("danmakuToggle",!0),e.playerFrame instanceof HTMLElement&&e.playerFrame.appendChild(i.player),o}return o(t,e),u(t,[{key:"send",value:function(){var e=this,t={color:this._.danmakuColor||this.opt.defaultDanmakuColor,text:this.$.danmaku_input.value,size:this._.danmakuSize,mode:this._.danmakuMode,time:this.danmakuFrame.time};this.Danmaku.send(t,function(t){t&&"text"===t._&&(e.$.danmaku_input.value=""),e.danmakuFrame.modules.TextDanmaku.load(t,e.video.paused).highlight=!0})}},{key:"controlsToggle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.$.controls.hidden;this.$.controls.hidden=!e}},{key:"danmakuStyleToggle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.$.danmakuStyleEditor.style.overflow;this.$.danmakuStyleEditor.style.overflow=e?"initial":""}},{key:"_bottomControlTransformY",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._.bottomControlTransformY;this._.bottomControlTransformY=e,this.$.control_bottom.style.transform="translate3d(0,-"+e+"px,0)"}},{key:"drawProgress",value:function(){var e=this;requestAnimationFrame(function(){var t=e.video,n=t.buffered,a=t.duration,r=0;n.length&&(r=n.end(n.length-1)),e.$.buffed_bar.style.width=(r/a*100).toFixed(2)+"%",e.$.progress_bar.style.width=(t.currentTime/a*100).toFixed(2)+"%"})}},{key:"_iconActive",value:function(e,t){this.$["icon_span_"+e].classList[t?"add":"remove"]("active_icon")}},{key:"_setTimeInfo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;requestAnimationFrame(function(){null!==t&&(e.$.current_time.innerHTML=t),null!==n&&(e.$.total_time.innerHTML=n)})}},{key:"msg",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"tip",n=new v(e,t,this.$.msg_box);requestAnimationFrame(function(){return n.show()})}}]),t}(d.NyaPlayerCore),v=function(){function e(t,n,r){var o=this;a(this,e),this.using=!1,(this.msg=(0,c.default)({_:"div",attr:{class:"msg_type_"+n}})).addEventListener("click",function(){return o.remove()}),this.parentNode=r,this.setText(t)}return u(e,[{key:"setTimeout",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=this;this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){return t.remove()},e||Math.max(.6*(this.texts?this.texts.length:0)*1e3,5e3))})},{key:"setText",value:function(e){this.msg.innerHTML="";var t=e instanceof Node?e:(0,s.Object2HTML)(e);this.msg.appendChild(t),e instanceof HTMLElement&&(e=e.textContent);var n=String(e).match(/\w+|\S/g);this.text=e,this.texts=n}},{key:"renew",value:function(e){this.setText(e),this.setTimeout(),this.using||this.show()}},{key:"show",value:function(){var e=this;this.using||(this.msg.style.opacity=0,this.parentNode&&this.parentNode!==this.msg.parentNode&&this.parentNode.appendChild(this.msg),this.msg.parentNode&&setTimeout(function(){e.using=!0,e.msg.style.opacity=1},0),this.setTimeout())}},{key:"remove",value:function(){var e=this;this.using&&(this.using=!1,this.msg.style.opacity=0,this.timeout&&(clearTimeout(this.timeout),this.timeout=0),setTimeout(function(){e.msg.parentNode&&e.msg.parentNode.removeChild(e.msg)},600))}}]),e}(),p={touchdrag:{preventDefault:!1,preventDefaultX:!1,preventDefaultY:!1,allowMultiTouch:!1},doubletouch:{preventDefault:!0}},y={touchdrag:function(e,t){var n={};t=Object.assign({},p.touchdrag,t),e.addEventListener("touchstart",function(e){if(!t.allowMultiTouch&&e.changedTouches.length>1)n={};else for(var a=e.changedTouches,r=a.length;r--;)n[a[r].identifier]=[a[r].clientX,a[r].clientY]}),e.addEventListener("touchmove",function(a){if(t.allowMultiTouch||!(a.touches.length>1))for(var r=a.changedTouches,o=r.length;o--;){var i=r[o].identifier;if(!(!i in n)){var u=new TouchEvent("touchdrag",a);u.deltaX=r[o].clientX-n[i][0],u.deltaY=r[o].clientY-n[i][1],n[i]=[r[o].clientX,r[o].clientY],(t.preventDefault||t.preventDefaultX&&Math.abs(u.deltaX)>Math.abs(u.deltaY)||t.preventDefaultY&&Math.abs(u.deltaX)<Math.abs(u.deltaY))&&a.preventDefault(),e.dispatchEvent(u)}}})},doubletouch:function(e,t){var n=[],a=0,r=!1,o=!1,u=!1;return t=Object.assign({},p.doubletouch,t),e.addEventListener("touchstart",function(l){var s=l.touches.length>1?(0,d.toArray)(l.touches):[l.touches[0]],c=n;if(n=s,u){if(l.timeStamp-a>400)return void(u=!1)}else a=l.timeStamp,u=!0;if(s.length===c.length&&o){for(var f=[],h=s.length;h--;)f.push([c[h].clientX,c[h].clientY]);for(var m=s.length;m--;)for(var v=f.length;v--;)i(s[m].clientX,s[m].clientY,f[v][0],f[v][1])<=6&&f.splice(v,1);if(0===f.length){t.preventDefault&&l.preventDefault();var p=new TouchEvent("doubletouch",l);p.points=s.length,e.dispatchEvent(p),u=o=!1,r=!0}}}),e.addEventListener("touchend",function(e){0!==e.touches.length||r||(o=!0),r=!1}),listeners}};window.NyaPTouch=m},{"../lib/Object2HTML/Object2HTML.js":1,"./NyaPCore.js":12,"./i18n.js":15}],14:[function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=e("../lib/danmaku-frame/src/danmaku-frame.js"),i=function(e){return e&&e.__esModule?e:{default:e}}(e("../lib/danmaku-text/src/danmaku-text.js")),u=e("./NyaPCore.js");(0,i.default)(o.DanmakuFrame,o.DanmakuFrameModule);var l=["color","text","size","mode","time"],s=function(){function e(t){a(this,e),this.core=t,this.danmakuFrame=new o.DanmakuFrame(t.container),this.danmakuFrame.setMedia(t.video),this.danmakuFrame.enable("TextDanmaku"),this.setTextDanmakuOptions(t.opt.danmakuOption),this.setDefaultTextStyle(t.opt.textStyle)}return r(e,[{key:"load",value:function(e){return this.danmakuFrame.load(e)}},{key:"loadList",value:function(e){this.danmakuFrame.loadList(e)}},{key:"remove",value:function(e){this.danmakuFrame.unload(e)}},{key:"enable",value:function(){this.danmakuFrame.enable(),this.core.emit("danmakuFrameToggle",name,this.module(name).enabled)}},{key:"disable",value:function(){this.danmakuFrame.enable()}},{key:"toggle",value:function(e,t){if("boolean"==typeof e||void 0==e)return t=void 0!=e?e:!this.danmakuFrame.enabled,this.danmakuFrame[t?"enable":"disable"](),void this.core.emit("danmakuFrameToggle",t);try{void 0==t&&(t=!this.module(e).enabled),this.danmakuFrame[t?"enable":"disable"](e),this.core.emit("danmakuModuleToggle",e,this.module(e).enabled)}catch(e){return console.error(e),!1}return!0}},{key:"at",value:function(e,t){return this.module("TextDanmaku").danmakuAt(e,t)}},{key:"module",value:function(e){return this.danmakuFrame.modules[e]}},{key:"send",value:function(e,t){var n=!0,a=!1,r=void 0;try{for(var o,i=l[Symbol.iterator]();!(n=(o=i.next()).done);n=!0)if(o.value in e==!1)return!1}catch(e){a=!0,r=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw r}}return!(e.text||"").match(/^\s*$/)&&(e.color=this.isVaildColor(e.color),e.color?e.color=e.color.replace(/\$/g,function(){return"0123456789abcdef"[(0,u.limitIn)(16*Math.random()|0,0,15)]}):e.color=null,this.core.opt.danmakuSend instanceof Function&&(this.core.opt.danmakuSend(e,t||function(){}),!0))}},{key:"isVaildColor",value:function(e){return"string"==typeof e&&(!!(e=e.match(/^\#?(([\da-f\$]{3}){1,2})$/i))&&e[1])}},{key:"setDefaultTextStyle",value:function(e){if(e)for(var t in e)this.module("TextDanmaku").defaultStyle[t]=e[t]}},{key:"setTextDanmakuOptions",value:function(e){if(e)for(var t in e)this.module("TextDanmaku").options[t]=e[t]}}]),e}();n.default=s},{"../lib/danmaku-frame/src/danmaku-frame.js":3,"../lib/danmaku-text/src/danmaku-text.js":6,"./NyaPCore.js":12}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a={lang:null,langs:{},_:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=a.lang&&a.langs[a.lang][e]||e;return n.length&&n.forEach(function(e,t){o=o.replace("$"+t,e)}),o}};a.langs["zh-CN"]={play:"播放",Send:"发送",pause:"暂停",muted:"静音",volume:"音量",settings:"设置","loop(L)":"循环(L)","hex color":"Hex颜色","full page(P)":"全页模式(P)","Creating player":"创建播放器","full screen(F)":"全屏模式(F)","danmaku toggle(D)":"弹幕开关(D)","Input danmaku here":"在这里输入弹幕","Loading danmaku frame":"加载弹幕框架","danmaku input(Enter)":"弹幕输入框(回车)","volume($0)([shift]+↑↓)":"音量($0)([shift]+↑↓)","Failed to change to fullscreen mode":"无法切换到全屏模式"},navigator.languages||(navigator.languages=[navigator.language||navigator.browserLanguage]);for(var r=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(navigator.languages)),o=0;o<r.length;o++){var i=r[o];if(a.langs[i]){a.lang=i;break}var u=i.match(/^\w+/)[0];for(var l in a.langs)if(l.startsWith(u)){a.lang=l;break}if(a.lang)break}console.debug("Language:"+a.lang),n.i18n=a},{}]},{},[13]);