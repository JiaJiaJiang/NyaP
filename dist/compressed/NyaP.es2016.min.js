!function e(t,n,i){function a(r,s){if(!n[r]){if(!t[r]){var u="function"==typeof require&&require;if(!s&&u)return u(r,!0);if(o)return o(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[r]={exports:{}};t[r][0].call(d.exports,function(e){var n=t[r][1][e];return a(n||e)},d,d.exports,e,t,n,i)}return n[r].exports}for(var o="function"==typeof require&&require,r=0;r<i.length;r++)a(i[r]);return a}({1:[function(e,t,n){"use strict";function i(e){return"object"==typeof e}function a(e,t){let n,o,r;if("string"==typeof e||"number"==typeof e)n=document.createTextNode(e);else if(e instanceof Node)n=e;else if(null===e||"object"!=typeof e||"_"in e==!1||"string"!=typeof e._||""==e._)return;if(n||(n=document.createElement(e._)),i(e.attr))for(o in e.attr)n.setAttribute(o,e.attr[o]);if(i(e.prop))for(o in e.prop)n[o]=e.prop[o];if(i(e.event))for(o in e.event)n.addEventListener(o,e.event[o]);return i(e.child)&&e.child.length>0&&e.child.forEach(e=>{r=a(e,t);r instanceof Node&&n.appendChild(r)}),t&&t(n),n}Object.defineProperty(n,"__esModule",{value:!0}),n.default=a,n.Object2HTML=a},{}],2:[function(e,t,n){"use strict";!function(e,i){"function"==typeof define&&define.amd?define(i):"object"==typeof n?t.exports=i():e.ResizeSensor=i()}(void 0,function(){function e(e,t){var n=Object.prototype.toString.call(e),i="[object Array]"===n||"[object NodeList]"===n||"[object HTMLCollection]"===n||"[object Object]"===n||"undefined"!=typeof jQuery&&e instanceof jQuery||"undefined"!=typeof Elements&&e instanceof Elements,a=0,o=e.length;if(i)for(;a<o;a++)t(e[a]);else t(e)}if("undefined"==typeof window)return null;var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,20)},n=function(i,a){function o(){var e=[];this.add=function(t){e.push(t)};var t,n;this.call=function(){for(t=0,n=e.length;t<n;t++)e[t].call()},this.remove=function(i){var a=[];for(t=0,n=e.length;t<n;t++)e[t]!==i&&a.push(e[t]);e=a},this.length=function(){return e.length}}function r(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.style[t]}function s(e,n){if(e.resizedAttached)e.resizedAttached.add(n);else{e.resizedAttached=new o,e.resizedAttached.add(n),e.resizeSensor=document.createElement("div"),e.resizeSensor.className="resize-sensor";var i="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;",a="position: absolute; left: 0; top: 0; transition: 0s;";e.resizeSensor.style.cssText=i,e.resizeSensor.innerHTML='<div class="resize-sensor-expand" style="'+i+'"><div style="'+a+'"></div></div><div class="resize-sensor-shrink" style="'+i+'"><div style="'+a+' width: 200%; height: 200%"></div></div>',e.appendChild(e.resizeSensor),"static"==r(e,"position")&&(e.style.position="relative");var s,u,l,d,c=e.resizeSensor.childNodes[0],h=c.childNodes[0],f=e.resizeSensor.childNodes[1],m=e.offsetWidth,p=e.offsetHeight,g=function(){h.style.width="100000px",h.style.height="100000px",c.scrollLeft=1e5,c.scrollTop=1e5,f.scrollLeft=1e5,f.scrollTop=1e5};g();var y=function(){u=0,s&&(m=l,p=d,e.resizedAttached&&e.resizedAttached.call())},k=function(){l=e.offsetWidth,d=e.offsetHeight,(s=l!=m||d!=p)&&!u&&(u=t(y)),g()},_=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)};_(c,"scroll",k),_(f,"scroll",k)}}e(i,function(e){s(e,a)}),this.detach=function(e){n.detach(i,e)}};return n.detach=function(t,n){e(t,function(e){e.resizedAttached&&"function"==typeof n&&(e.resizedAttached.remove(n),e.resizedAttached.length())||e.resizeSensor&&(e.contains(e.resizeSensor)&&e.removeChild(e.resizeSensor),delete e.resizeSensor,delete e.resizedAttached)})},n})},{}],3:[function(e,t,n){"use strict";function i(e,t={}){for(let n in t)n.split(/\,/g).forEach(i=>e.addEventListener(i,t[n]))}Object.defineProperty(n,"__esModule",{value:!0}),n.ResizeSensor=n.DanmakuFrameModule=n.DanmakuFrame=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(e("../lib/ResizeSensor.js"));class o{constructor(e){const t=this;t.container=e||document.createElement("div"),t.rate=1,t.timeBase=t.width=t.height=t.fps=0,t.fpsTmp=0,t.fpsRec=t.fps||60,t.media=null,t.working=!1,t.enabled=!0,t.modules={};const n=document.createElement("style");document.head.appendChild(n),t.styleSheet=n.sheet,setTimeout(()=>{t.container.ResizeSensor=new a.default(t.container,()=>{t.resize()});t.resize()},0),setInterval(()=>{t.fpsRec=t.fpsTmp;t.fpsTmp=0},1e3),t.draw=t.draw.bind(t)}enable(e){if(!e)return this.enabled=!0,this.media?this.media.paused||this.start():this.start(),void(this.container.hidden=!1);let t=this.modules[e]||this.initModule(e);return!!t&&(t.enabled=!0,t.enable&&t.enable(),!0)}disable(e){if(!e)return this.pause(),this.moduleFunction("clear"),this.enabled=!1,void(this.container.hidden=!0);let t=this.modules[e];return!!t&&(t.enabled=!1,t.disable&&t.disable(),!0)}addStyle(e){"string"==typeof e&&(e=[e]),e instanceof Array!=!1&&e.forEach(e=>this.styleSheet.insertRule(e,this.styleSheet.cssRules.length))}initModule(e,t){if(this.modules[e])return console.warn(`The module [${e}] has already inited.`),this.modules[e];let n=o.availableModules[e];if(!n)throw"Module ["+e+"] does not exist.";let i=new n(this,t);if(i instanceof r==!1)throw"Constructor of "+e+" is not extended from DanmakuFrameModule";return this.modules[e]=i,console.debug(`Mod Inited: ${e}`),i}set time(e){this.media||(this.timeBase=Date.now()-e),this.moduleFunction("time",e)}get time(){return this.media?1e3*this.media.currentTime|0:Date.now()-this.timeBase}draw(e){this.working&&(this.fpsTmp++,this.moduleFunction("draw",e),0===this.fps?requestAnimationFrame(()=>this.draw()):setTimeout(this.draw,1e3/this.fps))}load(...e){this.moduleFunction("load",...e)}loadList(e){this.moduleFunction("loadList",e)}unload(e){this.moduleFunction("unload",e)}start(){!this.working&&this.enabled&&(this.working=!0,this.moduleFunction("start"),this.draw(!0))}pause(){this.enabled&&(this.working=!1,this.moduleFunction("pause"))}resize(){this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.moduleFunction("resize")}moduleFunction(e,...t){let n;for(let i in this.modules)(n=this.modules[i]).enabled&&n[e]&&n[e](...t)}setMedia(e){const t=this;t.media=e,i(e,{playing:()=>t.start(),"pause,stalled,seeking":()=>t.pause(),ratechange:()=>{t.rate=t.media.playbackRate;t.moduleFunction("rate",t.rate)}}),t.moduleFunction("media",e)}static addModule(e,t){e in this.availableModules?console.warn('The module "'+e+'" has already been added.'):this.availableModules[e]=t}}o.availableModules={};class r{constructor(e){this.frame=e,this.enabled=!1}}n.DanmakuFrame=o,n.DanmakuFrameModule=r,n.ResizeSensor=a.default},{"../lib/ResizeSensor.js":2}],4:[function(e,t,n){"use strict";!function(e){"function"==typeof define&&define.amd?define(e):"object"==typeof n?t.exports=e():(0,eval)("this").Mat=e()}(function(){function e(t){class i{constructor(e,n,a=0){this.array=new t(e*n),Object.defineProperty(this.array,"row",{value:e}),Object.defineProperty(this.array,"column",{value:n}),3==arguments.length&&(i._instanceofTypedArray&&0===a||("number"==typeof a?this.fill(a):a.length&&this.set(a)))}get length(){return this.array.length}get row(){return this.array.row}get column(){return this.array.column}leftMultiply(e){return this.set(i.multiply(e,this,new i(e.row,this.column)))}rightMultiply(e){return this.set(i.multiply(this,e,new i(this.row,e,column)))}fill(e){arguments.length||(e=0);for(let t=this.length;t--;)this.array[t]=e;return this}set(e,t){t||(t=0),e instanceof i&&(e=e.array);for(let n=e.length+t<=this.length?e.length:this.length-t;n--;)this.array[t+n]=e[n];return this}put(e,t,n){return i.put(this,e,t||0,n||0),this}rotate2d(e){return this.set(i.rotate2d(this,e,i.Matrixes.T3))}translate2d(e,t){return this.set(i.translate2d(this,e,t,i.Matrixes.T3))}scale2d(e,t){return this.set(i.scale2d(this,e,t,i.Matrixes.T3))}rotate3d(e,t,n){return this.set(i.rotate3d(this,e,t,n,i.Matrixes.T4))}scale3d(e,t,n){return this.set(i.scale3d(this,e,t,n,i.Matrixes.T4))}translate3d(e,t,n){return this.set(i.translate3d(this,e,t,n,i.Matrixes.T4))}rotateX(e){return this.set(i.rotateX(this,e,i.Matrixes.T4))}rotateY(e){return this.set(i.rotateY(this,e,i.Matrixes.T4))}rotateZ(e){return this.set(i.rotateZ(this,e,i.Matrixes.T4))}clone(){return new i(this.row,this.column,this)}toString(){if(0===this.length)return"";for(var e=0,t=[],n=[];e<this.length;e++)e&&e%this.column==0&&(t.push(n.join("\t")),n.length=0),n.push(this.array[e]||0);return t.push(n.join("\t")),t.join("\n")}static Identity(e){let t=new i(e,e,0);for(let n=e;n--;)t.array[n*e+n]=1;return t}static Perspective(e,t,n,a,o){var r=n*Math.tan(e*Math.PI/360),s=r*t,u=o||new i(4,4,0),l=u.array;return l[0]=2*n/(s+s),l[5]=2*n/(r+r),l[10]=-(a+n)/(a-n),l[14]=-2*a*n/(a-n),l[11]=-1,o&&(l[1]=l[2]=l[3]=l[4]=l[6]=l[7]=l[8]=l[9]=l[12]=l[13]=l[15]=0),u}static multiply(e,t,n){if(e.column!==t.row)throw"wrong matrix";let a,o,r,s=e.row,u=Math.min(e.column,t.column),l=n||new i(s,u);for(let n=s;n--;)for(a=u;a--;)for(l.array[r=n*l.column+a]=0,o=e.column;o--;)l.array[r]+=e.array[n*e.column+o]*t.array[a+o*t.column];return l}static multiplyString(e,t,n,a=!0){if(e.column!==t.row)throw"wrong matrix";var o,r,s,u,l=n||new i(e.row,t.column);for(o=e.row;o--;)for(r=t.column;r--;)for(l.array[u=o*t.column+r]="",s=0;s<e.column;s++)(!a||0!=e.array[o*e.column+s]&&0!=t.array[r+s*t.column])&&(l.array[u]+=(s&&l.array[u]?"+":"")+"("+e.array[o*e.column+s]+")*("+t.array[r+s*t.column]+")");return l}static add(e,t,n){if(e.column!==t.column||e.row!==t.row)throw"wrong matrix";let a=n||new i(e.row,t.column);for(let n=e.length;n--;)a.array[n]=e.array[n]+t.array[n];return a}static minus(e,t,n){if(e.column!==t.column||e.row!==t.row)throw"wrong matrix";let a=n||new i(e.row,t.column);for(let n=e.length;n--;)a.array[n]=e.array[n]-t.array[n];return a}static rotate2d(e,t,n){const a=i.Matrixes.rotate2d;return a.array[0]=a.array[4]=Math.cos(t),a.array[1]=-(a.array[3]=Math.sin(t)),i.multiply(a,e,n||new i(3,3))}static scale2d(e,t,n,a){const o=i.Matrixes.scale2d;return o.array[0]=t,o.array[4]=n,i.multiply(o,e,a||new i(3,3))}static translate2d(e,t,n,a){const o=i.Matrixes.translate2d;return o.array[2]=t,o.array[5]=n,i.multiply(o,e,a||new i(3,3))}static rotate3d(e,t,n,a,o){const r=Math.cos(t),s=Math.sin(t),u=Math.cos(n),l=Math.sin(n),d=Math.cos(a),c=Math.sin(a),h=i.Matrixes.rotate3d;return h.array[0]=d*u,h.array[1]=d*l*s-c*r,h.array[2]=d*l*r+c*s,h.array[4]=c*u,h.array[5]=c*l*s+d*r,h.array[6]=c*l*r-d*s,h.array[8]=-l,h.array[9]=u*s,h.array[10]=u*r,i.multiply(h,e,o||new i(4,4))}static rotateX(e,t,n){const a=i.Matrixes.rotateX;return a.array[10]=a.array[5]=Math.cos(t),a.array[6]=-(a.array[9]=Math.sin(t)),i.multiply(a,e,n||new i(4,4))}static rotateY(e,t,n){const a=i.Matrixes.rotateY;return a.array[10]=a.array[0]=Math.cos(t),a.array[8]=-(a.array[2]=Math.sin(t)),i.multiply(a,e,n||new i(4,4))}static rotateZ(e,t,n){const a=i.Matrixes.rotateZ;return a.array[5]=a.array[0]=Math.cos(t),a.array[1]=-(a.array[4]=Math.sin(t)),i.multiply(a,e,n||new i(4,4))}static scale3d(e,t,n,a,o){const r=i.Matrixes.scale3d;return r.array[0]=t,r.array[5]=n,r.array[10]=a,i.multiply(r,e,o||new i(4,4))}static translate3d(e,t,n,a,o){const r=i.Matrixes.translate3d;return r.array[12]=t,r.array[13]=n,r.array[14]=a,i.multiply(r,e,o||new i(4,4))}static put(e,t,n,i){let a;n||(n=0),i||(i=0);for(let o=t.row;o--;)if(!(o+n>=e.row))for(a=t.column;a--;)a+i>=e.column||(e.array[(o+n)*e.column+a+i]=t.array[o*t.column+a])}static createClass(t){return e(t)}}var a=new t(1);return Object.defineProperty(i,"_instanceofTypedArray",{value:!(!n||!n.isPrototypeOf(a))}),a=null,i.Matrixes={I2:i.Identity(2),I3:i.Identity(3),I4:i.Identity(4),T3:new i(3,3,0),T4:new i(4,4,0),rotate2d:i.Identity(3),translate2d:i.Identity(3),scale2d:i.Identity(3),translate3d:i.Identity(4),rotate3d:i.Identity(4),rotateX:i.Identity(4),rotateY:i.Identity(4),rotateZ:i.Identity(4),scale3d:i.Identity(4)},i}const t=(0,eval)("this"),n=t.Float32Array&&t.Float32Array.prototype;return e(t.Float32Array?Float32Array:Array)})},{}],5:[function(e,t,n){(function(e,t){"use strict";!function(t,n){function i(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return l[u]=i,s(u),u++}function a(e){delete l[e]}function o(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i)}}function r(e){if(d)setTimeout(r,0,e);else{var t=l[e];if(t){d=!0;try{o(t)}finally{a(e),d=!1}}}}if(!t.setImmediate){var s,u=1,l={},d=!1,c=t.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(t);h=h&&h.setTimeout?h:t,"[object process]"==={}.toString.call(t.process)?function(){s=function(t){e.nextTick(function(){r(t)})}}():function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?function(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&r(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),s=function(n){t.postMessage(e+n,"*")}}():t.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){r(e.data)},s=function(t){e.port2.postMessage(t)}}():c&&"onreadystatechange"in c.createElement("script")?function(){var e=c.documentElement;s=function(t){var n=c.createElement("script");n.onreadystatechange=function(){r(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():function(){s=function(e){setTimeout(r,0,e)}}(),h.setImmediate=i,h.clearImmediate=a}}("undefined"==typeof self?void 0===t?void 0:t:self)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:11}],6:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){function n(e,t,n,i,a=!1){if(0===e.length)return 0;let o=n,r=i;for(;n<=i;)t<=e[o=n+i>>1].time?i=o-1:n=o+1;if(a)for(;n>0&&e[n-1].time===t;)n--;else for(;n<=r&&e[n].time===t;)n++;return n}const i=Object.defineProperty,a=window.requestIdleCallback||setImmediate;let l=!1;class d extends t{constructor(e,t={}){super(e);const n=this;n.list=[],n.indexMark=0,n.tunnel=new h,n.paused=!0,n.randomText=`danmaku_text_${999999*Math.random()|0}`,n.cacheCleanTime=0,n.danmakuMoveTime=0,n.danmakuCheckTime=0,n.danmakuCheckSwitch=!0,n.defaultStyle={fontStyle:null,fontWeight:300,fontVariant:null,color:"#fff",fontSize:24,fontFamily:"Arial",strokeWidth:1,strokeColor:"#888",shadowBlur:5,textAlign:"start",shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0,fill:!0},n.options={allowLines:!1,screenLimit:0,clearWhenTimeReset:!0,speed:6.5,autoShiftRenderingMode:!0},t.defaultStyle&&Object.assign(this.defaultStyle,t.defaultStyle),t.options&&Object.assign(this.options,t.options),e.addStyle(`.${n.randomText}_fullfill{top:0;left:0;width:100%;height:100%;position:absolute;}`),i(n,"rendererMode",{configurable:!0}),i(n,"activeRendererMode",{configurable:!0,value:null});const a=n.container=document.createElement("div");a.classList.add(`${n.randomText}_fullfill`),e.container.appendChild(a),n.text2d=new r.default(n),n.text3d=new s.default(n),n.textCanvas=new u.default(n),n.textCanvasContainer.hidden=n.canvas.hidden=n.canvas3d.hidden=!0,n.modes={1:n.textCanvas,2:n.text2d,3:n.text3d},n.GraphCache=[],n.DanmakuText=[],n.renderingDanmakuManager=new m(n),o(document,{visibilitychange:e=>{n.danmakuCheckSwitch=!document.hidden;document.hidden||n.recheckIndexMark()}}),n._checkNewDanmaku=n._checkNewDanmaku.bind(n),n._cleanCache=n._cleanCache.bind(n),setInterval(n._cleanCache,5e3),n.setRendererMode(1)}setRendererMode(e){const t=this;return!!(t.rendererMode!==e&&e in t.modes&&t.modes[e].supported)&&(t.activeRendererMode&&t.activeRendererMode.disable(),i(t,"activeRendererMode",{value:t.modes[e]}),i(t,"rendererMode",{value:e}),t.activeRendererMode.resize(),t.activeRendererMode.enable(),console.log("rendererMode:",t.rendererMode),!0)}media(e){const t=this;o(e,{seeked:()=>{t.time();t._clearScreen(!0)},seeking:()=>t.pause()})}start(){this.paused=!1,this.activeRendererMode.start()}pause(){this.paused=!0,this.activeRendererMode.pause()}load(e,t){if(!e||"text"!==e._)return!1;if("string"!=typeof e.text)return console.error("wrong danmaku object:",e),!1;e.time;let i,a=this.list;return i=n(a,e.time,0,a.length-1,!1),a.splice(i,0,e),i<this.indexMark&&this.indexMark++,"object"!=typeof e.style&&(e.style={}),e.style.fontSize=e.style.fontSize?e.style.fontSize+.5|0:this.defaultStyle.fontSize,(isNaN(e.style.fontSize)||e.style.fontSize===1/0||0===e.style.fontSize)&&(e.style.fontSize=this.defaultStyle.fontSize),"number"!=typeof e.mode&&(e.mode=0),t&&console.log(i,this.indexMark),t&&i<this.indexMark&&this._addNewDanmaku(e),e}loadList(e){e.forEach(e=>this.load(e))}unload(e){if(!e||"text"!==e._)return!1;const t=this,n=t.list.indexOf(e);return!(n<0)&&(t.list.splice(n,1),n<t.indexMark&&t.indexMark--,!0)}_checkNewDanmaku(e){if(this.paused&&!e)return;let t,n=this,i=n.frame.time;if(n.danmakuCheckTime!==i&&n.danmakuCheckSwitch){if(n.list.length)for(;n.indexMark<n.list.length&&(t=n.list[n.indexMark])&&t.time<=i;n.indexMark++)n.options.screenLimit>0&&n.DanmakuText.length>=n.options.screenLimit||n._addNewDanmaku(t);n.danmakuCheckTime=i}}_addNewDanmaku(e){const t=this,n=t.height,i=t.width;let a=t.GraphCache.length?t.GraphCache.shift():new c;a.danmaku=e,a.drawn=!1,a.text=t.options.allowLines?e.text:e.text.replace(/\n/g," "),a.time=e.time,a.font=Object.create(t.defaultStyle),Object.assign(a.font,e.style),a.font.lineHeight||(a.font.lineHeight=a.font.fontSize+2||1),e.style.color&&a.font.color&&"#"!==a.font.color[0]&&(a.font.color="#"+e.style.color),e.mode>1&&(a.font.textAlign="center"),a.prepare(3!==t.rendererMode);const o=t.tunnel.getTunnel(a,n);let r=(o<0?0:o)%n;switch(e.mode){case 0:case 1:case 3:a.style.y=r;break;case 2:a.style.y=n-r-a.style.height-1}switch(e.mode){case 0:a.style.x=i;break;case 1:a.style.x=-a.style.width;break;case 2:case 3:a.style.x=(i-a.style.width)/2}t.renderingDanmakuManager.add(a),t.activeRendererMode.newDanmaku(a)}_calcSideDanmakuPosition(e,t=this.frame.time){let n=!e.danmaku.mode,i=e.style;return(n?this.frame.width:-i.width)+(n?-1:1)*this.frame.rate*(i.width+1024)*(t-e.time)*this.options.speed/6e4}_calcDanmakusPosition(e){let t=this,n=t.frame.time;if(t.paused&&!e)return;const i=t.width,a=t.frame.rate;let o,r,s,u,l;for(t.danmakuMoveTime=n,r=t.DanmakuText.length;r--;)if((s=t.DanmakuText[r]).time>n)t.removeText(s);else switch(u=s.style,s.danmaku.mode){case 0:case 1:if(o=!s.danmaku.mode,u.x=l=t._calcSideDanmakuPosition(s,n),s.tunnelNumber>=0&&(o&&l+u.width+10<i||!o&&l>10))t.tunnel.removeMark(s);else if(o&&l<-u.width-20||!o&&l>i+u.width+20){t.removeText(s);continue}break;case 2:case 3:n-s.time>1e3*t.options.speed/a&&t.removeText(s)}}_cleanCache(e){const t=this,n=Date.now();if(t.GraphCache.length>30||e)for(let i=0;i<t.GraphCache.length&&(e||n-t.GraphCache[i].removeTime>1e4);i++)t.activeRendererMode.deleteTextObject(t.GraphCache[i]),t.GraphCache.splice(i,1)}draw(e){!e&&this.paused||!this.enabled||(this._calcDanmakusPosition(e),this.activeRendererMode.draw(e),requestAnimationFrame(()=>{this._checkNewDanmaku(e)}))}removeText(e){this.renderingDanmakuManager.remove(e),this.tunnel.removeMark(e),e._bitmap=e.danmaku=null,e.removeTime=Date.now(),this.GraphCache.push(e),this.activeRendererMode.remove(e)}resize(){this.activeRendererMode&&this.activeRendererMode.resize(),this.draw(!0)}_clearScreen(e){this.activeRendererMode&&this.activeRendererMode.clear(e)}clear(){for(let e,t=this.DanmakuText.length;t--;)(e=this.DanmakuText[t]).danmaku&&this.removeText(e);this.tunnel.reset(),this._clearScreen(!0)}recheckIndexMark(e=this.frame.time){this.indexMark=n(this.list,e,0,this.list.length-1,!0)}rate(e){this.activeRendererMode&&this.activeRendererMode.rate(e)}time(e=this.frame.time){this.recheckIndexMark(e),this.options.clearWhenTimeReset?this.clear():this.resetTimeOfDanmakuOnScreen()}resetTimeOfDanmakuOnScreen(e){void 0===e&&(e=this.frame.time),this.DanmakuText.forEach(t=>{if(!t.danmaku)return;t.time=e-(this.danmakuMoveTime-t.time)})}danmakuAt(e,t){const n=[];return this.enabled?(this.DanmakuText.forEach(i=>{if(!i.danmaku)return;i.style.x<=e&&i.style.x+i.style.width>=e&&i.style.y<=t&&i.style.y+i.style.height>=t&&n.push(i.danmaku)}),n):n}enable(){this.textCanvasContainer.hidden=!1,this.frame.working&&this.start()}disable(){this.textCanvasContainer.hidden=!0,this.pause(),this.clear()}set useImageBitmap(e){l="function"==typeof createImageBitmap&&e}get useImageBitmap(){return l}get width(){return this.frame.width}get height(){return this.frame.height}}class c{constructor(e=""){const t=this;t._fontString="",t._renderList=null,t.style={},t.font={},t.text=e,t._renderToCache=t._renderToCache.bind(t),i(t,"_cache",{configurable:!0})}prepare(e=!1){const t=this;t._cache||i(t,"_cache",{value:document.createElement("canvas")});let n=[];t.font.fontStyle&&n.push(t.font.fontStyle),t.font.fontVariant&&n.push(t.font.fontVariant),t.font.fontWeight&&n.push(t.font.fontWeight),n.push(`${t.font.fontSize}px`),t.font.fontFamily&&n.push(t.font.fontFamily),t._fontString=n.join(" ");const o=t._cache,r=o.ctx2d||(o.ctx2d=o.getContext("2d"));r.font=t._fontString,t._renderList=t.text.split(/\n/g),t.estimatePadding=Math.max(t.font.shadowBlur+5+Math.max(Math.abs(t.font.shadowOffsetY),Math.abs(t.font.shadowOffsetX)),t.font.strokeWidth+3);let s,u=0,l="number"==typeof t.font.lineHeight?t.font.lineHeight:t.font.fontSize;for(let e=t._renderList.length;e--;)(s=r.measureText(t._renderList[e]).width)>u&&(u=s);o.width=(t.style.width=u)+2*t.estimatePadding,o.height=(t.style.height=t._renderList.length*l)+(l<t.font.fontSize?2*t.font.fontSize:0)+2*t.estimatePadding,r.translate(t.estimatePadding,t.estimatePadding),e?a(t._renderToCache):t._renderToCache()}_renderToCache(){const e=this;e.danmaku&&(e.render(e._cache.ctx2d),l&&(e._bitmap&&(e._bitmap.close(),e._bitmap=null),createImageBitmap(e._cache).then(t=>{e._bitmap=t})))}render(e){const t=this;if(!t._renderList)return;e.save(),t.danmaku.highlight&&(e.fillStyle="rgba(255,255,255,0.3)",e.beginPath(),e.rect(0,0,t.style.width,t.style.height),e.fill()),e.font=t._fontString,e.textBaseline="middle",e.lineWidth=t.font.strokeWidth,e.fillStyle=t.font.color,e.strokeStyle=t.font.strokeColor,e.shadowBlur=t.font.shadowBlur,e.shadowColor=t.font.shadowColor,e.shadowOffsetX=t.font.shadowOffsetX,e.shadowOffsetY=t.font.shadowOffsetY,e.textAlign=t.font.textAlign;let n,i="number"==typeof t.font.lineHeight?t.font.lineHeight:t.font.fontSize;switch(t.font.textAlign){case"left":case"start":n=0;break;case"center":n=t.style.width/2;break;case"right":case"end":n=t.style.width}for(let a=t._renderList.length;a--;)t.font.strokeWidth&&e.strokeText(t._renderList[a],n,i*(a+.5)),t.font.fill&&e.fillText(t._renderList[a],n,i*(a+.5));e.restore()}}class h{constructor(){this.reset()}reset(){this.right={},this.left={},this.bottom={},this.top={}}getTunnel(e,t){let n=this.tunnel(e.danmaku.mode),i=e.style.height,a=0,o=-1;if(("number"!=typeof i||i<=0)&&(console.error("Incorrect size:"+i),i=24),i>t)return 0;for(;o<0;)for(let e=a+i-1;a<=e;){if(n[a]){a+=n[a].tunnelHeight;break}if(0!==a&&a%(t-1)==0){a++;break}if(a===e){o=a-i+1;break}a++}return e.tunnelNumber=o,e.tunnelHeight=e.style.y+i>t?1:i,this.addMark(e),o}addMark(e){let t=this.tunnel(e.danmaku.mode);t[e.tunnelNumber]||(t[e.tunnelNumber]=e)}removeMark(e){let t,n=e.tunnelNumber;n>=0&&(t=this.tunnel(e.danmaku.mode))[n]===e&&(delete t[n],e.tunnelNumber=-1)}tunnel(e){return this[f[e]]}}const f=["right","left","bottom","top"];class m{constructor(e){this.dText=e,this.totalArea=0,this.limitArea=1/0,e.text2d.supported&&(this.timer=setInterval(()=>this.rendererModeCheck(),1500))}add(e){this.dText.DanmakuText.push(e),this.totalArea+=e._cache.width*e._cache.height}remove(e){let t=this.dText.DanmakuText.indexOf(e);t>=0&&(this.dText.DanmakuText.splice(t,1),this.totalArea-=e._cache.width*e._cache.height)}rendererModeCheck(){let e=this.dText;this.dText.options.autoShiftRenderingMode&&!e.paused&&(e.frame.fpsRec<.95*(e.frame.fps||60)?this.limitArea>this.totalArea&&(this.limitArea=this.totalArea):this.limitArea<this.totalArea&&(this.limitArea=this.totalArea),1==e.rendererMode&&this.totalArea>this.limitArea?e.text2d.supported&&e.setRendererMode(2):2==e.rendererMode&&this.totalArea<.5*this.limitArea&&e.textCanvas.supported&&e.setRendererMode(1))}}e.addModule("TextDanmaku",d)}function o(e,t={}){for(let n in t)n.split(/\,/g).forEach(i=>e.addEventListener(i,t[n]))}Object.defineProperty(n,"__esModule",{value:!0}),e("../lib/setImmediate/setImmediate.js");var r=i(e("./text2d.js")),s=i(e("./text3d.js")),u=i(e("./textCanvas.js"));n.default=a},{"../lib/setImmediate/setImmediate.js":5,"./text2d.js":7,"./text3d.js":8,"./textCanvas.js":9}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(e("./textModuleTemplate.js"));class a extends i.default{constructor(e){super(e),this.supported=!1,e.canvas=document.createElement("canvas"),e.context2d=e.canvas.getContext("2d"),e.context2d?(e.canvas.classList.add(`${e.randomText}_fullfill`),e.canvas.id=`${e.randomText}_text2d`,e.container.appendChild(e.canvas),this.supported=!0):console.warn("text 2d not supported")}draw(e){let t,n,i,a,o=this.dText.context2d,r=o.canvas.width,s=this.dText.DanmakuText,u=s.length;const l=this.dText.useImageBitmap;for(o.globalCompositeOperation="destination-over",this.clear(e);u--;)(t=s[u]).drawn||(t.drawn=!0),i=(n=t.style.x-t.estimatePadding)+t._cache.width,n>r||i<0||(!l&&r>=t._cache.width?o.drawImage(t._bitmap||t._cache,n,t.style.y-t.estimatePadding):(a=t._cache.width+(n<0?n:0)-(i>r?i-r:0),o.drawImage(t._bitmap||t._cache,n<0?-n:0,0,a,t._cache.height,n<0?0:n,t.style.y-t.estimatePadding,a,t._cache.height)))}clear(e){const t=this.dText;if(e||this._evaluateIfFullClearMode())t.context2d.clearRect(0,0,t.canvas.width,t.canvas.height);else for(let e,n=t.DanmakuText.length;n--;)(e=t.DanmakuText[n]).drawn&&t.context2d.clearRect(e.style.x-e.estimatePadding,e.style.y-e.estimatePadding,e._cache.width,e._cache.height)}_evaluateIfFullClearMode(){if(this.dText.DanmakuText.length>3)return!0;let e=this.dText.GraphCache[this.dText.GraphCache.length-1];return!(!e||!e.drawn)&&(e.drawn=!1,!0)}resize(){let e=this.dText,t=e.canvas;t.width=e.width,t.height=e.height}enable(){this.draw(),this.dText.useImageBitmap=!(this.dText.canvas.hidden=!1)}disable(){this.dText.canvas.hidden=!0,this.clear(!0)}}n.default=a},{"./textModuleTemplate.js":10}],8:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var a=i(e("../lib/Mat/Mat.js")),o=i(e("./textModuleTemplate.js"));const r=window.requestIdleCallback||setImmediate;class s extends o.default{constructor(e){function t(e){var t=i.createShader(a[e][0]);if(i.shaderSource(t,a[e][1]),i.compileShader(t),!i.getShaderParameter(t,i.COMPILE_STATUS))throw"An error occurred compiling the shaders: "+i.getShaderInfoLog(t);return t}super(e),this.supported=!1;let n=this.c3d=e.canvas3d=document.createElement("canvas");if(n.classList.add(`${e.randomText}_fullfill`),n.id=`${e.randomText}_text3d`,e.context3d=n.getContext("webgl")||n.getContext("experimental-webgl"),!e.context3d)return void console.warn("text 3d not supported");e.container.appendChild(n);const i=this.gl=e.context3d;var a={danmakuFrag:[i.FRAGMENT_SHADER,`\n\t\t\t\t#pragma optimize(on)\n\t\t\t\tprecision lowp float;\n\t\t\t\tvarying lowp vec2 vDanmakuTexCoord;\n\t\t\t\tuniform sampler2D uSampler;\n\t\t\t\tvoid main(void) {\n\t\t\t\t\tvec4 co=texture2D(uSampler,vDanmakuTexCoord);\n\t\t\t\t\tif(co.a == 0.0)discard;\n\t\t\t\t\tgl_FragColor = co;\n\t\t\t\t}`],danmakuVert:[i.VERTEX_SHADER,`\n\t\t\t\t#pragma optimize(on)\n\t\t\t\tattribute vec2 aVertexPosition;\n\t\t\t\tattribute vec2 aDanmakuTexCoord;\n\t\t\t\tuniform mat4 u2dCoordinate;\n\t\t\t\tvarying lowp vec2 vDanmakuTexCoord;\n\t\t\t\tvoid main(void) {\n\t\t\t\t\tgl_Position = u2dCoordinate * vec4(aVertexPosition,0,1);\n\t\t\t\t\tvDanmakuTexCoord = aDanmakuTexCoord;\n\t\t\t\t}`]},o=t("danmakuFrag"),r=t("danmakuVert"),s=this.shaderProgram=i.createProgram();i.attachShader(s,r),i.attachShader(s,o),i.linkProgram(s),i.getProgramParameter(s,i.LINK_STATUS)?(i.useProgram(s),i.clearColor(0,0,0,0),i.enable(i.BLEND),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA),this.maxTexSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.uSampler=i.getUniformLocation(s,"uSampler"),this.u2dCoord=i.getUniformLocation(s,"u2dCoordinate"),this.aVertexPosition=i.getAttribLocation(s,"aVertexPosition"),this.atextureCoord=i.getAttribLocation(s,"aDanmakuTexCoord"),i.enableVertexAttribArray(this.aVertexPosition),i.enableVertexAttribArray(this.atextureCoord),this.commonTexCoordBuffer=i.createBuffer(),this.commonVertCoordBuffer=i.createBuffer(),i.activeTexture(i.TEXTURE0),i.uniform1i(this.uSampler,0),this.supported=!0):console.error("Unable to initialize the shader program.")}draw(e){const t=this.gl,n=this.dText.DanmakuText.length;let i,a,o,r=this.c3d.width;for(let e,s=0;s<n;s++)(e=this.dText.DanmakuText[s])&&e.glDanmaku&&(a=(i=e.style.x-e.estimatePadding)+e._cache.width,o=e._cache.width+(i<0?i:0)-(a>r?a-r:0),i>r||a<0||(e.vertCoord[0]=e.vertCoord[4]=i<0?0:i,e.vertCoord[2]=e.vertCoord[6]=e.vertCoord[0]+o,t.bindBuffer(t.ARRAY_BUFFER,this.commonVertCoordBuffer),t.bufferData(t.ARRAY_BUFFER,e.vertCoord,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.aVertexPosition,2,t.FLOAT,!1,0,0),u[0]=u[4]=i<0?-i/e._cache.width:0,u[2]=u[6]=u[0]+o/e._cache.width,t.bindBuffer(t.ARRAY_BUFFER,this.commonTexCoordBuffer),t.bufferData(t.ARRAY_BUFFER,u,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.atextureCoord,2,t.FLOAT,!1,0,0),t.bindTexture(t.TEXTURE_2D,e.texture),t.drawArrays(t.TRIANGLE_STRIP,0,4)));t.flush()}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}deleteTextObject(e){const t=this.gl;e.texture&&t.deleteTexture(e.texture)}resize(e,t){const n=this.gl,i=this.c3d;i.width=this.dText.width,i.height=this.dText.height,n.viewport(0,0,i.width,i.height),n.uniformMatrix4fv(this.u2dCoord,!1,a.default.Identity(4).translate3d(-1,1,0).scale3d(2/i.width,-2/i.height,0).array)}enable(){this.dText.DanmakuText.forEach(e=>{this.newDanmaku(e,!1)}),this.dText.useImageBitmap=this.c3d.hidden=!1,requestAnimationFrame(()=>this.draw())}disable(){this.clear(),this.c3d.hidden=!0}newDanmaku(e,t=!0){const n=this.gl;if(e.glDanmaku=!1,e._cache.height>this.maxTexSize||e._cache.width>this.maxTexSize)return void console.warn("Ignore a danmaku width too large size",e.danmaku);let i;(i=e.texture)||(i=e.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),t?r(()=>{n.bindTexture(n.TEXTURE_2D,i);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e._cache);e.glDanmaku=!0}):(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e._cache),e.glDanmaku=!0);let a=e.style.y-e.estimatePadding;e.vertCoord=new Float32Array([0,a,0,a,0,a+e._cache.height,0,a+e._cache.height])}}const u=new Float32Array([0,0,1,0,0,1,1,1]);n.default=s},{"../lib/Mat/Mat.js":4,"./textModuleTemplate.js":10}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(e("./textModuleTemplate.js"));class a extends i.default{constructor(e){super(e),this.supported=e.text2d.supported,this.supported&&(e.frame.addStyle([`#${e.randomText}_textCanvasContainer canvas{will-change:transform;top:0;left:0;position:absolute;}`,`#${e.randomText}_textCanvasContainer.moving canvas{transition:transform 500s linear;}`,`#${e.randomText}_textCanvasContainer{will-change:transform;pointer-events:none;overflow:hidden;}`]),this.container=e.textCanvasContainer=document.createElement("div"),this.container.classList.add(`${e.randomText}_fullfill`),this.container.id=`${e.randomText}_textCanvasContainer`,e.container.appendChild(this.container))}_toggle(e){let t=this.dText,n=t.frame.time;this.container.classList[e?"add":"remove"]("moving");for(let i,a=t.DanmakuText.length;a--;)(i=t.DanmakuText[a]).danmaku.mode>=2||(e?requestAnimationFrame(()=>this._move(i)):this._move(i,n))}pause(){this._toggle(!1)}start(){this._toggle(!0)}rate(){this.resetPos()}_move(e,t){e.danmaku&&(void 0===t&&(t=this.dText.frame.time+5e5),e._cache.style.transform=`translate3d(${(10*(this.dText._calcSideDanmakuPosition(e,t)-e.estimatePadding)|0)/10}px,${e.style.y-e.estimatePadding}px,0)`)}resetPos(){this.pause(),this.dText.paused||requestAnimationFrame(()=>this.start())}resize(){this.resetPos()}remove(e){e._cache.parentNode&&this.container.removeChild(e._cache)}enable(){requestAnimationFrame(()=>{this.dText.DanmakuText.forEach(e=>this.newDanmaku(e))}),this.container.hidden=!1}disable(){this.container.hidden=!0,this.container.innerHTML=""}newDanmaku(e){e._cache.style.transform=`translate3d(${e.style.x-e.estimatePadding}px,${e.style.y-e.estimatePadding}px,0)`,this.container.appendChild(e._cache),e.danmaku.mode<2&&!this.dText.paused&&requestAnimationFrame(()=>this._move(e))}}n.default=a},{"./textModuleTemplate.js":10}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i{constructor(e){this.dText=e}draw(){}rate(){}pause(){}start(){}clear(){}resize(){}remove(){}enable(){}disable(){}newDanmaku(){}deleteTextObject(){}}n.default=i},{}],11:[function(e,t,n){function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(c===setTimeout)return setTimeout(e,0);if((c===i||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function r(e){if(h===clearTimeout)return clearTimeout(e);if((h===a||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function s(){g&&m&&(g=!1,m.length?p=m.concat(p):y=-1,p.length&&u())}function u(){if(!g){var e=o(s);g=!0;for(var t=p.length;t;){for(m=p,p=[];++y<t;)m&&m[y].run();y=-1,t=p.length}m=null,g=!1,r(e)}}function l(e,t){this.fun=e,this.array=t}function d(){}var c,h,f=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:i}catch(e){c=i}try{h="function"==typeof clearTimeout?clearTimeout:a}catch(e){h=a}}();var m,p=[],g=!1,y=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new l(e,t)),1!==p.length||g||o(u)},l.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=d,f.addListener=d,f.once=d,f.off=d,f.removeListener=d,f.removeAllListeners=d,f.emit=d,f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],12:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var a=e("./i18n.js"),o=i(e("../lib/Object2HTML/Object2HTML.js")),r=e("./NyaPCore.js"),s=i(e("../lib/danmaku-frame/lib/ResizeSensor.js"));const u=a.i18n._,l={autoHideDanmakuInput:!0,danmakuColors:["fff","6cf","ff0","f00","0f0","00f","f0f","000"],danmakuModes:[0,3,2,1],danmakuSizes:[20,24,36]};class d extends r.NyaPlayerCore{constructor(e){function t(e,t,n={}){const i=d[e];return(0,o.default)({_:"span",event:t,attr:n,prop:{id:`icon_span_${e}`,innerHTML:`<svg height=${i[1]} width=${i[0]} id="icon_${e}"">${i[2]}</svg>`}})}super(Object.assign({},l,e)),e=this.opt;const n=this,i=this.$,a=this.video,d=this.icons={play:[30,30,'<path d="m10.063,8.856l9.873,6.143l-9.873,6.143v-12.287z" stroke-width="3" stroke-linejoin="round"/>'],addDanmaku:[30,30,'<path style="fill-opacity:0!important;" stroke-width="1.4" d="m21.004,8.995c-0.513,-0.513 -1.135,-0.770 -1.864,-0.770l-8.281,0c-0.729,0 -1.350,0.256 -1.864,0.770c-0.513,0.513 -0.770,1.135 -0.770,1.864l0,8.281c0,0.721 0.256,1.341 0.770,1.858c0.513,0.517 1.135,0.776 1.864,0.776l8.281,0c0.729,0 1.350,-0.258 1.864,-0.776c0.513,-0.517 0.770,-1.136 0.770,-1.858l0,-8.281c0,-0.729 -0.257,-1.350 -0.770,-1.864z" stroke-linejoin="round"/><path d="m12.142,14.031l1.888,0l0,-1.888l1.937,0l0,1.888l1.888,0l0,1.937l-1.888,0l0,1.888l-1.937,0l0,-1.888l-1.888,0l0,-1.937z" stroke-width="1"/>'],danmakuToggle:[30,30,'<path d="m8.569,10.455l0,0c0,-0.767 0.659,-1.389 1.473,-1.389l0.669,0l0,0l3.215,0l6.028,0c0.390,0 0.765,0.146 1.041,0.406c0.276,0.260 0.431,0.613 0.431,0.982l0,3.473l0,0l0,2.083l0,0c0,0.767 -0.659,1.389 -1.473,1.389l-6.028,0l-4.200,3.532l0.985,-3.532l-0.669,0c-0.813,0 -1.473,-0.621 -1.473,-1.389l0,0l0,-2.083l0,0l0,-3.473z"/>'],danmakuStyle:[30,30,'<path style="fill-opacity:1!important" d="m21.781,9.872l-1.500,-1.530c-0.378,-0.385 -0.997,-0.391 -1.384,-0.012l-0.959,0.941l2.870,2.926l0.960,-0.940c0.385,-0.379 0.392,-0.998 0.013,-1.383zm-12.134,7.532l2.871,2.926l7.593,-7.448l-2.872,-2.927l-7.591,7.449l0.000,0.000zm-1.158,2.571l-0.549,1.974l1.984,-0.511l1.843,-0.474l-2.769,-2.824l-0.509,1.835z" stroke-width="0"/>'],fullScreen:[30,30,'<path stroke-linejoin="round" d="m11.166,9.761l-5.237,5.239l5.237,5.238l1.905,-1.905l-3.333,-3.333l3.332,-3.333l-1.904,-1.906zm7.665,0l-1.903,1.905l3.332,3.333l-3.332,3.332l1.903,1.905l5.238,-5.238l-5.238,-5.237z" stroke-width="1.3" />'],fullPage:[30,30,'<rect stroke-linejoin="round" height="11.169" width="17.655" y="9.415" x="6.172" stroke-width="1.5"/><path stroke-linejoin="round" d="m12.361,11.394l-3.604,3.605l3.605,3.605l1.311,-1.311l-2.294,-2.294l2.293,-2.294l-1.311,-1.311zm5.275,0l-1.310,1.311l2.293,2.294l-2.293,2.293l1.310,1.311l3.605,-3.605l-3.605,-3.605z"/>'],loop:[30,30,'<path stroke-linejoin="round" stroke-width="1" d="m20.945,15.282c-0.204,-0.245 -0.504,-0.387 -0.823,-0.387c-0.583,0 -1.079,0.398 -1.205,0.969c-0.400,1.799 -2.027,3.106 -3.870,3.106c-2.188,0 -3.969,-1.780 -3.969,-3.969c0,-2.189 1.781,-3.969 3.969,-3.969c0.720,0 1.412,0.192 2.024,0.561l-0.334,0.338c-0.098,0.100 -0.127,0.250 -0.073,0.380c0.055,0.130 0.183,0.213 0.324,0.212l2.176,0.001c0.255,-0.002 0.467,-0.231 0.466,-0.482l-0.008,-2.183c-0.000,-0.144 -0.085,-0.272 -0.217,-0.325c-0.131,-0.052 -0.280,-0.022 -0.379,0.077l-0.329,0.334c-1.058,-0.765 -2.340,-1.182 -3.649,-1.182c-3.438,0 -6.236,2.797 -6.236,6.236c0,3.438 2.797,6.236 6.236,6.236c2.993,0 5.569,-2.133 6.126,-5.072c0.059,-0.314 -0.022,-0.635 -0.227,-0.882z"/>'],volume:[30,30,'<ellipse id="volume_circle" style="fill-opacity:.6!important" ry="6" rx="6" cy="15" cx="15" stroke-dasharray="38 90" stroke-width="1.8"/>'],danmakuMode0:[30,30,'<path style="fill-opacity:1!important" stroke-width="0" d="m14.981,17.821l-7.937,-2.821l7.937,-2.821l0,1.409l7.975,0l0,2.821l-7.975,0l0,1.409l0,0.002z"/>'],danmakuMode1:[30,30,'<path style="fill-opacity:1!important" stroke-width="0" d="m15.019,12.178l7.937,2.821l-7.937,2.821l0,-1.409l-7.975,0l0,-2.821l7.975,0l0,-1.409l0,-0.002z"/>'],danmakuMode3:[30,30,'<path stroke-width="3" d="m7.972,7.486l14.054,0"/>'],danmakuMode2:[30,30,'<path stroke-width="3" d="m7.972,22.513l14.054,0"/>']};if(Object.assign(d,e.icons),n.loadingInfo(u("Creating player")),n._.player=(0,o.default)({_:"div",attr:{class:"NyaP",id:"NyaP",tabindex:0},child:[n.videoFrame,{_:"div",attr:{id:"controls"},child:[{_:"div",attr:{id:"control"},child:[{_:"span",attr:{id:"control_left"},child:[t("play",{click:e=>n.playToggle()},{title:u("play")})]},{_:"span",attr:{id:"control_center"},child:[{_:"div",prop:{id:"progress_info"},child:[{_:"span",child:[{_:"canvas",prop:{id:"progress",pad:10}}]},{_:"span",prop:{id:"time"},child:[{_:"span",prop:{id:"current_time"},child:["00:00"]},"/",{_:"span",prop:{id:"total_time"},child:["00:00"]}]}]},{_:"div",prop:{id:"danmaku_input_frame"},child:[{_:"span",prop:{id:"danmaku_style"},child:[{_:"div",attr:{id:"danmaku_style_pannel"},child:[{_:"div",attr:{id:"danmaku_color_box"}},{_:"input",attr:{id:"danmaku_color",placeholder:u("hex color"),maxlength:"6"}},{_:"span",attr:{id:"danmaku_mode_box"}},{_:"span",attr:{id:"danmaku_size_box"}}]},t("danmakuStyle")]},{_:"input",attr:{id:"danmaku_input",placeholder:u("Input danmaku here")}},{_:"span",prop:{id:"danmaku_submit",innerHTML:u("Send")}}]}]},{_:"span",attr:{id:"control_right"},child:[t("addDanmaku",{click:e=>n.danmakuInput()},{title:u("danmaku input(Enter)")}),t("danmakuToggle",{click:e=>n.Danmaku.toggle()},{title:u("danmaku toggle(D)"),class:"active_icon"}),t("volume",{},{title:u("volume($0)([shift]+↑↓)","100%")}),t("loop",{click:e=>{a.loop=!a.loop}},{title:u("loop")+"(L)"}),{_:"span",prop:{id:"player_mode"},child:[t("fullScreen",{click:e=>n.playerMode("fullScreen")},{title:u("full screen(F)")}),t("fullPage",{click:e=>n.playerMode("fullPage")},{title:u("full page(P)")})]}]}]}]}]}),n.videoFrame.appendChild((0,o.default)({_:"div",attr:{id:"msg_box"}})),n.collectEles(n._.player),Object.assign(n._,{volumeBox:new c("","info",i.msg_box)}),this._danmakuEnabled)e.danmakuSizes&&e.danmakuSizes.forEach((e,t)=>{let n=(0,o.default)({_:"span",attr:{style:`font-size:${12+3*t}px;`,title:e},prop:{size:e},child:["A"]});i.danmaku_size_box.appendChild(n)}),e.danmakuColors&&e.danmakuColors.forEach(e=>{let t=(0,o.default)({_:"span",attr:{style:`background-color:#${e};`,title:e},prop:{color:e}});i.danmaku_color_box.appendChild(t)}),e.danmakuModes&&e.danmakuModes.forEach(e=>{i.danmaku_mode_box.appendChild(t(`danmakuMode${e}`))}),n.collectEles(i.danmaku_mode_box);else for(let e in i)e.match(/danmaku/i)&&i[e].parentNode.removeChild(i[e]);setTimeout(()=>{i.control.ResizeSensor=new s.default(i.control,()=>n.refreshProgress());n.refreshProgress()},0),n._.progressContext=i.progress.getContext("2d");const h={NyaP:{keydown:e=>n._playerKeyHandle(e)},document:{"fullscreenchange,mozfullscreenchange,webkitfullscreenchange,msfullscreenchange":e=>{"fullScreen"!=n._.playerMode||this.isFullscreen()||n.playerMode("normal")}},main_video:{playing:e=>n._iconActive("play",!0),"pause,stalled":e=>{n._iconActive("play",!1)},timeupdate:e=>{if(Date.now()-n._.lastTimeUpdate<30)return;n._setTimeInfo((0,r.formatTime)(a.currentTime,a.duration));n.drawProgress();n._.lastTimeUpdate=Date.now()},loadedmetadata:e=>{n._setTimeInfo(null,(0,r.formatTime)(a.duration,a.duration))},volumechange:e=>{n._.volumeBox.renew(`${u("volume")}:${(100*a.volume).toFixed(0)}%`+`${a.muted?"("+u("muted")+")":""}`,3e3);(0,r.setAttrs)(i.volume_circle,{"stroke-dasharray":`${12*a.volume*Math.PI} 90`,style:`fill-opacity:${a.muted?.2:.6}!important`});i.icon_span_volume.setAttribute("title",u("volume($0)([shift]+↑↓)",a.muted?u("muted"):`${100*a.volume|0}%`))},progress:e=>n.drawProgress(),_loopChange:e=>n._iconActive("loop",e.value),click:e=>n.playToggle(),contextmenu:e=>e.preventDefault()},danmaku_container:{click:e=>n.playToggle(),contextmenu:e=>e.preventDefault()},progress:{"mousemove,click":e=>{let t=e.target,i=(0,r.limitIn)((e.offsetX-t.pad)/(t.offsetWidth-2*t.pad),0,1);"mousemove"===e.type?(n._.progressX=e.offsetX,n.drawProgress(),n._setTimeInfo(null,(0,r.formatTime)(i*a.duration,a.duration))):"click"===e.type&&(a.currentTime=i*a.duration)},mouseout:e=>{n._.progressX=void 0;n.drawProgress();n._setTimeInfo(null,(0,r.formatTime)(a.duration,a.duration))}},danmaku_style_pannel:{click:e=>{"INPUT"!==e.target.tagName&&setImmediate(e=>n.$.danmaku_input.focus())}},danmaku_color:{"input,change":e=>{let t=e.target,i=n.Danmaku.isVaildColor(t.value);i?(t.style.backgroundColor=`#${i}`,n._.danmakuColor=i):(n._.danmakuColor=void 0,i=n.Danmaku.isVaildColor(n.opt.defaultDanmakuColor),t.style.backgroundColor=i?`#${i}`:"")}},icon_span_volume:{click:e=>a.muted=!a.muted,wheel:e=>{e.preventDefault();if(0!==e.deltaMode)return;let t;t=e.deltaY>10||e.deltaY<-10?-e.deltaY/10:e.deltaY;e.shiftKey&&(t=t>0?10:-10);a.volume=(0,r.limitIn)(a.volume+t/100,0,1)}},danmaku_input:{keydown:e=>{"Enter"===e.key?n.send():"Escape"===e.key&&n.danmakuInput(!1)}},danmaku_submit:{click:e=>n.send()},danmaku_mode_box:{click:e=>{let t=e.target;if(t.id.startsWith("icon_span_danmakuMode")){let e=1*t.id.match(/\d$/)[0];void 0!==n._.danmakuMode&&i[`icon_span_danmakuMode${n._.danmakuMode}`].classList.remove("active"),i[`icon_span_danmakuMode${e}`].classList.add("active"),n._.danmakuMode=e}}},danmaku_size_box:{click:e=>{let t=e.target;if(!t.size)return;(0,r.toArray)(i.danmaku_size_box.childNodes).forEach(e=>{n._.danmakuSize===e.size&&e.classList.remove("active")});t.classList.add("active");n._.danmakuSize=t.size}},danmaku_color_box:{click:e=>{e.target.color&&(i.danmaku_color.value=e.target.color,i.danmaku_color.dispatchEvent(new Event("change")))}},NP:{danmakuFrameToggle:e=>n._iconActive("danmakuToggle",e),playerModeChange:e=>{["fullPage","fullScreen"].forEach(t=>{n._iconActive(t,e===t)})}}};for(let e in i){let t=h[e];t&&(0,r.addEvents)(i[e],t)}n._danmakuEnabled&&(Number.isInteger(e.defaultDanmakuMode)&&i["icon_span_danmakuMode"+e.defaultDanmakuMode].click(),"number"==typeof e.defaultDanmakuSize&&(0,r.toArray)(i.danmaku_size_box.childNodes).forEach(t=>{t.size===e.defaultDanmakuSize&&t.click()})),e.playerFrame instanceof HTMLElement&&e.playerFrame.appendChild(n.player)}_iconActive(e,t){this.$[`icon_span_${e}`].classList[t?"add":"remove"]("active_icon")}_setTimeInfo(e=null,t=null){requestAnimationFrame(()=>{null!==e&&(this.$.current_time.innerHTML=e);null!==t&&(this.$.total_time.innerHTML=t)})}_playerKeyHandle(e){if("INPUT"===e.target.tagName)return;const t=this.video,n=e.shiftKey,i=e.repeat;switch(e.key){case" ":if(i)return;this.playToggle();break;case"ArrowRight":t.currentTime+=3*(n?2:1);break;case"ArrowLeft":t.currentTime-=1.5*(n?2:1);break;case"ArrowUp":t.volume=(0,r.limitIn)(t.volume+.03*(n?2:1),0,1);break;case"ArrowDown":t.volume=(0,r.limitIn)(t.volume-.03*(n?2:1),0,1);break;case"p":if(i)return;this.playerMode("fullPage");break;case"f":this.playerMode("fullScreen");break;case"d":if(i)return;this._danmakuEnabled&&this.Danmaku.toggle();break;case"m":if(i)return;this.video.muted=!this.video.muted;break;case"l":this.video.loop=!this.video.loop;break;case"Enter":if(i)return;this._danmakuEnabled&&this.danmakuInput();break;case"Escape":if("fullPage"===this._.playerMode){this.playerMode("normal");break}return;default:return}e.preventDefault()}danmakuInput(e=!this.$.danmaku_input_frame.offsetHeight){let t=this.$;t.danmaku_input_frame.style.display=e?"flex":"",this._iconActive("addDanmaku",e),setImmediate(()=>{e?t.danmaku_input.focus():t.NyaP.focus()})}refreshProgress(){const e=this.$.progress;e.width=e.offsetWidth,e.height=e.offsetHeight,this.drawProgress(),this.emit("progressRefresh")}send(){let e={color:this._.danmakuColor||this.opt.defaultDanmakuColor,text:this.$.danmaku_input.value,size:this._.danmakuSize,mode:this._.danmakuMode,time:this.danmakuFrame.time};this.Danmaku.send(e,e=>{e&&"text"===e._&&(this.$.danmaku_input.value="");e.highlight=!0;this.danmakuFrame.load(e,!0);this.opt.autoHideDanmakuInput&&this.danmakuInput(!1)})||this.danmakuInput(!1)}_progressDrawer(){const e=this._.progressContext,t=this.$.progress,n=t.width,i=t.height,a=this.video,o=a.duration,s=a.currentTime,u=t.pad,l=n-2*u;let d;e.clearRect(0,0,n,i),e.lineCap="round",e.beginPath(),e.strokeStyle="#eee",e.lineWidth=7,e.moveTo(u,15),e.lineTo(u+l,15),e.stroke(),e.beginPath(),e.strokeStyle="#C0BBBB",e.lineWidth=2;let c=a.buffered;for(d=c.length;d--;)e.moveTo(u+c.start(d)/o*l,18),e.lineTo(u+c.end(d)/o*l,18);for(e.stroke(),e.beginPath(),e.strokeStyle="#6cf",e.lineWidth=5,e.moveTo(u,15),e.lineTo(u+l*s/o,15),e.stroke(),e.beginPath(),e.strokeStyle="rgba(255,255,255,.3)",e.lineWidth=5,d=(c=a.played).length;d--;)e.moveTo(u+c.start(d)/o*l,15),e.lineTo(u+c.end(d)/o*l,15);e.stroke(),this._.progressX&&(e.beginPath(),e.strokeStyle="rgba(0,0,0,.05)",e.moveTo(u+l*s/o,15),e.lineTo((0,r.limitIn)(this._.progressX,u,u+l),15),e.stroke()),this._.drawingProgress=!1}drawProgress(){this._.drawingProgress||(this._.drawingProgress=!0,requestAnimationFrame(()=>this._progressDrawer()))}msg(e,t="tip"){let n=new c(e,t,this.$.msg_box);requestAnimationFrame(()=>n.show())}}class c{constructor(e,t,n){this.using=!1,(this.msg=(0,o.default)({_:"div",attr:{class:`msg_type_${t}`}})).addEventListener("click",()=>this.remove()),this.parentNode=n,this.setText(e)}setTimeout(e){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.remove(),e||Math.max(.6*(this.texts?this.texts.length:0)*1e3,5e3))}setText(e){this.msg.innerHTML="";let t=Object2HTML(e);t&&this.msg.appendChild(t),e instanceof HTMLElement&&(e=e.textContent);let n=String(e).match(/\w+|\S/g);this.text=e,this.texts=n}renew(e,t){this.setText(e),this.setTimeout(t),this.using||this.show()}show(){this.using||(this.msg.style.opacity=0,this.parentNode&&this.parentNode!==this.msg.parentNode&&this.parentNode.appendChild(this.msg),this.msg.parentNode&&setTimeout(()=>{this.using=!0;this.msg.style.opacity=1},0),this.setTimeout())}remove(){this.using&&(this.using=!1,this.msg.style.opacity=0,this.timeout&&(clearTimeout(this.timeout),this.timeout=0),setTimeout(()=>{this.msg.parentNode&&this.msg.parentNode.removeChild(this.msg)},600))}}window.NyaP=d},{"../lib/Object2HTML/Object2HTML.js":1,"../lib/danmaku-frame/lib/ResizeSensor.js":2,"./NyaPCore.js":13,"./i18n.js":15}],13:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){Array.isArray(e)||(e=[e]);for(let n in t)n.split(/\,/g).forEach(function(i){e.forEach(function(e){e.addEventListener(i,t[n])})})}function o(e){try{(e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen).call(e)}catch(e){console.error(e),alert(y("Failed to change to fullscreen mode"))}}function r(){const e=document;(e.exitFullscreen||e.msExitFullscreen||e.mozCancelFullScreen||e.webkitCancelFullScreen).call(e)}function s(){const e=document;return!!(e.fullscreen||e.mozFullScreen||e.webkitIsFullScreen||e.msFullscreenElement)}function u(e,t){void 0==t&&(t=e);let n,i=0|e,a=i/3600|0;return t>=3600&&(i%=3600),n=[l(i/60|0),l(i%60)],t>=3600&&n.unshift(a),n.join(":")}function l(e){return e>9&&e||`0${e}`}function d(e,t){for(let n in t)e.setAttribute(n,t[n])}function c(e,t,n){return e<t?t:e>n?n:e}function h(e,t){return e+Math.random()*(t-e)+.5|0}function f(e){return e instanceof Array?e.slice():void 0!==e.length?Array.prototype.slice.call(e):[...e]}Object.defineProperty(n,"__esModule",{value:!0}),n.toArray=n.limitIn=n.setAttrs=n.padTime=n.rand=n.formatTime=n.isFullscreen=n.exitFullscreen=n.requestFullscreen=n.addEvents=n.NyaPlayerCore=void 0;var m=e("./i18n.js"),p=i(e("./danmaku.js")),g=i(e("../lib/Object2HTML/Object2HTML.js"));const y=m.i18n._;window.Object2HTML=g.default;const k={muted:!1,volume:1,loop:!1,enableDanmaku:!0,danmakuModule:["TextDanmaku"],danmakuModuleArg:{TextDanmaku:{defaultStyle:{},options:{}}},defaultDanmakuColor:null,defaultDanmakuMode:0,defaultDanmakuSize:24,danmakuSend:(e,t)=>{t(!1)},source:(e,t,n)=>n(e,t)};class _{constructor(){this._events={}}emit(e,...t){this._resolve(e,...t),this.globalHandle(e,...t)}_resolve(e,...t){if(e in this._events){const n=this._events[e];try{n.forEach(e=>{e.apply(this,t)})}catch(e){console.error(e)}}}addEventListener(e,t){this.on(e,t)}on(e,t){t instanceof Function&&(e in this._events||(this._events[e]=[]),this._events[e].push(t))}removeEvent(e,t){if(!(e in this._events))return;if(1===arguments.length)return void delete this._events[e];let n;(n=this._events[e].indexOf(t)>=0)&&this._events[e].splice(n,1),0===this._events[e].length&&delete this._events[e]}globalHandle(e,...t){}}class v extends _{constructor(e){super(),e=this.opt=Object.assign({},k,e);const t=this.$={document:document,window:window,NP:this};this._={video:(0,g.default)({_:"video",attr:{id:"main_video"}}),playerMode:"normal"},this.videoFrame=(0,g.default)({_:"div",attr:{id:"video_frame"},child:[this.video,{_:"div",attr:{id:"loading_frame"},child:[{_:"div",attr:{id:"loading_anime"},child:["(๑•́ ω •̀๑)"]},{_:"div",attr:{id:"loading_info"}}]}]}),this.collectEles(this.videoFrame),this._danmakuEnabled&&(this.danmakuContainer=(0,g.default)({_:"div",prop:{id:"danmaku_container"}}),this.loadingInfo(y("Loading danmaku frame")),this.Danmaku=new p.default(this),this.videoFrame.insertBefore(this.danmakuContainer,t.loading_frame),this.collectEles(this.danmakuContainer)),this._.loadingAnimeInterval=setInterval(()=>{t.loading_anime.style.transform="translate("+h(-20,20)+"px,"+h(-20,20)+"px) rotate("+h(-10,10)+"deg)"},80),setTimeout(t=>{["src","muted","volume","loop"].forEach(t=>{void 0!==e[t]&&(this.video[t]=e[t])})},0);{let e=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"loop");Object.defineProperty(this.video,"loop",{get:e.get,set:function(t){t!==this.loop&&(this.dispatchEvent(Object.assign(new Event("_loopChange"),{value:t})),e.set.call(this,t))}})}a(this.video,{loadedmetadata:e=>{clearInterval(this._.loadingAnimeInterval);t.loading_frame.parentNode.removeChild(t.loading_frame)},error:e=>{clearInterval(this._.loadingAnimeInterval);loading_anime.style.transform="";loading_anime.innerHTML="(๑• . •๑)"}}),this.emit("coreLoad")}playToggle(e=this.video.paused){this.video[e?"play":"pause"]()}loadingInfo(e){this.$.loading_info.appendChild((0,g.default)({_:"div",child:[e]}))}collectEles(e){const t=this.$;e.id&&!t[e.id]&&(t[e.id]=e),f(e.querySelectorAll("*")).forEach(e=>{e.id&&!t[e.id]&&(t[e.id]=e)})}playerMode(e="normal"){if("normal"!==e||this._.playerMode!==e){switch("fullPage"===this._.playerMode?this.player.style.position="":"fullScreen"===this._.playerMode&&r(),"normal"!==e&&this._.playerMode===e&&(e="normal"),e){case"fullPage":this.player.style.position="fixed",this.player.setAttribute("playerMode","fullPage");break;case"fullScreen":this.player.setAttribute("playerMode","fullScreen"),o(this.player);break;default:this.player.setAttribute("playerMode","normal")}this._.playerMode=e,this.emit("playerModeChange",e)}}isFullscreen(){const e=document;return(e.webkitFullscreenElement||e.msFullscreenElement||e.mozFullScreenElement||e.fullscreenElement)==this.player}get danmakuFrame(){return this.Danmaku.danmakuFrame}get player(){return this._.player}get video(){return this._.video}get src(){return this.video.src}set src(e){this.video.src=e}get TextDanmaku(){return this.danmakuFrame.modules.TextDanmaku}get videoSize(){return[this.video.videoWidth,this.video.videoHeight]}get _danmakuEnabled(){return 1==this.opt.enableDanmaku}}String.prototype.startsWith||(String.prototype.startsWith=function(e,t=0){return this.substr(t,e.length)===e}),Object.assign||(Object.assign=function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var a=arguments[i];if(null!=a)for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o])}return n}),Array.from||(Array.from=function(e,t){e instanceof Array||(e=f(e));for(var n=new Array(e.length),i=e.length;i--;)n[i]=t?t(e[i],i):e[i];return n}),Number.isInteger||(Number.isInteger=function(e){return(0|e)===e}),n.default=v,n.NyaPlayerCore=v,n.addEvents=a,n.requestFullscreen=o,n.exitFullscreen=r,n.isFullscreen=s,n.formatTime=u,n.rand=h,n.padTime=l,n.setAttrs=d,n.limitIn=c,n.toArray=f},{"../lib/Object2HTML/Object2HTML.js":1,"./danmaku.js":14,"./i18n.js":15}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../lib/danmaku-frame/src/danmaku-frame.js"),a=function(e){return e&&e.__esModule?e:{default:e}}(e("../lib/danmaku-text/src/danmaku-text.js")),o=e("./NyaPCore.js");(0,a.default)(i.DanmakuFrame,i.DanmakuFrameModule);const r="0123456789abcdef",s=["color","text","size","mode","time"];class u{constructor(e){this.core=e,this.danmakuFrame=new i.DanmakuFrame(e.danmakuContainer),e.opt.danmakuModule instanceof Array&&e.opt.danmakuModule.forEach(e=>{this.initModule(e);this.danmakuFrame.enable(e)}),this.danmakuFrame.setMedia(e.video)}initModule(e){return this.danmakuFrame.initModule(e,this.core.opt.danmakuModuleArg[e])}load(e){return this.danmakuFrame.load(e)}loadList(e){this.danmakuFrame.loadList(e)}remove(e){this.danmakuFrame.unload(e)}enable(){this.danmakuFrame.enable(),this.core.emit("danmakuFrameToggle",name,this.module(name).enabled)}disable(){this.danmakuFrame.enable()}toggle(e,t){if("boolean"==typeof e||void 0==e)return t=void 0!=e?e:!this.danmakuFrame.enabled,this.danmakuFrame[t?"enable":"disable"](),void this.core.emit("danmakuFrameToggle",t);try{void 0==t&&(t=!this.module(e).enabled),this.danmakuFrame[t?"enable":"disable"](e),this.core.emit("danmakuModuleToggle",e,this.module(e).enabled)}catch(e){return console.error(e),!1}return!0}at(e,t){return this.module("TextDanmaku").danmakuAt(e,t)}module(e){return this.danmakuFrame.modules[e]}send(e,t){for(let t of s)if(t in e==!1)return!1;return!(e.text||"").match(/^\s*$/)&&(e.color=this.isVaildColor(e.color),e.color?e.color=e.color.replace(/\$/g,()=>r[(0,o.limitIn)(16*Math.random()|0,0,15)]):e.color=null,this.core.opt.danmakuSend instanceof Function&&(this.core.opt.danmakuSend(e,t||(()=>{})),!0))}isVaildColor(e){return"string"==typeof e&&(!!(e=e.match(/^\#?(([\da-f\$]{3}){1,2})$/i))&&e[1])}}n.default=u},{"../lib/danmaku-frame/src/danmaku-frame.js":3,"../lib/danmaku-text/src/danmaku-text.js":6,"./NyaPCore.js":13}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i={lang:null,langs:{},_:(e,...t)=>{let n=i.lang&&i.langs[i.lang][e]||e;t.length&&t.forEach((e,t)=>{n=n.replace(`$${t}`,e)});return n}};i.langs["zh-CN"]={play:"播放",Send:"发送",loop:"循环",pause:"暂停",muted:"静音",volume:"音量",settings:"设置","hex color":"Hex颜色","full page(P)":"全页模式(P)","Creating player":"创建播放器","full screen(F)":"全屏模式(F)","danmaku toggle(D)":"弹幕开关(D)","Input danmaku here":"在这里输入弹幕","Loading danmaku frame":"加载弹幕框架","danmaku input(Enter)":"弹幕输入框(回车)","volume($0)([shift]+↑↓)":"音量($0)([shift]+↑↓)","Failed to change to fullscreen mode":"无法切换到全屏模式"},navigator.languages||(navigator.languages=[navigator.language||navigator.browserLanguage]);for(let e of[...navigator.languages]){if(i.langs[e]){i.lang=e;break}let t=e.match(/^\w+/)[0];for(let e in i.langs)if(e.startsWith(t)){i.lang=e;break}if(i.lang)break}console.debug("Language:"+i.lang),n.i18n=i},{}]},{},[12]);