!function t(e,n,i){function o(a,s){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(r)return r(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return o(n||t)},l,l.exports,t,e,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(t,e,n){"use strict";function i(t){return"object"==typeof t}function o(t,e){let n,r,a;if("string"==typeof t||"number"==typeof t)return document.createTextNode(t);if(null!==t&&"object"==typeof t&&"_"in t!=!1&&"string"==typeof t._&&""!=t._){if(n=document.createElement(t._),i(t.attr))for(r in t.attr)n.setAttribute(r,t.attr[r]);if(i(t.prop))for(r in t.prop)n[r]=t.prop[r];if(i(t.event))for(r in t.event)n.addEventListener(r,t.event[r]);return i(t.child)&&t.child.length>0&&t.child.forEach(t=>{a=t instanceof Node?t:o(t,e);a instanceof Node&&n.appendChild(a)}),e&&e(n),n}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=o,n.Object2HTML=o},{}],2:[function(t,e,n){"use strict";!function(t,i){"function"==typeof define&&define.amd?define(i):"object"==typeof n?e.exports=i():t.ResizeSensor=i()}(void 0,function(){function t(t,e){var n=Object.prototype.toString.call(t),i="[object Array]"===n||"[object NodeList]"===n||"[object HTMLCollection]"===n||"[object Object]"===n||"undefined"!=typeof jQuery&&t instanceof jQuery||"undefined"!=typeof Elements&&t instanceof Elements,o=0,r=t.length;if(i)for(;o<r;o++)e(t[o]);else e(t)}if("undefined"==typeof window)return null;var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return window.setTimeout(t,20)},n=function(i,o){function r(){var t=[];this.add=function(e){t.push(e)};var e,n;this.call=function(){for(e=0,n=t.length;e<n;e++)t[e].call()},this.remove=function(i){var o=[];for(e=0,n=t.length;e<n;e++)t[e]!==i&&o.push(t[e]);t=o},this.length=function(){return t.length}}function a(t,e){return t.currentStyle?t.currentStyle[e]:window.getComputedStyle?window.getComputedStyle(t,null).getPropertyValue(e):t.style[e]}function s(t,n){if(t.resizedAttached)return void t.resizedAttached.add(n);t.resizedAttached=new r,t.resizedAttached.add(n),t.resizeSensor=document.createElement("div"),t.resizeSensor.className="resize-sensor";var i="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;",o="position: absolute; left: 0; top: 0; transition: 0s;";t.resizeSensor.style.cssText=i,t.resizeSensor.innerHTML='<div class="resize-sensor-expand" style="'+i+'"><div style="'+o+'"></div></div><div class="resize-sensor-shrink" style="'+i+'"><div style="'+o+' width: 200%; height: 200%"></div></div>',t.appendChild(t.resizeSensor),"static"==a(t,"position")&&(t.style.position="relative");var s,u,c,l,d=t.resizeSensor.childNodes[0],h=d.childNodes[0],f=t.resizeSensor.childNodes[1],m=t.offsetWidth,p=t.offsetHeight,g=function(){h.style.width="100000px",h.style.height="100000px",d.scrollLeft=1e5,d.scrollTop=1e5,f.scrollLeft=1e5,f.scrollTop=1e5};g();var y=function(){u=0,s&&(m=c,p=l,t.resizedAttached&&t.resizedAttached.call())},v=function(){c=t.offsetWidth,l=t.offsetHeight,s=c!=m||l!=p,s&&!u&&(u=e(y)),g()},_=function(t,e,n){t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener(e,n)};_(d,"scroll",v),_(f,"scroll",v)}t(i,function(t){s(t,o)}),this.detach=function(t){n.detach(i,t)}};return n.detach=function(e,n){t(e,function(t){t.resizedAttached&&"function"==typeof n&&(t.resizedAttached.remove(n),t.resizedAttached.length())||t.resizeSensor&&(t.contains(t.resizeSensor)&&t.removeChild(t.resizeSensor),delete t.resizeSensor,delete t.resizedAttached)})},n})},{}],3:[function(t,e,n){"use strict";function i(t,e={}){for(let n in e)n.split(/\,/g).forEach(i=>t.addEventListener(i,e[n]))}Object.defineProperty(n,"__esModule",{value:!0}),n.ResizeSensor=n.DanmakuFrameModule=n.DanmakuFrame=void 0;var o=t("../lib/ResizeSensor.js"),r=function(t){return t&&t.__esModule?t:{default:t}}(o);class a{constructor(t){const e=this;e.container=t||document.createElement("div"),e.rate=1,e.timeBase=e.width=e.height=e.fps=0,e.fpsTmp=0,e.fpsRec=e.fps||60,e.media=null,e.working=!1,e.modules={},e.moduleList=[];const n=document.createElement("style");document.head.appendChild(n),e.styleSheet=n.sheet;for(let t in a.moduleList)e.initModule(t);setTimeout(()=>{e.container.ResizeSensor=new r.default(e.container,()=>{e.resize()});e.resize()},0),setInterval(()=>{e.fpsRec=e.fpsTmp;e.fpsTmp=0},1e3),e.draw=e.draw.bind(e)}enable(t){let e=this.modules[t];return e?(e.enabled=!0,e.enable&&e.enable(),!0):this.initModule(t)}disable(t){let e=this.modules[t];return!!e&&(e.enabled=!1,e.disable&&e.disable(),!0)}addStyle(t){"string"==typeof t&&(t=[t]),t instanceof Array!=!1&&t.forEach(t=>this.styleSheet.insertRule(t,this.styleSheet.cssRules.length))}initModule(t){let e=a.moduleList[t];if(!e)throw"Module ["+t+"] does not exist.";let n=new e(this);if(n instanceof s==!1)throw"Constructor of "+t+" is not extended from DanmakuFrameModule";return n.enabled=!0,this.modules[t]=n,this.moduleList.push(t),console.debug(`Mod Inited: ${t}`),!0}set time(t){this.media||(this.timeBase=Date.now()-t),this.moduleFunction("time",t)}get time(){return this.media?1e3*this.media.currentTime|0:Date.now()-this.timeBase}draw(t){this.working&&(this.fpsTmp++,this.moduleFunction("draw",t),0===this.fps?requestAnimationFrame(()=>this.draw()):setTimeout(this.draw,1e3/this.fps))}load(t){this.moduleFunction("load",t)}loadList(t){this.moduleFunction("loadList",t)}unload(t){this.moduleFunction("unload",t)}start(){this.working||(this.working=!0,this.moduleFunction("start"),this.draw(!0))}pause(){this.working=!1,this.moduleFunction("pause")}resize(){this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.moduleFunction("resize")}moduleFunction(t,e){for(let n,i=0;i<this.moduleList.length;i++)n=this.modules[this.moduleList[i]],n.enabled&&n[t]&&n[t](e)}setMedia(t){const e=this;e.media=t,i(t,{playing:()=>e.start(),pause:()=>e.pause(),ratechange:()=>{e.rate=e.media.playbackRate;e.moduleFunction("rate",e.rate)}}),e.moduleFunction("media",t)}static addModule(t,e){if(t in this.moduleList)return void console.warn('The module "'+t+'" has already been added.');this.moduleList[t]=e}}a.moduleList={};class s{constructor(t){this.frame=t,this.enabled=!1}}n.DanmakuFrame=a,n.DanmakuFrameModule=s,n.ResizeSensor=r.default},{"../lib/ResizeSensor.js":2}],4:[function(t,e,n){"use strict";!function(t){"function"==typeof define&&define.amd?define(t):"object"==typeof n?e.exports=t():(0,eval)("this").Mat=t()}(function(){function t(e){class i{constructor(t,n,o=0){this.array=new e(t*n),Object.defineProperty(this.array,"row",{value:t}),Object.defineProperty(this.array,"column",{value:n}),3==arguments.length&&(i._instanceofTypedArray&&0===o||("number"==typeof o?this.fill(o):o.length&&this.set(o)))}get length(){return this.array.length}get row(){return this.array.row}get column(){return this.array.column}leftMultiply(t){return this.set(i.multiply(t,this,new i(t.row,this.column)))}rightMultiply(t){return this.set(i.multiply(this,t,new i(this.row,t,column)))}fill(t){arguments.length||(t=0);for(let e=this.length;e--;)this.array[e]=t;return this}set(t,e){e||(e=0),t instanceof i&&(t=t.array);for(let n=t.length+e<=this.length?t.length:this.length-e;n--;)this.array[e+n]=t[n];return this}put(t,e,n){return i.put(this,t,e||0,n||0),this}rotate2d(t){return this.set(i.rotate2d(this,t,i.Matrixes.T3))}translate2d(t,e){return this.set(i.translate2d(this,t,e,i.Matrixes.T3))}scale2d(t,e){return this.set(i.scale2d(this,t,e,i.Matrixes.T3))}rotate3d(t,e,n){return this.set(i.rotate3d(this,t,e,n,i.Matrixes.T4))}scale3d(t,e,n){return this.set(i.scale3d(this,t,e,n,i.Matrixes.T4))}translate3d(t,e,n){return this.set(i.translate3d(this,t,e,n,i.Matrixes.T4))}rotateX(t){return this.set(i.rotateX(this,t,i.Matrixes.T4))}rotateY(t){return this.set(i.rotateY(this,t,i.Matrixes.T4))}rotateZ(t){return this.set(i.rotateZ(this,t,i.Matrixes.T4))}clone(){return new i(this.row,this.column,this)}toString(){if(0===this.length)return"";for(var t=0,e=[],n=[];t<this.length;t++)t&&t%this.column==0&&(e.push(n.join("\t")),n.length=0),n.push(this.array[t]||0);return e.push(n.join("\t")),e.join("\n")}static Identity(t){let e=new i(t,t,0);for(let n=t;n--;)e.array[n*t+n]=1;return e}static Perspective(t,e,n,o,r){var a=n*Math.tan(t*Math.PI/360),s=a*e,u=r||new i(4,4,0),c=u.array;return c[0]=2*n/(s+s),c[5]=2*n/(a+a),c[10]=-(o+n)/(o-n),c[14]=-2*o*n/(o-n),c[11]=-1,r&&(c[1]=c[2]=c[3]=c[4]=c[6]=c[7]=c[8]=c[9]=c[12]=c[13]=c[15]=0),u}static multiply(t,e,n){if(t.column!==e.row)throw"wrong matrix";let o,r,a,s=t.row,u=Math.min(t.column,e.column),c=n||new i(s,u);for(let n=s;n--;)for(o=u;o--;)for(c.array[a=n*c.column+o]=0,r=t.column;r--;)c.array[a]+=t.array[n*t.column+r]*e.array[o+r*e.column];return c}static multiplyString(t,e,n,o=!0){if(t.column!==e.row)throw"wrong matrix";var r,a,s,u,c=n||new i(t.row,e.column);for(r=t.row;r--;)for(a=e.column;a--;)for(c.array[u=r*e.column+a]="",s=0;s<t.column;s++)(!o||0!=t.array[r*t.column+s]&&0!=e.array[a+s*e.column])&&(c.array[u]+=(s&&c.array[u]?"+":"")+"("+t.array[r*t.column+s]+")*("+e.array[a+s*e.column]+")");return c}static add(t,e,n){if(t.column!==e.column||t.row!==e.row)throw"wrong matrix";let o=n||new i(t.row,e.column);for(let n=t.length;n--;)o.array[n]=t.array[n]+e.array[n];return o}static minus(t,e,n){if(t.column!==e.column||t.row!==e.row)throw"wrong matrix";let o=n||new i(t.row,e.column);for(let n=t.length;n--;)o.array[n]=t.array[n]-e.array[n];return o}static rotate2d(t,e,n){const o=i.Matrixes.rotate2d;return o.array[0]=o.array[4]=Math.cos(e),o.array[1]=-(o.array[3]=Math.sin(e)),i.multiply(o,t,n||new i(3,3))}static scale2d(t,e,n,o){const r=i.Matrixes.scale2d;return r.array[0]=e,r.array[4]=n,i.multiply(r,t,o||new i(3,3))}static translate2d(t,e,n,o){const r=i.Matrixes.translate2d;return r.array[2]=e,r.array[5]=n,i.multiply(r,t,o||new i(3,3))}static rotate3d(t,e,n,o,r){const a=Math.cos(e),s=Math.sin(e),u=Math.cos(n),c=Math.sin(n),l=Math.cos(o),d=Math.sin(o),h=i.Matrixes.rotate3d;return h.array[0]=l*u,h.array[1]=l*c*s-d*a,h.array[2]=l*c*a+d*s,h.array[4]=d*u,h.array[5]=d*c*s+l*a,h.array[6]=d*c*a-l*s,h.array[8]=-c,h.array[9]=u*s,h.array[10]=u*a,i.multiply(h,t,r||new i(4,4))}static rotateX(t,e,n){const o=i.Matrixes.rotateX;return o.array[10]=o.array[5]=Math.cos(e),o.array[6]=-(o.array[9]=Math.sin(e)),i.multiply(o,t,n||new i(4,4))}static rotateY(t,e,n){const o=i.Matrixes.rotateY;return o.array[10]=o.array[0]=Math.cos(e),o.array[8]=-(o.array[2]=Math.sin(e)),i.multiply(o,t,n||new i(4,4))}static rotateZ(t,e,n){const o=i.Matrixes.rotateZ;return o.array[5]=o.array[0]=Math.cos(e),o.array[1]=-(o.array[4]=Math.sin(e)),i.multiply(o,t,n||new i(4,4))}static scale3d(t,e,n,o,r){const a=i.Matrixes.scale3d;return a.array[0]=e,a.array[5]=n,a.array[10]=o,i.multiply(a,t,r||new i(4,4))}static translate3d(t,e,n,o,r){const a=i.Matrixes.translate3d;return a.array[12]=e,a.array[13]=n,a.array[14]=o,i.multiply(a,t,r||new i(4,4))}static put(t,e,n,i){let o;n||(n=0),i||(i=0);for(let r=e.row;r--;)if(!(r+n>=t.row))for(o=e.column;o--;)o+i>=t.column||(t.array[(r+n)*t.column+o+i]=e.array[r*e.column+o])}static createClass(e){return t(e)}}var o=new e(1);return Object.defineProperty(i,"_instanceofTypedArray",{value:!(!n||!n.isPrototypeOf(o))}),o=null,i.Matrixes={I2:i.Identity(2),I3:i.Identity(3),I4:i.Identity(4),T3:new i(3,3,0),T4:new i(4,4,0),rotate2d:i.Identity(3),translate2d:i.Identity(3),scale2d:i.Identity(3),translate3d:i.Identity(4),rotate3d:i.Identity(4),rotateX:i.Identity(4),rotateY:i.Identity(4),rotateZ:i.Identity(4),scale3d:i.Identity(4)},i}const e=(0,eval)("this"),n=e.Float32Array&&e.Float32Array.prototype;return t(e.Float32Array?Float32Array:Array)})},{}],5:[function(t,e,n){(function(t,e){"use strict";!function(e,n){function i(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return c[u]=i,s(u),u++}function o(t){delete c[t]}function r(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(n,i)}}function a(t){if(l)setTimeout(a,0,t);else{var e=c[t];if(e){l=!0;try{r(e)}finally{o(t),l=!1}}}}if(!e.setImmediate){var s,u=1,c={},l=!1,d=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,"[object process]"==={}.toString.call(e.process)?function(){s=function(e){t.nextTick(function(){a(e)})}}():function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&a(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),s=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){a(t.data)},s=function(e){t.port2.postMessage(e)}}():d&&"onreadystatechange"in d.createElement("script")?function(){var t=d.documentElement;s=function(e){var n=d.createElement("script");n.onreadystatechange=function(){a(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}}():function(){s=function(t){setTimeout(a,0,t)}}(),h.setImmediate=i,h.clearImmediate=o}}("undefined"==typeof self?void 0===e?void 0:e:self)}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:11}],6:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){function n(t,e,n,i,o=!1){if(0===t.length)return 0;let r=n,a=i;for(;n<=i;)r=n+i>>1,e<=t[r].time?i=r-1:n=r+1;if(o)for(;n>0&&t[n-1].time===e;)n--;else for(;n<=a&&t[n].time===e;)n++;return n}const i=Object.defineProperty,o=window.requestIdleCallback||setImmediate;let a=!1;class u extends e{constructor(t){super(t);const e=this;e.list=[],e.indexMark=0,e.tunnel=new h,e.paused=!0,e.randomText=`danmaku_text_${999999*Math.random()|0}`,e.defaultStyle={fontStyle:null,fontWeight:300,fontVariant:null,color:"#fff",fontSize:24,fontFamily:"Arial",strokeWidth:1,strokeColor:"#888",shadowBlur:5,textAlign:"start",shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0,fill:!0},t.addStyle(`.${e.randomText}_fullfill{top:0;left:0;width:100%;height:100%;position:absolute;}`),i(e,"rendererMode",{configurable:!0}),i(e,"activeRendererMode",{configurable:!0,value:null});const n=e.container=document.createElement("div");n.classList.add(`${e.randomText}_fullfill`),t.container.appendChild(n),e.text2d=new s.default(e),e.text3d=new c.default(e),e.textCanvas=new d.default(e),e.textCanvasContainer.hidden=e.canvas.hidden=e.canvas3d.hidden=!0,e.modes={1:e.textCanvas,2:e.text2d,3:e.text3d},e.GraphCache=[],e.DanmakuText=[],e.renderingDanmakuManager=new m(e),e.cacheCleanTime=0,e.danmakuMoveTime=0,e.danmakuCheckTime=0,e.danmakuCheckSwitch=!0,e.options={allowLines:!1,screenLimit:0,clearWhenTimeReset:!0,speed:6.5,autoShiftRenderingMode:!0},r(document,{visibilitychange:t=>{e.danmakuCheckSwitch=!document.hidden;document.hidden||e.recheckIndexMark()}}),e._checkNewDanmaku=e._checkNewDanmaku.bind(e),e._cleanCache=e._cleanCache.bind(e),setInterval(e._cleanCache,5e3),e.setRendererMode(1)}setRendererMode(t){const e=this;return!!(e.rendererMode!==t&&t in e.modes&&e.modes[t].supported)&&(e.activeRendererMode&&e.activeRendererMode.disable(),i(e,"activeRendererMode",{value:e.modes[t]}),i(e,"rendererMode",{value:t}),e.activeRendererMode.resize(),e.activeRendererMode.enable(),console.log("rendererMode:",e.rendererMode),!0)}media(t){const e=this;r(t,{seeked:()=>{e.time();e.paused&&e.start();e._clearScreen(!0)},seeking:()=>e.pause(),stalled:()=>e.pause()})}start(){this.paused=!1,this.recheckIndexMark(),this.activeRendererMode.start()}pause(){this.paused=!0,this.activeRendererMode.pause()}load(t){if(!t||"text"!==t._)return!1;if("string"!=typeof t.text)return console.error("wrong danmaku object:",t),!1;let e,i=(t.time,this.list);return e=n(i,t.time,0,i.length-1,!1),i.splice(e,0,t),e<this.indexMark&&this.indexMark++,"object"!=typeof t.style&&(t.style={}),t.style.fontSize=t.style.fontSize?t.style.fontSize+.5|0:this.defaultStyle.fontSize,(isNaN(t.style.fontSize)||t.style.fontSize===1/0||0===t.style.fontSize)&&(t.style.fontSize=this.defaultStyle.fontSize),"number"!=typeof t.mode&&(t.mode=0),t}loadList(t){t.forEach(t=>this.load(t))}unload(t){if(!t||"text"!==t._)return!1;const e=this,n=e.list.indexOf(t);return!(n<0)&&(e.list.splice(n,1),n<e.indexMark&&e.indexMark--,!0)}_checkNewDanmaku(){let t,e=this,n=e.frame.time;if(e.danmakuCheckTime!==n&&e.danmakuCheckSwitch){if(e.list.length)for(;e.indexMark<e.list.length&&(t=e.list[e.indexMark])&&t.time<=n;e.indexMark++)e.options.screenLimit>0&&e.DanmakuText.length>=e.options.screenLimit||e._addNewDanmaku(t);e.danmakuCheckTime=n}}_addNewDanmaku(t){const e=this,n=e.height,i=e.width;let o=e.GraphCache.length?e.GraphCache.shift():new l;o.danmaku=t,o.drawn=!1,o.text=e.options.allowLines?t.text:t.text.replace(/\n/g," "),o.time=t.time,o.font=Object.create(e.defaultStyle),Object.assign(o.font,t.style),o.font.lineHeight||(o.font.lineHeight=o.font.fontSize+2||1),t.style.color&&o.font.color&&"#"!==o.font.color[0]&&(o.font.color="#"+t.style.color),t.mode>1&&(o.font.textAlign="center"),o.prepare(3!==e.rendererMode);const r=e.tunnel.getTunnel(o,n);let a=(r<0?0:r)%n;switch(t.mode){case 0:case 1:case 3:o.style.y=a;break;case 2:o.style.y=n-a-o.style.height-1}switch(t.mode){case 0:o.style.x=i;break;case 1:o.style.x=-o.style.width;break;case 2:case 3:o.style.x=(i-o.style.width)/2}e.renderingDanmakuManager.add(o),e.activeRendererMode.newDanmaku(o)}_calcSideDanmakuPosition(t,e=this.frame.time){let n=!t.danmaku.mode,i=t.style;return(n?this.frame.width:-i.width)+(n?-1:1)*this.frame.rate*(i.width+1024)*(e-t.time)*this.options.speed/6e4}_calcDanmakusPosition(t){let e=this,n=e.frame.time;if(!e.paused||t){const t=e.width,i=e.frame.rate;let o,r,a,s,u;for(e.danmakuMoveTime=n,r=e.DanmakuText.length;r--;)if(a=e.DanmakuText[r],a.time>n)e.removeText(a);else switch(s=a.style,a.danmaku.mode){case 0:case 1:if(o=!a.danmaku.mode,s.x=u=e._calcSideDanmakuPosition(a,n),a.tunnelNumber>=0&&(o&&u+s.width+10<t||!o&&u>10))e.tunnel.removeMark(a);else if(o&&u<-s.width-20||!o&&u>t+s.width+20){e.removeText(a);continue}break;case 2:case 3:n-a.time>1e3*e.options.speed/i&&e.removeText(a)}}}_cleanCache(t){const e=this,n=Date.now();if(e.GraphCache.length>30||t)for(let i=0;i<e.GraphCache.length&&(t||n-e.GraphCache[i].removeTime>1e4);i++)e.activeRendererMode.deleteTextObject(e.GraphCache[i]),e.GraphCache.splice(i,1)}draw(t){!t&&this.paused||!this.enabled||(this._calcDanmakusPosition(t),this.activeRendererMode.draw(t),requestAnimationFrame(this._checkNewDanmaku))}removeText(t){this.renderingDanmakuManager.remove(t),this.tunnel.removeMark(t),t._bitmap=t.danmaku=null,t.removeTime=Date.now(),this.GraphCache.push(t),this.activeRendererMode.remove(t)}resize(){this.activeRendererMode&&this.activeRendererMode.resize(),this.draw(!0)}_clearScreen(t){this.activeRendererMode&&this.activeRendererMode.clear(t)}clear(){for(let t,e=this.DanmakuText.length;e--;)t=this.DanmakuText[e],t.danmaku&&this.removeText(t);this.tunnel.reset(),this._clearScreen(!0)}recheckIndexMark(t=this.frame.time){this.indexMark=n(this.list,t,0,this.list.length-1,!0)}rate(t){this.activeRendererMode&&this.activeRendererMode.rate(t)}time(t=this.frame.time){this.recheckIndexMark(t),this.options.clearWhenTimeReset?this.clear():this.resetTimeOfDanmakuOnScreen()}resetTimeOfDanmakuOnScreen(t){void 0===t&&(t=this.frame.time),this.DanmakuText.forEach(e=>{if(!e.danmaku)return;e.time=t-(this.danmakuMoveTime-e.time)})}danmakuAt(t,e){const n=[];return this.enabled?(this.DanmakuText.forEach(i=>{if(!i.danmaku)return;i.style.x<=t&&i.style.x+i.style.width>=t&&i.style.y<=e&&i.style.y+i.style.height>=e&&n.push(i.danmaku)}),n):n}enable(){this.textCanvasContainer.hidden=!1,this.frame.working&&this.start()}disable(){this.textCanvasContainer.hidden=!0,this.pause(),this.clear()}set useImageBitmap(t){a="function"==typeof createImageBitmap&&t}get useImageBitmap(){return a}get width(){return this.frame.width}get height(){return this.frame.height}}class l{constructor(t=""){const e=this;e._fontString="",e._renderList=null,e.style={},e.font={},e.text=t,e._renderToCache=e._renderToCache.bind(e),i(e,"_cache",{configurable:!0})}prepare(t=!1){const e=this;e._cache||i(e,"_cache",{value:document.createElement("canvas")});let n=[];e.font.fontStyle&&n.push(e.font.fontStyle),e.font.fontVariant&&n.push(e.font.fontVariant),e.font.fontWeight&&n.push(e.font.fontWeight),n.push(`${e.font.fontSize}px`),e.font.fontFamily&&n.push(e.font.fontFamily),e._fontString=n.join(" ");const r=e._cache,a=r.ctx2d||(r.ctx2d=r.getContext("2d"));a.font=e._fontString,e._renderList=e.text.split(/\n/g),e.estimatePadding=Math.max(e.font.shadowBlur+5+Math.max(Math.abs(e.font.shadowOffsetY),Math.abs(e.font.shadowOffsetX)),e.font.strokeWidth+3);let s,u=0,c="number"==typeof e.font.lineHeight?e.font.lineHeight:e.font.fontSize;for(let t=e._renderList.length;t--;)(s=a.measureText(e._renderList[t]).width)>u&&(u=s);r.width=(e.style.width=u)+2*e.estimatePadding,r.height=(e.style.height=e._renderList.length*c)+(c<e.font.fontSize?2*e.font.fontSize:0)+2*e.estimatePadding,a.translate(e.estimatePadding,e.estimatePadding),t?o(e._renderToCache):e._renderToCache()}_renderToCache(){const t=this;t.danmaku&&(t.render(t._cache.ctx2d),a&&(t._bitmap&&(t._bitmap.close(),t._bitmap=null),createImageBitmap(t._cache).then(e=>{t._bitmap=e})))}render(t){const e=this;if(e._renderList){t.save(),e.danmaku.highlight&&(t.fillStyle="rgba(255,255,255,0.3)",t.beginPath(),t.rect(0,0,e.style.width,e.style.height),t.fill()),t.font=e._fontString,t.textBaseline="middle",t.lineWidth=e.font.strokeWidth,t.fillStyle=e.font.color,t.strokeStyle=e.font.strokeColor,t.shadowBlur=e.font.shadowBlur,t.shadowColor=e.font.shadowColor,t.shadowOffsetX=e.font.shadowOffsetX,t.shadowOffsetY=e.font.shadowOffsetY,t.textAlign=e.font.textAlign;let n,i="number"==typeof e.font.lineHeight?e.font.lineHeight:e.font.fontSize;switch(e.font.textAlign){case"left":case"start":n=0;break;case"center":n=e.style.width/2;break;case"right":case"end":n=e.style.width}for(let o=e._renderList.length;o--;)e.font.strokeWidth&&t.strokeText(e._renderList[o],n,i*(o+.5)),e.font.fill&&t.fillText(e._renderList[o],n,i*(o+.5));t.restore()}}}class h{constructor(){this.reset()}reset(){this.right={},this.left={},this.bottom={},this.top={}}getTunnel(t,e){let n=this.tunnel(t.danmaku.mode),i=t.style.height,o=0,r=-1;if(("number"!=typeof i||i<=0)&&(console.error("Incorrect size:"+i),i=24),i>e)return 0;for(;r<0;)for(let t=o+i-1;o<=t;){if(n[o]){o+=n[o].tunnelHeight;break}if(0!==o&&o%(e-1)==0){o++;break}if(o===t){r=o-i+1;break}o++}return t.tunnelNumber=r,t.tunnelHeight=t.style.y+i>e?1:i,this.addMark(t),r}addMark(t){let e=this.tunnel(t.danmaku.mode);e[t.tunnelNumber]||(e[t.tunnelNumber]=t)}removeMark(t){let e,n=t.tunnelNumber;n>=0&&(e=this.tunnel(t.danmaku.mode))[n]===t&&(delete e[n],t.tunnelNumber=-1)}tunnel(t){return this[f[t]]}}const f=["right","left","bottom","top"];class m{constructor(t){this.dText=t,this.totalArea=0,this.limitArea=1/0,t.text2d.supported&&(this.timer=setInterval(()=>this.rendererModeCheck(),1500))}add(t){this.dText.DanmakuText.push(t),this.totalArea+=t._cache.width*t._cache.height}remove(t){let e=this.dText.DanmakuText.indexOf(t);e>=0&&(this.dText.DanmakuText.splice(e,1),this.totalArea-=t._cache.width*t._cache.height)}rendererModeCheck(){let t=this.dText;this.dText.options.autoShiftRenderingMode&&!t.paused&&(t.frame.fpsRec<.95*(t.frame.fps||60)?this.limitArea>this.totalArea&&(this.limitArea=this.totalArea):this.limitArea<this.totalArea&&(this.limitArea=this.totalArea),1==t.rendererMode&&this.totalArea>this.limitArea?t.text2d.supported&&t.setRendererMode(2):2==t.rendererMode&&this.totalArea<.5*this.limitArea&&t.textCanvas.supported&&t.setRendererMode(1))}}t.addModule("TextDanmaku",u)}function r(t,e={}){for(let n in e)n.split(/\,/g).forEach(i=>t.addEventListener(i,e[n]))}Object.defineProperty(n,"__esModule",{value:!0}),t("../lib/setImmediate/setImmediate.js");var a=t("./text2d.js"),s=i(a),u=t("./text3d.js"),c=i(u),l=t("./textCanvas.js"),d=i(l);n.default=o},{"../lib/setImmediate/setImmediate.js":5,"./text2d.js":7,"./text3d.js":8,"./textCanvas.js":9}],7:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("./textModuleTemplate.js"),o=function(t){return t&&t.__esModule?t:{default:t}}(i);class r extends o.default{constructor(t){if(super(t),this.supported=!1,t.canvas=document.createElement("canvas"),t.context2d=t.canvas.getContext("2d"),!t.context2d)return void console.warn("text 2d not supported");t.canvas.classList.add(`${t.randomText}_fullfill`),t.canvas.id=`${t.randomText}_text2d`,t.container.appendChild(t.canvas),this.supported=!0}draw(t){let e,n,i,o,r=this.dText.context2d,a=r.canvas.width,s=this.dText.DanmakuText,u=s.length;const c=this.dText.useImageBitmap;for(r.globalCompositeOperation="destination-over",this.clear(t);u--;)(e=s[u]).drawn||(e.drawn=!0),n=e.style.x-e.estimatePadding,i=n+e._cache.width,n>a||i<0||(!c&&a>=e._cache.width?r.drawImage(e._bitmap||e._cache,n,e.style.y-e.estimatePadding):(o=e._cache.width+(n<0?n:0)-(i>a?i-a:0),r.drawImage(e._bitmap||e._cache,n<0?-n:0,0,o,e._cache.height,n<0?0:n,e.style.y-e.estimatePadding,o,e._cache.height)))}clear(t){const e=this.dText;if(t||this._evaluateIfFullClearMode())return void e.context2d.clearRect(0,0,e.canvas.width,e.canvas.height);for(let t,n=e.DanmakuText.length;n--;)t=e.DanmakuText[n],t.drawn&&e.context2d.clearRect(t.style.x-t.estimatePadding,t.style.y-t.estimatePadding,t._cache.width,t._cache.height)}_evaluateIfFullClearMode(){if(this.dText.DanmakuText.length>3)return!0;let t=this.dText.GraphCache[this.dText.GraphCache.length-1];return!(!t||!t.drawn)&&(t.drawn=!1,!0)}resize(){let t=this.dText,e=t.canvas;e.width=t.width,e.height=t.height}enable(){this.draw(),this.dText.useImageBitmap=!(this.dText.canvas.hidden=!1)}disable(){this.dText.canvas.hidden=!0,this.clear(!0)}}n.default=r},{"./textModuleTemplate.js":10}],8:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(n,"__esModule",{value:!0});var o=t("../lib/Mat/Mat.js"),r=i(o),a=t("./textModuleTemplate.js"),s=i(a);const u=window.requestIdleCallback||setImmediate;class c extends s.default{constructor(t){function e(t){var e=i.createShader(o[t][0]);if(i.shaderSource(e,o[t][1]),i.compileShader(e),!i.getShaderParameter(e,i.COMPILE_STATUS))throw"An error occurred compiling the shaders: "+i.getShaderInfoLog(e);return e}super(t),this.supported=!1;let n=this.c3d=t.canvas3d=document.createElement("canvas");if(n.classList.add(`${t.randomText}_fullfill`),n.id=`${t.randomText}_text3d`,t.context3d=n.getContext("webgl")||n.getContext("experimental-webgl"),!t.context3d)return void console.warn("text 3d not supported");t.container.appendChild(n);const i=this.gl=t.context3d;var o={danmakuFrag:[i.FRAGMENT_SHADER,`
\t\t\t\t#pragma optimize(on)
\t\t\t\tprecision lowp float;
\t\t\t\tvarying lowp vec2 vDanmakuTexCoord;
\t\t\t\tuniform sampler2D uSampler;
\t\t\t\tvoid main(void) {
\t\t\t\t\tvec4 co=texture2D(uSampler,vDanmakuTexCoord);
\t\t\t\t\tif(co.a == 0.0)discard;
\t\t\t\t\tgl_FragColor = co;
\t\t\t\t}`],danmakuVert:[i.VERTEX_SHADER,`
\t\t\t\t#pragma optimize(on)
\t\t\t\tattribute vec2 aVertexPosition;
\t\t\t\tattribute vec2 aDanmakuTexCoord;
\t\t\t\tuniform mat4 u2dCoordinate;
\t\t\t\tvarying lowp vec2 vDanmakuTexCoord;
\t\t\t\tvoid main(void) {
\t\t\t\t\tgl_Position = u2dCoordinate * vec4(aVertexPosition,0,1);
\t\t\t\t\tvDanmakuTexCoord = aDanmakuTexCoord;
\t\t\t\t}`]},r=e("danmakuFrag"),a=e("danmakuVert"),s=this.shaderProgram=i.createProgram();if(i.attachShader(s,a),i.attachShader(s,r),i.linkProgram(s),!i.getProgramParameter(s,i.LINK_STATUS))return void console.error("Unable to initialize the shader program.");i.useProgram(s),i.clearColor(0,0,0,0),i.enable(i.BLEND),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA),this.maxTexSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.uSampler=i.getUniformLocation(s,"uSampler"),this.u2dCoord=i.getUniformLocation(s,"u2dCoordinate"),this.aVertexPosition=i.getAttribLocation(s,"aVertexPosition"),this.atextureCoord=i.getAttribLocation(s,"aDanmakuTexCoord"),i.enableVertexAttribArray(this.aVertexPosition),i.enableVertexAttribArray(this.atextureCoord),this.commonTexCoordBuffer=i.createBuffer(),this.commonVertCoordBuffer=i.createBuffer(),i.activeTexture(i.TEXTURE0),i.uniform1i(this.uSampler,0),this.supported=!0}draw(t){const e=this.gl,n=this.dText.DanmakuText.length;let i,o,r,a=this.c3d.width;for(let t,s=0;s<n;s++)(t=this.dText.DanmakuText[s])&&t.glDanmaku&&(i=t.style.x-t.estimatePadding,o=i+t._cache.width,r=t._cache.width+(i<0?i:0)-(o>a?o-a:0),i>a||o<0||(t.vertCoord[0]=t.vertCoord[4]=i<0?0:i,t.vertCoord[2]=t.vertCoord[6]=t.vertCoord[0]+r,e.bindBuffer(e.ARRAY_BUFFER,this.commonVertCoordBuffer),e.bufferData(e.ARRAY_BUFFER,t.vertCoord,e.DYNAMIC_DRAW),e.vertexAttribPointer(this.aVertexPosition,2,e.FLOAT,!1,0,0),l[0]=l[4]=i<0?-i/t._cache.width:0,l[2]=l[6]=l[0]+r/t._cache.width,e.bindBuffer(e.ARRAY_BUFFER,this.commonTexCoordBuffer),e.bufferData(e.ARRAY_BUFFER,l,e.DYNAMIC_DRAW),e.vertexAttribPointer(this.atextureCoord,2,e.FLOAT,!1,0,0),e.bindTexture(e.TEXTURE_2D,t.texture),e.drawArrays(e.TRIANGLE_STRIP,0,4)));e.flush()}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}deleteTextObject(t){const e=this.gl;t.texture&&e.deleteTexture(t.texture)}resize(t,e){const n=this.gl,i=this.c3d;i.width=this.dText.width,i.height=this.dText.height,n.viewport(0,0,i.width,i.height),n.uniformMatrix4fv(this.u2dCoord,!1,r.default.Identity(4).translate3d(-1,1,0).scale3d(2/i.width,-2/i.height,0).array)}enable(){this.dText.DanmakuText.forEach(t=>{this.newDanmaku(t,!1)}),this.dText.useImageBitmap=this.c3d.hidden=!1,requestAnimationFrame(()=>this.draw())}disable(){this.clear(),this.c3d.hidden=!0}newDanmaku(t,e=!0){const n=this.gl;if(t.glDanmaku=!1,t._cache.height>this.maxTexSize||t._cache.width>this.maxTexSize)return void console.warn("Ignore a danmaku width too large size",t.danmaku);let i;(i=t.texture)||(i=t.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),e?u(()=>{n.bindTexture(n.TEXTURE_2D,i);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t._cache);t.glDanmaku=!0}):(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t._cache),t.glDanmaku=!0);let o=t.style.y-t.estimatePadding;t.vertCoord=new Float32Array([0,o,0,o,0,o+t._cache.height,0,o+t._cache.height])}}const l=new Float32Array([0,0,1,0,0,1,1,1]);n.default=c},{"../lib/Mat/Mat.js":4,"./textModuleTemplate.js":10}],9:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("./textModuleTemplate.js"),o=function(t){return t&&t.__esModule?t:{default:t}}(i);class r extends o.default{constructor(t){super(t),this.supported=t.text2d.supported,this.supported&&(t.frame.addStyle([`#${t.randomText}_textCanvasContainer canvas{will-change:transform;top:0;left:0;position:absolute;}`,`#${t.randomText}_textCanvasContainer.moving canvas{transition:transform 500s linear;}`,`#${t.randomText}_textCanvasContainer{will-change:transform;pointer-events:none;overflow:hidden;}`]),this.container=t.textCanvasContainer=document.createElement("div"),this.container.classList.add(`${t.randomText}_fullfill`),this.container.id=`${t.randomText}_textCanvasContainer`,t.container.appendChild(this.container))}_toggle(t){let e=this.dText,n=e.frame.time;this.container.classList[t?"add":"remove"]("moving");for(let i,o=e.DanmakuText.length;o--;)(i=e.DanmakuText[o]).danmaku.mode>=2||(t?requestAnimationFrame(()=>this._move(i)):this._move(i,n))}pause(){this._toggle(!1)}start(){this._toggle(!0)}rate(){this.resetPos()}_move(t,e){t.danmaku&&(void 0===e&&(e=this.dText.frame.time+5e5),t._cache.style.transform=`translate3d(${(10*(this.dText._calcSideDanmakuPosition(t,e)-t.estimatePadding)|0)/10}px,${t.style.y-t.estimatePadding}px,0)`)}resetPos(){this.pause(),this.dText.paused||requestAnimationFrame(()=>this.start())}resize(){this.resetPos()}remove(t){t._cache.parentNode&&this.container.removeChild(t._cache)}enable(){this.dText.DanmakuText.forEach(t=>this.newDanmaku(t)),this.container.hidden=!1}disable(){this.container.hidden=!0,this.container.innerHTML=""}newDanmaku(t){t._cache.style.transform=`translate3d(${t.style.x-t.estimatePadding}px,${t.style.y-t.estimatePadding}px,0)`,this.container.appendChild(t._cache),t.danmaku.mode<2&&!this.dText.paused&&requestAnimationFrame(()=>this._move(t))}}n.default=r},{"./textModuleTemplate.js":10}],10:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i{constructor(t){this.dText=t}draw(){}rate(){}pause(){}start(){}clear(){}resize(){}remove(){}enable(){}disable(){}newDanmaku(){}deleteTextObject(){}}n.default=i},{}],11:[function(t,e,n){function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function r(t){if(d===setTimeout)return setTimeout(t,0);if((d===i||!d)&&setTimeout)return d=setTimeout,setTimeout(t,0);try{return d(t,0)}catch(e){try{return d.call(null,t,0)}catch(e){return d.call(this,t,0)}}}function a(t){if(h===clearTimeout)return clearTimeout(t);if((h===o||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function s(){g&&m&&(g=!1,m.length?p=m.concat(p):y=-1,p.length&&u())}function u(){if(!g){var t=r(s);g=!0;for(var e=p.length;e;){for(m=p,p=[];++y<e;)m&&m[y].run();y=-1,e=p.length}m=null,g=!1,a(t)}}function c(t,e){this.fun=t,this.array=e}function l(){}var d,h,f=e.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:i}catch(t){d=i}try{h="function"==typeof clearTimeout?clearTimeout:o}catch(t){h=o}}();var m,p=[],g=!1,y=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new c(t,e)),1!==p.length||g||r(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=l,f.addListener=l,f.once=l,f.off=l,f.removeListener=l,f.removeAllListeners=l,f.emit=l,f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],12:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){Array.isArray(t)||(t=[t]);for(let n in e)n.split(/\,/g).forEach(function(i){t.forEach(function(t){t.addEventListener(i,e[n])})})}function r(t){try{(t.requestFullscreen||t.msRequestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullscreen).call(t)}catch(t){console.error(t),alert(_("Failed to change to fullscreen mode"))}}function a(){const t=document;(t.exitFullscreen||t.msExitFullscreen||t.mozCancelFullScreen||t.webkitCancelFullScreen).call(t)}function s(){const t=document;return!!(t.fullscreen||t.mozFullScreen||t.webkitIsFullScreen||t.msFullscreenElement)}function u(t,e){let n,i=0|t,o=i/3600|0;return e>=3600&&(i%=3600),n=[c(i/60|0),c(i%60)],e>=3600&&n.unshift(o),n.join(":")}function c(t){return t>9&&t||`0${t}`}function l(t,e){for(let n in e)t.setAttribute(n,e[n])}function d(t,e,n){return t<e?e:t>n?n:t}function h(t,e){return t+Math.random()*(e-t)+.5|0}function f(t){return t instanceof Array?t.slice():void 0!==t.length?Array.prototype.slice.call(t):[...t]}Object.defineProperty(n,"__esModule",{value:!0}),n.toArray=n.limitIn=n.setAttrs=n.padTime=n.rand=n.formatTime=n.isFullscreen=n.exitFullscreen=n.requestFullscreen=n.addEvents=n.NyaPlayerCore=void 0;var m=t("./i18n.js"),p=t("./danmaku.js"),g=i(p),y=t("../lib/Object2HTML/Object2HTML.js"),v=i(y);const _=m.i18n._;window.Object2HTML=v.default;const T={muted:!1,volume:1,loop:!1,defaultDanmakuColor:null,defaultDanmakuMode:0,defaultDanmakuSize:24,danmakuSend:(t,e)=>{e(!1)},textStyle:{},danmakuOption:{}};class x{constructor(){this._events={}}emit(t,...e){this._resolve(t,...e),this.globalHandle(t,...e)}_resolve(t,...e){if(t in this._events){const n=this._events[t];try{n.forEach(t=>{t.apply(this,e)})}catch(t){console.error(t)}}}addEventListener(t,e){this.on(t,e)}on(t,e){e instanceof Function&&(t in this._events||(this._events[t]=[]),this._events[t].push(e))}removeEvent(t,e){if(t in this._events){if(1===arguments.length)return void delete this._events[t];let n;(n=this._events[t].indexOf(e)>=0)&&this._events[t].splice(n,1),0===this._events[t].length&&delete this._events[t]}}globalHandle(t,...e){}}class w extends x{constructor(t){super(),t=this.opt=Object.assign({},T,t);const e=this.$={document:document,window:window,NP:this};this._={video:(0,v.default)({_:"video",attr:{id:"main_video"}}),playerMode:"normal"},this.container=(0,v.default)({_:"div",prop:{id:"danmaku_container"}}),this.videoFrame=(0,v.default)({_:"div",attr:{id:"video_frame"},child:[this.video,this.container,{_:"div",attr:{id:"loading_frame"},child:[{_:"div",attr:{id:"loading_anime"},child:["(๑•́ ω •̀๑)"]},{_:"div",attr:{id:"loading_info"}}]}]}),this.collectEles(this.videoFrame),this.loadingInfo(_("Loading danmaku frame")),this.Danmaku=new g.default(this),this._.loadingAnimeInterval=setInterval(()=>{e.loading_anime.style.transform="translate("+h(-20,20)+"px,"+h(-20,20)+"px) rotate("+h(-10,10)+"deg)"},80),setTimeout(e=>{["src","muted","volume","loop"].forEach(e=>{void 0!==t[e]&&(this.video[e]=t[e])})},0);{let t=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"loop");Object.defineProperty(this.video,"loop",{get:t.get,set:function(e){e!==this.loop&&(this.dispatchEvent(Object.assign(new Event("_loopChange"),{value:e})),t.set.call(this,e))}})}o(this.video,{loadedmetadata:t=>{clearInterval(this._.loadingAnimeInterval);e.loading_frame.parentNode.removeChild(e.loading_frame)},error:t=>{clearInterval(this._.loadingAnimeInterval);loading_anime.style.transform="";loading_anime.innerHTML="(๑• . •๑)"}}),this.emit("coreLoad")}playToggle(t=this.video.paused){this.video[t?"play":"pause"]()}loadingInfo(t){this.$.loading_info.appendChild((0,v.default)({_:"div",child:[t]}))}collectEles(t){const e=this.$;t.id&&!e[t.id]&&(e[t.id]=t),f(t.querySelectorAll("*")).forEach(t=>{t.id&&!e[t.id]&&(e[t.id]=t)})}playerMode(t="normal"){if("normal"!==t||this._.playerMode!==t){this.$;switch("fullPage"===this._.playerMode?this.player.style.position="":"fullScreen"===this._.playerMode&&a(),"normal"!==t&&this._.playerMode===t&&(t="normal"),t){case"fullPage":this.player.style.position="fixed",this.player.setAttribute("playerMode","fullPage");break;case"fullScreen":this.player.setAttribute("playerMode","fullScreen"),r(this.player);break;default:this.player.setAttribute("playerMode","normal")}this._.playerMode=t,this.emit("playerModeChange",t)}}get danmakuFrame(){return this.Danmaku.danmakuFrame}get player(){return this._.player}get video(){return this._.video}get src(){return this.video.src}set src(t){this.video.src=t}get TextDanmaku(){return this.danmakuFrame.modules.TextDanmaku}get videoSize(){return[this.video.videoWidth,this.video.videoHeight]}}String.prototype.startsWith||(String.prototype.startsWith=function(t,e=0){return this.substr(e,t.length)===t}),Object.assign||(Object.assign=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),i=1;i<arguments.length;i++){var o=arguments[i];if(null!=o)for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(n[r]=o[r])}return n}),Array.from||(Array.from=function(t,e){t instanceof Array||(t=f(t));for(var n=new Array(t.length),i=t.length;i--;)n[i]=e?e(t[i],i):t[i];return n}),Number.isInteger||(Number.isInteger=function(t){return(0|t)===t}),n.default=w,n.NyaPlayerCore=w,n.addEvents=o,n.requestFullscreen=r,n.exitFullscreen=a,n.isFullscreen=s,n.formatTime=u,n.rand=h,n.padTime=c,n.setAttrs=l,n.limitIn=d,n.toArray=f},{"../lib/Object2HTML/Object2HTML.js":1,"./danmaku.js":14,"./i18n.js":15}],13:[function(t,e,n){"use strict";function i(t,e,n,i){return Math.sqrt((t-n)*(t-n)+(e-i)*(e-i))}var o=t("./i18n.js"),r=t("../lib/Object2HTML/Object2HTML.js"),a=function(t){return t&&t.__esModule?t:{default:t}}(r),s=t("./NyaPCore.js");const u=o.i18n._,c={danmakuColors:["fff","6cf","ff0","f00","0f0","00f","f0f","000"],danmakuModes:[0,3,2,1],danmakuSizes:[20,24,36],dragToSeek:!0,dragToChangeVolume:!0,bottomControlHeight:50,progressBarHeight:14,progressPad:10};class l extends s.NyaPlayerCore{constructor(t){function e(t,e,i={}){const o=l[t];return(0,a.default)({_:"span",event:e,attr:i,prop:{id:`icon_span_${t}`,innerHTML:`<svg height="${n.opt.bottomControlHeight}" width="${n.opt.bottomControlHeight/o[1]*o[0]}" viewBox="0,0,${o[0]},${o[1]}" id="icon_${t}"">${o[2]}</svg>`}})}super(Object.assign({},c,t)),t=this.opt;const n=this,i=n.$,o=n.video,l={play:[30,30,'<path d="m10.063,8.856l9.873,6.143l-9.873,6.143v-12.287z" stroke-width="3" stroke-linejoin="round"/>'],fullScreen:[30,30,'<rect stroke-linejoin="round" height="11.169" width="17.655" y="9.415" x="6.172" stroke-width="1.5"/><path stroke-linejoin="round" d="m12.361,11.394l-3.604,3.605l3.605,3.605l1.311,-1.311l-2.294,-2.294l2.293,-2.294l-1.311,-1.311zm5.275,0l-1.310,1.311l2.293,2.294l-2.293,2.293l1.310,1.311l3.605,-3.605l-3.605,-3.605z"/>'],loop:[30,30,'<path stroke-linejoin="round" stroke-width="1" d="m20.945,15.282c-0.204,-0.245 -0.504,-0.387 -0.823,-0.387c-0.583,0 -1.079,0.398 -1.205,0.969c-0.400,1.799 -2.027,3.106 -3.870,3.106c-2.188,0 -3.969,-1.780 -3.969,-3.969c0,-2.189 1.781,-3.969 3.969,-3.969c0.720,0 1.412,0.192 2.024,0.561l-0.334,0.338c-0.098,0.100 -0.127,0.250 -0.073,0.380c0.055,0.130 0.183,0.213 0.324,0.212l2.176,0.001c0.255,-0.002 0.467,-0.231 0.466,-0.482l-0.008,-2.183c-0.000,-0.144 -0.085,-0.272 -0.217,-0.325c-0.131,-0.052 -0.280,-0.022 -0.379,0.077l-0.329,0.334c-1.058,-0.765 -2.340,-1.182 -3.649,-1.182c-3.438,0 -6.236,2.797 -6.236,6.236c0,3.438 2.797,6.236 6.236,6.236c2.993,0 5.569,-2.133 6.126,-5.072c0.059,-0.314 -0.022,-0.635 -0.227,-0.882z"/>'],danmakuStyle:[30,30,'<path style="fill-opacity:1!important" d="m21.781,9.872l-1.500,-1.530c-0.378,-0.385 -0.997,-0.391 -1.384,-0.012l-0.959,0.941l2.870,2.926l0.960,-0.940c0.385,-0.379 0.392,-0.998 0.013,-1.383zm-12.134,7.532l2.871,2.926l7.593,-7.448l-2.872,-2.927l-7.591,7.449l0.000,0.000zm-1.158,2.571l-0.549,1.974l1.984,-0.511l1.843,-0.474l-2.769,-2.824l-0.509,1.835z" stroke-width="0"/>'],danmakuToggle:[30,30,'<path d="m8.569,10.455l0,0c0,-0.767 0.659,-1.389 1.473,-1.389l0.669,0l0,0l3.215,0l6.028,0c0.390,0 0.765,0.146 1.041,0.406c0.276,0.260 0.431,0.613 0.431,0.982l0,3.473l0,0l0,2.083l0,0c0,0.767 -0.659,1.389 -1.473,1.389l-6.028,0l-4.200,3.532l0.985,-3.532l-0.669,0c-0.813,0 -1.473,-0.621 -1.473,-1.389l0,0l0,-2.083l0,0l0,-3.473z"/>'],volume:[30,30,'<ellipse id="volume_circle" style="fill-opacity:.6!important" ry="6" rx="6" cy="15" cx="15" stroke-dasharray="38 90" stroke-width="1.8"/>']};n.loadingInfo(u("Creating touch player")),n._.player=(0,r.Object2HTML)({_:"div",attr:{class:"NyaPTouch",id:"NyaPTouch"},child:[n.videoFrame,{_:"div",prop:{id:"controls"},child:[{_:"div",prop:{id:"control_bottom"},child:[{_:"div",attr:{id:"control_bottom_first"},child:[{_:"div",attr:{id:"progress_leftside_button"},child:[e("play",{click:t=>n.playToggle()})]},{_:"div",prop:{id:"progress_info"},child:[{_:"span",attr:{id:"progress_frame"},child:[{_:"div",prop:{id:"progress_wrap"},child:[{_:"div",prop:{id:"buffed_bar"}},{_:"div",prop:{id:"progress_bar"}},{_:"div",prop:{id:"seekTo_bar",hidden:!0}}]}]},{_:"span",prop:{id:"time"},child:[{_:"span",prop:{id:"current_time"},child:["00:00"]},"/",{_:"span",prop:{id:"total_time"},child:["00:00"]}]}]},{_:"span",prop:{id:"progress_rightside_button"},child:[e("fullScreen",{click:t=>n.playerMode("fullScreen")})]}]},{_:"div",attr:{id:"control_bottom_second"},child:[e("danmakuStyle"),{_:"input",attr:{id:"danmaku_input",placeholder:u("Input danmaku here")}},e("danmakuToggle",{click:t=>this.Danmaku.toggle("TextDanmaku")}),e("loop",{click:t=>o.loop=!o.loop}),e("volume",{click:t=>o.muted=!o.muted})]}]}]}]}),n.videoFrame.appendChild((0,a.default)({_:"div",attr:{id:"msg_box"}})),n.collectEles(n._.player),Object.assign(n._,{currentDragMode:null,touchStartPoint:[0,0],bottomControlDraging:!1,bottomControlTransformY:0}),Object.assign(i.progress_wrap.style,{left:n.opt.progressPad+"px",right:n.opt.progressPad+"px",height:n.opt.progressBarHeight+"px",marginTop:-n.opt.progressBarHeight/2+1+"px"}),i.control_bottom.style.marginTop=`-${n.opt.bottomControlHeight}px`,f.touchdrag(i.main_video,{allowMultiTouch:!1,preventDefaultX:!0}),f.touchdrag(i.control_bottom,{allowMultiTouch:!1,preventDefaultY:!0});const d={document:{"fullscreenchange,mozfullscreenchange,webkitfullscreenchange,msfullscreenchange":t=>{"fullScreen"!=n._.playerMode||(0,s.isFullscreen)()||n.playerMode("normal")}},main_video:{playing:t=>n._iconActive("play",!0),"pause,stalled":t=>{n._iconActive("play",!1)},loadedmetadata:t=>{n._setTimeInfo(null,(0,s.formatTime)(o.duration,o.duration))},_loopChange:t=>n._iconActive("loop",t.value),volumechange:t=>{(0,s.setAttrs)(i.volume_circle,{"stroke-dasharray":`${12*o.volume*Math.PI} 90`,style:`fill-opacity:${o.muted?.2:.6}!important`})},progress:t=>n.drawProgress(),click:t=>{t.preventDefault();n.controlsToggle()},timeupdate:t=>{if(Date.now()-n._.lastTimeUpdate<30)return;n._setTimeInfo((0,s.formatTime)(o.currentTime,o.duration));n.drawProgress();n._.lastTimeUpdate=Date.now()},touchstart:t=>{let e=t.changedTouches[0];if(n._.currentDragMode)return;n._.touchStartPoint=[e.clientX,e.clientY]},touchdrag:e=>{n._.currentDragMode||t.dragToSeek&&Math.abs(e.deltaX)>Math.abs(e.deltaY)&&(n._.currentDragMode="seek",n._.seekTo=o.currentTime);switch(n._.currentDragMode){case"volume":o.volume=(0,s.limitIn)(o.volume-e.deltaY/200,0,1);break;case"seek":{let t=1+Math.abs(e.touches[0].clientY-n._.touchStartPoint[1])/5;n._.seekTo=(0,s.limitIn)(n._.seekTo+e.deltaX/100*t,0,o.duration),n.emit("seekMark",n._.seekTo);break}}},touchend:t=>{"seek"===n._.currentDragMode&&(o.currentTime=n._.seekTo,i.progress_bar.style.width=`${(n._.seekTo/o.duration*100).toFixed(2)}%`,n.$.seekTo_bar.hidden=!0,n._setTimeInfo(null,(0,s.formatTime)(o.duration,o.duration)));n._.currentDragMode=null},contextmenu:e=>{e.preventDefault();if(!t.dragToChangeVolume)return;n._.currentDragMode="volume"}},control_bottom:{touchdrag:t=>{n._.bottomControlDraging=!0;n._.bottomControlTransformY=(0,s.limitIn)(n._.bottomControlTransformY-t.deltaY,0,i.control_bottom.offsetHeight-n.opt.bottomControlHeight);i.control_bottom.style.transform=`translate3d(0,-${n._.bottomControlTransformY}px,0)`},touchend:t=>{if(!n._.bottomControlDraging)return;let e=i.control_bottom.offsetHeight-n.opt.bottomControlHeight;n._.bottomControlTransformY=n._.bottomControlTransformY<e/2?0:e;i.control_bottom.style.transform=`translate3d(0,-${n._.bottomControlTransformY}px,0)`}},progress_frame:{click:t=>{let e=t.target,i=n.opt.progressPad,r=(0,s.limitIn)((t.offsetX-i)/(e.offsetWidth-2*i),0,1);o.currentTime=r*o.duration}},NP:{danmakuToggle:t=>this._iconActive("danmakuToggle",t),seekMark:t=>{i.seekTo_bar.hidden&&(i.seekTo_bar.hidden=!1);i.seekTo_bar.style.width=`${(t/o.duration*100).toFixed(2)}%`;n._setTimeInfo(null,(0,s.formatTime)(t,o.duration))},playerModeChange:t=>{["fullScreen"].forEach(e=>{n._iconActive(e,t===e)})}}};for(let t in i){let e=d[t];e&&(0,s.addEvents)(i[t],e)}t.playerFrame instanceof HTMLElement&&t.playerFrame.appendChild(n.player)}danmakuInput(){}send(){}controlsToggle(t=this.$.controls.hidden){this.$.controls.hidden=!t}drawProgress(){requestAnimationFrame(()=>{const t=this.video,e=t.buffered,n=t.duration;let i=0;e.length&&(i=e.end(e.length-1));this.$.buffed_bar.style.width=`${(i/n*100).toFixed(2)}%`;this.$.progress_bar.style.width=`${(t.currentTime/n*100).toFixed(2)}%`})}_iconActive(t,e){this.$[`icon_span_${t}`].classList[e?"add":"remove"]("active_icon")}_setTimeInfo(t=null,e=null){requestAnimationFrame(()=>{null!==t&&(this.$.current_time.innerHTML=t);null!==e&&(this.$.total_time.innerHTML=e)})}msg(t,e="tip"){let n=new d(t,e);this.$.msg_box.appendChild(n.msg),requestAnimationFrame(()=>n.show())}}class d{constructor(t,e){this.using=!1,(this.msg=(0,a.default)({_:"div",attr:{class:`msg_type_${e}`},child:[t]})).addEventListener("click",()=>this.remove()),t instanceof HTMLElement&&(t=t.textContent);let n=String(t).match(/\w+|\S/g);this.timeout=setTimeout(()=>this.remove(),Math.max(.6*(n?n.length:0)*1e3,5e3))}show(){this.msg.style.opacity=0,setTimeout(()=>{this.using=!0;this.msg.style.opacity=1},0)}remove(){this.using&&(this.using=!1,this.msg.style.opacity=0,this.timeout&&(clearTimeout(this.timeout),this.timeout=0),setTimeout(()=>{this.msg.parentNode.removeChild(this.msg)},600))}}var h={touchdrag:{preventDefault:!1,preventDefaultX:!1,preventDefaultY:!1,allowMultiTouch:!1},doubletouch:{preventDefault:!0}},f={touchdrag:function(t,e){let n={};e=Object.assign({},h.touchdrag,e),t.addEventListener("touchstart",function(t){if(!e.allowMultiTouch&&t.changedTouches.length>1)return void(n={});let i=t.changedTouches;for(let t=i.length;t--;)n[i[t].identifier]=[i[t].clientX,i[t].clientY]}),t.addEventListener("touchmove",function(i){if(e.allowMultiTouch||!(i.touches.length>1)){let o=i.changedTouches;for(let r=o.length;r--;){let a=o[r].identifier;if(!(!a in n)){let s=new TouchEvent("touchdrag",i);s.deltaX=o[r].clientX-n[a][0],s.deltaY=o[r].clientY-n[a][1],n[a]=[o[r].clientX,o[r].clientY],(e.preventDefault||e.preventDefaultX&&Math.abs(s.deltaX)>Math.abs(s.deltaY)||e.preventDefaultY&&Math.abs(s.deltaX)<Math.abs(s.deltaY))&&i.preventDefault(),t.dispatchEvent(s)}}}})},doubletouch:function(t,e){let n=[],o=0,r=!1,a=!1,u=!1;return e=Object.assign({},h.doubletouch,e),t.addEventListener("touchstart",function(c){let l=c.touches.length>1?(0,s.toArray)(c.touches):[c.touches[0]],d=n;if(n=l,u){if(c.timeStamp-o>400)return void(u=!1)}else o=c.timeStamp,u=!0;if(l.length===d.length&&a){let n=[];for(let t=l.length;t--;)n.push([d[t].clientX,d[t].clientY]);for(let t=l.length;t--;)for(let e=n.length;e--;)i(l[t].clientX,l[t].clientY,n[e][0],n[e][1])<=6&&n.splice(e,1);if(0===n.length){e.preventDefault&&c.preventDefault();let n=new TouchEvent("doubletouch",c);n.points=l.length,t.dispatchEvent(n),u=a=!1,r=!0}}}),t.addEventListener("touchend",function(t){0!==t.touches.length||r||(a=!0),r=!1}),listeners}};window.NyaPTouch=l},{"../lib/Object2HTML/Object2HTML.js":1,"./NyaPCore.js":12,"./i18n.js":15}],14:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("../lib/danmaku-frame/src/danmaku-frame.js"),o=t("../lib/danmaku-text/src/danmaku-text.js");(0,function(t){return t&&t.__esModule?t:{default:t}}(o).default)(i.DanmakuFrame,i.DanmakuFrameModule);const r=["color","text","size","mode","time"];class a{constructor(t){this.core=t,this.danmakuFrame=new i.DanmakuFrame(t.container),this.danmakuFrame.setMedia(t.video),this.danmakuFrame.enable("TextDanmaku"),this.setTextDanmakuOptions(t.opt.danmakuOption),this.setDefaultTextStyle(t.opt.textStyle)}load(t){return this.danmakuFrame.load(t)}loadList(t){this.danmakuFrame.loadList(t)}remove(t){this.danmakuFrame.unload(t)}toggle(t,e){try{void 0==e&&(e=!this.module(t).enabled),this.danmakuFrame[e?"enable":"disable"](t),this.emit("danmakuToggle",t,this.module(t).enabled)}catch(t){return!1}return!0}at(t,e){return this.module("TextDanmaku").danmakuAt(t,e)}module(t){return this.danmakuFrame.modules[t]}send(t,e){for(let e of r)if(e in t==!1)return!1;return!(t.text||"").match(/^\s*$/)&&(t.color=this.isVaildColor(t.color),t.color?t.color=t.color.replace(/\$/g,()=>"0123456789abcdef"[limitIn(16*Math.random()|0,0,15)]):t.color=null,this.core.opt.danmakuSend instanceof Function&&(this.core.opt.danmakuSend(t,e||(()=>{})),!0))}isVaildColor(t){return"string"==typeof t&&(t=!!t.match(/^#?(([\da-f\$]{3}){1,2})$/i)&&t[1])}setDefaultTextStyle(t){if(t)for(let e in t)this.module("TextDanmaku").defaultStyle[e]=t[e]}setTextDanmakuOptions(t){if(t)for(let e in t)this.module("TextDanmaku").options[e]=t[e]}}n.default=a},{"../lib/danmaku-frame/src/danmaku-frame.js":3,"../lib/danmaku-text/src/danmaku-text.js":6}],15:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i={lang:null,langs:{},_:(t,...e)=>{let n=i.lang&&i.langs[i.lang][t]||t;e.length&&e.forEach((t,e)=>{n=n.replace(`$${e}`,t)});return n}};i.langs["zh-CN"]={play:"播放",Send:"发送",pause:"暂停",muted:"静音",settings:"设置","loop(L)":"循环(L)","hex color":"Hex颜色","full page(P)":"全页模式(P)","Creating player":"创建播放器","full screen(F)":"全屏模式(F)","danmaku toggle(D)":"弹幕开关(D)","Input danmaku here":"在这里输入弹幕","Loading danmaku frame":"加载弹幕框架","danmaku input(Enter)":"弹幕输入框(回车)","volume($0)([shift]+↑↓)":"音量($0)([shift]+↑↓)","Failed to change to fullscreen mode":"无法切换到全屏模式"},navigator.languages||(navigator.languages=[navigator.language||navigator.browserLanguage]);for(let t of[...navigator.languages]){if(i.langs[t]){i.lang=t;break}let e=t.match(/^\w+/)[0];for(let t in i.langs)if(t.startsWith(e)){i.lang=t;break}if(i.lang)break}console.debug("Language:"+i.lang),n.i18n=i},{}]},{},[13]);