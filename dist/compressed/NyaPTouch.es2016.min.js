!function e(t,n,i){function a(o,s){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[o]={exports:{}};t[o][0].call(d.exports,function(e){var n=t[o][1][e];return a(n||e)},d,d.exports,e,t,n,i)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<i.length;o++)a(i[o]);return a}({1:[function(e,t,n){"use strict";function i(e){return"object"==typeof e}function a(e,t){let n,r,o;if("string"==typeof e||"number"==typeof e)return document.createTextNode(e);if(null!==e&&"object"==typeof e&&"_"in e!=!1&&"string"==typeof e._&&""!=e._){if(n=document.createElement(e._),i(e.attr))for(r in e.attr)n.setAttribute(r,e.attr[r]);if(i(e.prop))for(r in e.prop)n[r]=e.prop[r];if(i(e.event))for(r in e.event)n.addEventListener(r,e.event[r]);return i(e.child)&&e.child.length>0&&e.child.forEach(e=>{o=e instanceof Node?e:a(e,t);o instanceof Node&&n.appendChild(o)}),t&&t(n),n}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=a,n.Object2HTML=a},{}],2:[function(e,t,n){"use strict";!function(e,i){"function"==typeof define&&define.amd?define(i):"object"==typeof n?t.exports=i():e.ResizeSensor=i()}(void 0,function(){function e(e,t){var n=Object.prototype.toString.call(e),i="[object Array]"===n||"[object NodeList]"===n||"[object HTMLCollection]"===n||"[object Object]"===n||"undefined"!=typeof jQuery&&e instanceof jQuery||"undefined"!=typeof Elements&&e instanceof Elements,a=0,r=e.length;if(i)for(;a<r;a++)t(e[a]);else t(e)}if("undefined"==typeof window)return null;var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,20)},n=function(i,a){function r(){var e=[];this.add=function(t){e.push(t)};var t,n;this.call=function(){for(t=0,n=e.length;t<n;t++)e[t].call()},this.remove=function(i){var a=[];for(t=0,n=e.length;t<n;t++)e[t]!==i&&a.push(e[t]);e=a},this.length=function(){return e.length}}function o(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.style[t]}function s(e,n){if(e.resizedAttached)return void e.resizedAttached.add(n);e.resizedAttached=new r,e.resizedAttached.add(n),e.resizeSensor=document.createElement("div"),e.resizeSensor.className="resize-sensor";var i="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;",a="position: absolute; left: 0; top: 0; transition: 0s;";e.resizeSensor.style.cssText=i,e.resizeSensor.innerHTML='<div class="resize-sensor-expand" style="'+i+'"><div style="'+a+'"></div></div><div class="resize-sensor-shrink" style="'+i+'"><div style="'+a+' width: 200%; height: 200%"></div></div>',e.appendChild(e.resizeSensor),"static"==o(e,"position")&&(e.style.position="relative");var s,u,c,d,l=e.resizeSensor.childNodes[0],h=l.childNodes[0],f=e.resizeSensor.childNodes[1],m=e.offsetWidth,g=e.offsetHeight,p=function(){h.style.width="100000px",h.style.height="100000px",l.scrollLeft=1e5,l.scrollTop=1e5,f.scrollLeft=1e5,f.scrollTop=1e5};p();var y=function(){u=0,s&&(m=c,g=d,e.resizedAttached&&e.resizedAttached.call())},v=function(){c=e.offsetWidth,d=e.offsetHeight,s=c!=m||d!=g,s&&!u&&(u=t(y)),p()},x=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)};x(l,"scroll",v),x(f,"scroll",v)}e(i,function(e){s(e,a)}),this.detach=function(e){n.detach(i,e)}};return n.detach=function(t,n){e(t,function(e){e.resizedAttached&&"function"==typeof n&&(e.resizedAttached.remove(n),e.resizedAttached.length())||e.resizeSensor&&(e.contains(e.resizeSensor)&&e.removeChild(e.resizeSensor),delete e.resizeSensor,delete e.resizedAttached)})},n})},{}],3:[function(e,t,n){"use strict";function i(e,t={}){for(let n in t)n.split(/\,/g).forEach(i=>e.addEventListener(i,t[n]))}Object.defineProperty(n,"__esModule",{value:!0}),n.ResizeSensor=n.DanmakuFrameModule=n.DanmakuFrame=void 0;var a=e("../lib/ResizeSensor.js"),r=function(e){return e&&e.__esModule?e:{default:e}}(a);class o{constructor(e){const t=this;t.container=e||document.createElement("div"),t.rate=1,t.timeBase=t.width=t.height=t.fps=0,t.fpsTmp=0,t.fpsRec=t.fps||60,t.media=null,t.working=!1,t.modules={},t.moduleList=[];const n=document.createElement("style");document.head.appendChild(n),t.styleSheet=n.sheet;for(let e in o.moduleList)t.initModule(e);setTimeout(()=>{t.container.ResizeSensor=new r.default(t.container,()=>{t.resize()});t.resize()},0),setInterval(()=>{t.fpsRec=t.fpsTmp;t.fpsTmp=0},1e3),t.draw=t.draw.bind(t)}enable(e){let t=this.modules[e];return t?(t.enabled=!0,t.enable&&t.enable(),!0):this.initModule(e)}disable(e){let t=this.modules[e];return!!t&&(t.enabled=!1,t.disable&&t.disable(),!0)}addStyle(e){"string"==typeof e&&(e=[e]),e instanceof Array!=!1&&e.forEach(e=>this.styleSheet.insertRule(e,this.styleSheet.cssRules.length))}initModule(e){let t=o.moduleList[e];if(!t)throw"Module ["+e+"] does not exist.";let n=new t(this);if(n instanceof s==!1)throw"Constructor of "+e+" is not extended from DanmakuFrameModule";return n.enabled=!0,this.modules[e]=n,this.moduleList.push(e),console.debug(`Mod Inited: ${e}`),!0}set time(e){this.media||(this.timeBase=Date.now()-e),this.moduleFunction("time",e)}get time(){return this.media?1e3*this.media.currentTime|0:Date.now()-this.timeBase}draw(e){this.working&&(this.fpsTmp++,this.moduleFunction("draw",e),0===this.fps?requestAnimationFrame(()=>this.draw()):setTimeout(this.draw,1e3/this.fps))}load(e){this.moduleFunction("load",e)}loadList(e){this.moduleFunction("loadList",e)}unload(e){this.moduleFunction("unload",e)}start(){this.working||(this.working=!0,this.moduleFunction("start"),this.draw(!0))}pause(){this.working=!1,this.moduleFunction("pause")}resize(){this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.moduleFunction("resize")}moduleFunction(e,t){for(let n,i=0;i<this.moduleList.length;i++)n=this.modules[this.moduleList[i]],n.enabled&&n[e]&&n[e](t)}setMedia(e){const t=this;t.media=e,i(e,{playing:()=>t.start(),pause:()=>t.pause(),ratechange:()=>{t.rate=t.media.playbackRate;t.moduleFunction("rate",t.rate)}}),t.moduleFunction("media",e)}static addModule(e,t){if(e in this.moduleList)return void console.warn('The module "'+e+'" has already been added.');this.moduleList[e]=t}}o.moduleList={};class s{constructor(e){this.frame=e,this.enabled=!1}}n.DanmakuFrame=o,n.DanmakuFrameModule=s,n.ResizeSensor=r.default},{"../lib/ResizeSensor.js":2}],4:[function(e,t,n){"use strict";!function(e){"function"==typeof define&&define.amd?define(e):"object"==typeof n?t.exports=e():(0,eval)("this").Mat=e()}(function(){function e(t){class i{constructor(e,n,a=0){this.array=new t(e*n),Object.defineProperty(this.array,"row",{value:e}),Object.defineProperty(this.array,"column",{value:n}),3==arguments.length&&(i._instanceofTypedArray&&0===a||("number"==typeof a?this.fill(a):a.length&&this.set(a)))}get length(){return this.array.length}get row(){return this.array.row}get column(){return this.array.column}leftMultiply(e){return this.set(i.multiply(e,this,new i(e.row,this.column)))}rightMultiply(e){return this.set(i.multiply(this,e,new i(this.row,e,column)))}fill(e){arguments.length||(e=0);for(let t=this.length;t--;)this.array[t]=e;return this}set(e,t){t||(t=0),e instanceof i&&(e=e.array);for(let n=e.length+t<=this.length?e.length:this.length-t;n--;)this.array[t+n]=e[n];return this}put(e,t,n){return i.put(this,e,t||0,n||0),this}rotate2d(e){return this.set(i.rotate2d(this,e,i.Matrixes.T3))}translate2d(e,t){return this.set(i.translate2d(this,e,t,i.Matrixes.T3))}scale2d(e,t){return this.set(i.scale2d(this,e,t,i.Matrixes.T3))}rotate3d(e,t,n){return this.set(i.rotate3d(this,e,t,n,i.Matrixes.T4))}scale3d(e,t,n){return this.set(i.scale3d(this,e,t,n,i.Matrixes.T4))}translate3d(e,t,n){return this.set(i.translate3d(this,e,t,n,i.Matrixes.T4))}rotateX(e){return this.set(i.rotateX(this,e,i.Matrixes.T4))}rotateY(e){return this.set(i.rotateY(this,e,i.Matrixes.T4))}rotateZ(e){return this.set(i.rotateZ(this,e,i.Matrixes.T4))}clone(){return new i(this.row,this.column,this)}toString(){if(0===this.length)return"";for(var e=0,t=[],n=[];e<this.length;e++)e&&e%this.column==0&&(t.push(n.join("\t")),n.length=0),n.push(this.array[e]||0);return t.push(n.join("\t")),t.join("\n")}static Identity(e){let t=new i(e,e,0);for(let n=e;n--;)t.array[n*e+n]=1;return t}static Perspective(e,t,n,a,r){var o=n*Math.tan(e*Math.PI/360),s=o*t,u=r||new i(4,4,0),c=u.array;return c[0]=2*n/(s+s),c[5]=2*n/(o+o),c[10]=-(a+n)/(a-n),c[14]=-2*a*n/(a-n),c[11]=-1,r&&(c[1]=c[2]=c[3]=c[4]=c[6]=c[7]=c[8]=c[9]=c[12]=c[13]=c[15]=0),u}static multiply(e,t,n){if(e.column!==t.row)throw"wrong matrix";let a,r,o,s=e.row,u=Math.min(e.column,t.column),c=n||new i(s,u);for(let n=s;n--;)for(a=u;a--;)for(c.array[o=n*c.column+a]=0,r=e.column;r--;)c.array[o]+=e.array[n*e.column+r]*t.array[a+r*t.column];return c}static multiplyString(e,t,n,a=!0){if(e.column!==t.row)throw"wrong matrix";var r,o,s,u,c=n||new i(e.row,t.column);for(r=e.row;r--;)for(o=t.column;o--;)for(c.array[u=r*t.column+o]="",s=0;s<e.column;s++)(!a||0!=e.array[r*e.column+s]&&0!=t.array[o+s*t.column])&&(c.array[u]+=(s&&c.array[u]?"+":"")+"("+e.array[r*e.column+s]+")*("+t.array[o+s*t.column]+")");return c}static add(e,t,n){if(e.column!==t.column||e.row!==t.row)throw"wrong matrix";let a=n||new i(e.row,t.column);for(let n=e.length;n--;)a.array[n]=e.array[n]+t.array[n];return a}static minus(e,t,n){if(e.column!==t.column||e.row!==t.row)throw"wrong matrix";let a=n||new i(e.row,t.column);for(let n=e.length;n--;)a.array[n]=e.array[n]-t.array[n];return a}static rotate2d(e,t,n){const a=i.Matrixes.rotate2d;return a.array[0]=a.array[4]=Math.cos(t),a.array[1]=-(a.array[3]=Math.sin(t)),i.multiply(a,e,n||new i(3,3))}static scale2d(e,t,n,a){const r=i.Matrixes.scale2d;return r.array[0]=t,r.array[4]=n,i.multiply(r,e,a||new i(3,3))}static translate2d(e,t,n,a){const r=i.Matrixes.translate2d;return r.array[2]=t,r.array[5]=n,i.multiply(r,e,a||new i(3,3))}static rotate3d(e,t,n,a,r){const o=Math.cos(t),s=Math.sin(t),u=Math.cos(n),c=Math.sin(n),d=Math.cos(a),l=Math.sin(a),h=i.Matrixes.rotate3d;return h.array[0]=d*u,h.array[1]=d*c*s-l*o,h.array[2]=d*c*o+l*s,h.array[4]=l*u,h.array[5]=l*c*s+d*o,h.array[6]=l*c*o-d*s,h.array[8]=-c,h.array[9]=u*s,h.array[10]=u*o,i.multiply(h,e,r||new i(4,4))}static rotateX(e,t,n){const a=i.Matrixes.rotateX;return a.array[10]=a.array[5]=Math.cos(t),a.array[6]=-(a.array[9]=Math.sin(t)),i.multiply(a,e,n||new i(4,4))}static rotateY(e,t,n){const a=i.Matrixes.rotateY;return a.array[10]=a.array[0]=Math.cos(t),a.array[8]=-(a.array[2]=Math.sin(t)),i.multiply(a,e,n||new i(4,4))}static rotateZ(e,t,n){const a=i.Matrixes.rotateZ;return a.array[5]=a.array[0]=Math.cos(t),a.array[1]=-(a.array[4]=Math.sin(t)),i.multiply(a,e,n||new i(4,4))}static scale3d(e,t,n,a,r){const o=i.Matrixes.scale3d;return o.array[0]=t,o.array[5]=n,o.array[10]=a,i.multiply(o,e,r||new i(4,4))}static translate3d(e,t,n,a,r){const o=i.Matrixes.translate3d;return o.array[12]=t,o.array[13]=n,o.array[14]=a,i.multiply(o,e,r||new i(4,4))}static put(e,t,n,i){let a;n||(n=0),i||(i=0);for(let r=t.row;r--;)if(!(r+n>=e.row))for(a=t.column;a--;)a+i>=e.column||(e.array[(r+n)*e.column+a+i]=t.array[r*t.column+a])}static createClass(t){return e(t)}}var a=new t(1);return Object.defineProperty(i,"_instanceofTypedArray",{value:!(!n||!n.isPrototypeOf(a))}),a=null,i.Matrixes={I2:i.Identity(2),I3:i.Identity(3),I4:i.Identity(4),T3:new i(3,3,0),T4:new i(4,4,0),rotate2d:i.Identity(3),translate2d:i.Identity(3),scale2d:i.Identity(3),translate3d:i.Identity(4),rotate3d:i.Identity(4),rotateX:i.Identity(4),rotateY:i.Identity(4),rotateZ:i.Identity(4),scale3d:i.Identity(4)},i}const t=(0,eval)("this"),n=t.Float32Array&&t.Float32Array.prototype;return e(t.Float32Array?Float32Array:Array)})},{}],5:[function(e,t,n){(function(e,t){"use strict";!function(t,n){function i(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return c[u]=i,s(u),u++}function a(e){delete c[e]}function r(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i)}}function o(e){if(d)setTimeout(o,0,e);else{var t=c[e];if(t){d=!0;try{r(t)}finally{a(e),d=!1}}}}if(!t.setImmediate){var s,u=1,c={},d=!1,l=t.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(t);h=h&&h.setTimeout?h:t,"[object process]"==={}.toString.call(t.process)?function(){s=function(t){e.nextTick(function(){o(t)})}}():function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?function(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&o(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),s=function(n){t.postMessage(e+n,"*")}}():t.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){o(e.data)},s=function(t){e.port2.postMessage(t)}}():l&&"onreadystatechange"in l.createElement("script")?function(){var e=l.documentElement;s=function(t){var n=l.createElement("script");n.onreadystatechange=function(){o(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():function(){s=function(e){setTimeout(o,0,e)}}(),h.setImmediate=i,h.clearImmediate=a}}("undefined"==typeof self?void 0===t?void 0:t:self)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:11}],6:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){function n(e,t,n,i,a=!1){if(0===e.length)return 0;let r=n,o=i;for(;n<=i;)r=n+i>>1,t<=e[r].time?i=r-1:n=r+1;if(a)for(;n>0&&e[n-1].time===t;)n--;else for(;n<=o&&e[n].time===t;)n++;return n}const i=Object.defineProperty,a=window.requestIdleCallback||setImmediate;let o=!1;class u extends t{constructor(e){super(e);const t=this;t.list=[],t.indexMark=0,t.tunnel=new h,t.paused=!0,t.randomText=`danmaku_text_${999999*Math.random()|0}`,t.defaultStyle={fontStyle:null,fontWeight:300,fontVariant:null,color:"#fff",fontSize:24,fontFamily:"Arial",strokeWidth:1,strokeColor:"#888",shadowBlur:5,textAlign:"start",shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0,fill:!0},e.addStyle(`.${t.randomText}_fullfill{top:0;left:0;width:100%;height:100%;position:absolute;}`),i(t,"rendererMode",{configurable:!0}),i(t,"activeRendererMode",{configurable:!0,value:null});const n=t.container=document.createElement("div");n.classList.add(`${t.randomText}_fullfill`),e.container.appendChild(n),t.text2d=new s.default(t),t.text3d=new c.default(t),t.textCanvas=new l.default(t),t.textCanvasContainer.hidden=t.canvas.hidden=t.canvas3d.hidden=!0,t.modes={1:t.textCanvas,2:t.text2d,3:t.text3d},t.GraphCache=[],t.DanmakuText=[],t.renderingDanmakuManager=new m(t),t.cacheCleanTime=0,t.danmakuMoveTime=0,t.danmakuCheckTime=0,t.danmakuCheckSwitch=!0,t.options={allowLines:!1,screenLimit:0,clearWhenTimeReset:!0,speed:6.5,autoShiftRenderingMode:!0},r(document,{visibilitychange:e=>{t.danmakuCheckSwitch=!document.hidden;document.hidden||t.recheckIndexMark()}}),t._checkNewDanmaku=t._checkNewDanmaku.bind(t),t._cleanCache=t._cleanCache.bind(t),setInterval(t._cleanCache,5e3),t.setRendererMode(1)}setRendererMode(e){const t=this;return!!(t.rendererMode!==e&&e in t.modes&&t.modes[e].supported)&&(t.activeRendererMode&&t.activeRendererMode.disable(),i(t,"activeRendererMode",{value:t.modes[e]}),i(t,"rendererMode",{value:e}),t.activeRendererMode.resize(),t.activeRendererMode.enable(),console.log("rendererMode:",t.rendererMode),!0)}media(e){const t=this;r(e,{seeked:()=>{t.time();t.paused&&t.start();t._clearScreen(!0)},seeking:()=>t.pause(),stalled:()=>t.pause()})}start(){this.paused=!1,this.recheckIndexMark(),this.activeRendererMode.start()}pause(){this.paused=!0,this.activeRendererMode.pause()}load(e){if(!e||"text"!==e._)return!1;if("string"!=typeof e.text)return console.error("wrong danmaku object:",e),!1;let t,i=(e.time,this.list);return t=n(i,e.time,0,i.length-1,!1),i.splice(t,0,e),t<this.indexMark&&this.indexMark++,"object"!=typeof e.style&&(e.style={}),e.style.fontSize=e.style.fontSize?e.style.fontSize+.5|0:this.defaultStyle.fontSize,(isNaN(e.style.fontSize)||e.style.fontSize===1/0||0===e.style.fontSize)&&(e.style.fontSize=this.defaultStyle.fontSize),"number"!=typeof e.mode&&(e.mode=0),e}loadList(e){e.forEach(e=>this.load(e))}unload(e){if(!e||"text"!==e._)return!1;const t=this,n=t.list.indexOf(e);return!(n<0)&&(t.list.splice(n,1),n<t.indexMark&&t.indexMark--,!0)}_checkNewDanmaku(){let e,t=this,n=t.frame.time;if(t.danmakuCheckTime!==n&&t.danmakuCheckSwitch){if(t.list.length)for(;t.indexMark<t.list.length&&(e=t.list[t.indexMark])&&e.time<=n;t.indexMark++)t.options.screenLimit>0&&t.DanmakuText.length>=t.options.screenLimit||t._addNewDanmaku(e);t.danmakuCheckTime=n}}_addNewDanmaku(e){const t=this,n=t.height,i=t.width;let a=t.GraphCache.length?t.GraphCache.shift():new d;a.danmaku=e,a.drawn=!1,a.text=t.options.allowLines?e.text:e.text.replace(/\n/g," "),a.time=e.time,a.font=Object.create(t.defaultStyle),Object.assign(a.font,e.style),a.font.lineHeight||(a.font.lineHeight=a.font.fontSize+2||1),e.style.color&&a.font.color&&"#"!==a.font.color[0]&&(a.font.color="#"+e.style.color),e.mode>1&&(a.font.textAlign="center"),a.prepare(3!==t.rendererMode);const r=t.tunnel.getTunnel(a,n);let o=(r<0?0:r)%n;switch(e.mode){case 0:case 1:case 3:a.style.y=o;break;case 2:a.style.y=n-o-a.style.height-1}switch(e.mode){case 0:a.style.x=i;break;case 1:a.style.x=-a.style.width;break;case 2:case 3:a.style.x=(i-a.style.width)/2}t.renderingDanmakuManager.add(a),t.activeRendererMode.newDanmaku(a)}_calcSideDanmakuPosition(e,t=this.frame.time){let n=!e.danmaku.mode,i=e.style;return(n?this.frame.width:-i.width)+(n?-1:1)*this.frame.rate*(i.width+1024)*(t-e.time)*this.options.speed/6e4}_calcDanmakusPosition(e){let t=this,n=t.frame.time;if(!t.paused||e){const e=t.width,i=t.frame.rate;let a,r,o,s,u;for(t.danmakuMoveTime=n,r=t.DanmakuText.length;r--;)if(o=t.DanmakuText[r],o.time>n)t.removeText(o);else switch(s=o.style,o.danmaku.mode){case 0:case 1:if(a=!o.danmaku.mode,s.x=u=t._calcSideDanmakuPosition(o,n),o.tunnelNumber>=0&&(a&&u+s.width+10<e||!a&&u>10))t.tunnel.removeMark(o);else if(a&&u<-s.width-20||!a&&u>e+s.width+20){t.removeText(o);continue}break;case 2:case 3:n-o.time>1e3*t.options.speed/i&&t.removeText(o)}}}_cleanCache(e){const t=this,n=Date.now();if(t.GraphCache.length>30||e)for(let i=0;i<t.GraphCache.length&&(e||n-t.GraphCache[i].removeTime>1e4);i++)t.activeRendererMode.deleteTextObject(t.GraphCache[i]),t.GraphCache.splice(i,1)}draw(e){!e&&this.paused||!this.enabled||(this._calcDanmakusPosition(e),this.activeRendererMode.draw(e),requestAnimationFrame(this._checkNewDanmaku))}removeText(e){this.renderingDanmakuManager.remove(e),this.tunnel.removeMark(e),e._bitmap=e.danmaku=null,e.removeTime=Date.now(),this.GraphCache.push(e),this.activeRendererMode.remove(e)}resize(){this.activeRendererMode&&this.activeRendererMode.resize(),this.draw(!0)}_clearScreen(e){this.activeRendererMode&&this.activeRendererMode.clear(e)}clear(){for(let e,t=this.DanmakuText.length;t--;)e=this.DanmakuText[t],e.danmaku&&this.removeText(e);this.tunnel.reset(),this._clearScreen(!0)}recheckIndexMark(e=this.frame.time){this.indexMark=n(this.list,e,0,this.list.length-1,!0)}rate(e){this.activeRendererMode&&this.activeRendererMode.rate(e)}time(e=this.frame.time){this.recheckIndexMark(e),this.options.clearWhenTimeReset?this.clear():this.resetTimeOfDanmakuOnScreen()}resetTimeOfDanmakuOnScreen(e){void 0===e&&(e=this.frame.time),this.DanmakuText.forEach(t=>{if(!t.danmaku)return;t.time=e-(this.danmakuMoveTime-t.time)})}danmakuAt(e,t){const n=[];return this.enabled?(this.DanmakuText.forEach(i=>{if(!i.danmaku)return;i.style.x<=e&&i.style.x+i.style.width>=e&&i.style.y<=t&&i.style.y+i.style.height>=t&&n.push(i.danmaku)}),n):n}enable(){this.textCanvasContainer.hidden=!1,this.frame.working&&this.start()}disable(){this.textCanvasContainer.hidden=!0,this.pause(),this.clear()}set useImageBitmap(e){o="function"==typeof createImageBitmap&&e}get useImageBitmap(){return o}get width(){return this.frame.width}get height(){return this.frame.height}}class d{constructor(e=""){const t=this;t._fontString="",t._renderList=null,t.style={},t.font={},t.text=e,t._renderToCache=t._renderToCache.bind(t),i(t,"_cache",{configurable:!0})}prepare(e=!1){const t=this;t._cache||i(t,"_cache",{value:document.createElement("canvas")});let n=[];t.font.fontStyle&&n.push(t.font.fontStyle),t.font.fontVariant&&n.push(t.font.fontVariant),t.font.fontWeight&&n.push(t.font.fontWeight),n.push(`${t.font.fontSize}px`),t.font.fontFamily&&n.push(t.font.fontFamily),t._fontString=n.join(" ");const r=t._cache,o=r.ctx2d||(r.ctx2d=r.getContext("2d"));o.font=t._fontString,t._renderList=t.text.split(/\n/g),t.estimatePadding=Math.max(t.font.shadowBlur+5+Math.max(Math.abs(t.font.shadowOffsetY),Math.abs(t.font.shadowOffsetX)),t.font.strokeWidth+3);let s,u=0,c="number"==typeof t.font.lineHeight?t.font.lineHeight:t.font.fontSize;for(let e=t._renderList.length;e--;)(s=o.measureText(t._renderList[e]).width)>u&&(u=s);r.width=(t.style.width=u)+2*t.estimatePadding,r.height=(t.style.height=t._renderList.length*c)+(c<t.font.fontSize?2*t.font.fontSize:0)+2*t.estimatePadding,o.translate(t.estimatePadding,t.estimatePadding),e?a(t._renderToCache):t._renderToCache()}_renderToCache(){const e=this;e.danmaku&&(e.render(e._cache.ctx2d),o&&(e._bitmap&&(e._bitmap.close(),e._bitmap=null),createImageBitmap(e._cache).then(t=>{e._bitmap=t})))}render(e){const t=this;if(t._renderList){e.save(),t.danmaku.highlight&&(e.fillStyle="rgba(255,255,255,0.3)",e.beginPath(),e.rect(0,0,t.style.width,t.style.height),e.fill()),e.font=t._fontString,e.textBaseline="middle",e.lineWidth=t.font.strokeWidth,e.fillStyle=t.font.color,e.strokeStyle=t.font.strokeColor,e.shadowBlur=t.font.shadowBlur,e.shadowColor=t.font.shadowColor,e.shadowOffsetX=t.font.shadowOffsetX,e.shadowOffsetY=t.font.shadowOffsetY,e.textAlign=t.font.textAlign;let n,i="number"==typeof t.font.lineHeight?t.font.lineHeight:t.font.fontSize;switch(t.font.textAlign){case"left":case"start":n=0;break;case"center":n=t.style.width/2;break;case"right":case"end":n=t.style.width}for(let a=t._renderList.length;a--;)t.font.strokeWidth&&e.strokeText(t._renderList[a],n,i*(a+.5)),t.font.fill&&e.fillText(t._renderList[a],n,i*(a+.5));e.restore()}}}class h{constructor(){this.reset()}reset(){this.right={},this.left={},this.bottom={},this.top={}}getTunnel(e,t){let n=this.tunnel(e.danmaku.mode),i=e.style.height,a=0,r=-1;if(("number"!=typeof i||i<=0)&&(console.error("Incorrect size:"+i),i=24),i>t)return 0;for(;r<0;)for(let e=a+i-1;a<=e;){if(n[a]){a+=n[a].tunnelHeight;break}if(0!==a&&a%(t-1)==0){a++;break}if(a===e){r=a-i+1;break}a++}return e.tunnelNumber=r,e.tunnelHeight=e.style.y+i>t?1:i,this.addMark(e),r}addMark(e){let t=this.tunnel(e.danmaku.mode);t[e.tunnelNumber]||(t[e.tunnelNumber]=e)}removeMark(e){let t,n=e.tunnelNumber;n>=0&&(t=this.tunnel(e.danmaku.mode))[n]===e&&(delete t[n],e.tunnelNumber=-1)}tunnel(e){return this[f[e]]}}const f=["right","left","bottom","top"];class m{constructor(e){this.dText=e,this.totalArea=0,this.limitArea=1/0,e.text2d.supported&&(this.timer=setInterval(()=>this.rendererModeCheck(),1500))}add(e){this.dText.DanmakuText.push(e),this.totalArea+=e._cache.width*e._cache.height}remove(e){let t=this.dText.DanmakuText.indexOf(e);t>=0&&(this.dText.DanmakuText.splice(t,1),this.totalArea-=e._cache.width*e._cache.height)}rendererModeCheck(){let e=this.dText;this.dText.options.autoShiftRenderingMode&&!e.paused&&(e.frame.fpsRec<.95*(e.frame.fps||60)?this.limitArea>this.totalArea&&(this.limitArea=this.totalArea):this.limitArea<this.totalArea&&(this.limitArea=this.totalArea),1==e.rendererMode&&this.totalArea>this.limitArea?e.text2d.supported&&e.setRendererMode(2):2==e.rendererMode&&this.totalArea<.5*this.limitArea&&e.textCanvas.supported&&e.setRendererMode(1))}}e.addModule("TextDanmaku",u)}function r(e,t={}){for(let n in t)n.split(/\,/g).forEach(i=>e.addEventListener(i,t[n]))}Object.defineProperty(n,"__esModule",{value:!0}),e("../lib/setImmediate/setImmediate.js");var o=e("./text2d.js"),s=i(o),u=e("./text3d.js"),c=i(u),d=e("./textCanvas.js"),l=i(d);n.default=a},{"../lib/setImmediate/setImmediate.js":5,"./text2d.js":7,"./text3d.js":8,"./textCanvas.js":9}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./textModuleTemplate.js"),a=function(e){return e&&e.__esModule?e:{default:e}}(i);class r extends a.default{constructor(e){if(super(e),this.supported=!1,e.canvas=document.createElement("canvas"),e.context2d=e.canvas.getContext("2d"),!e.context2d)return void console.warn("text 2d not supported");e.canvas.classList.add(`${e.randomText}_fullfill`),e.canvas.id=`${e.randomText}_text2d`,e.container.appendChild(e.canvas),this.supported=!0}draw(e){let t,n,i,a,r=this.dText.context2d,o=r.canvas.width,s=this.dText.DanmakuText,u=s.length;const c=this.dText.useImageBitmap;for(r.globalCompositeOperation="destination-over",this.clear(e);u--;)(t=s[u]).drawn||(t.drawn=!0),n=t.style.x-t.estimatePadding,i=n+t._cache.width,n>o||i<0||(!c&&o>=t._cache.width?r.drawImage(t._bitmap||t._cache,n,t.style.y-t.estimatePadding):(a=t._cache.width+(n<0?n:0)-(i>o?i-o:0),r.drawImage(t._bitmap||t._cache,n<0?-n:0,0,a,t._cache.height,n<0?0:n,t.style.y-t.estimatePadding,a,t._cache.height)))}clear(e){const t=this.dText;if(e||this._evaluateIfFullClearMode())return void t.context2d.clearRect(0,0,t.canvas.width,t.canvas.height);for(let e,n=t.DanmakuText.length;n--;)e=t.DanmakuText[n],e.drawn&&t.context2d.clearRect(e.style.x-e.estimatePadding,e.style.y-e.estimatePadding,e._cache.width,e._cache.height)}_evaluateIfFullClearMode(){if(this.dText.DanmakuText.length>3)return!0;let e=this.dText.GraphCache[this.dText.GraphCache.length-1];return!(!e||!e.drawn)&&(e.drawn=!1,!0)}resize(){let e=this.dText,t=e.canvas;t.width=e.width,t.height=e.height}enable(){this.draw(),this.dText.useImageBitmap=!(this.dText.canvas.hidden=!1)}disable(){this.dText.canvas.hidden=!0,this.clear(!0)}}n.default=r},{"./textModuleTemplate.js":10}],8:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../lib/Mat/Mat.js"),r=i(a),o=e("./textModuleTemplate.js"),s=i(o);const u=window.requestIdleCallback||setImmediate;class c extends s.default{constructor(e){function t(e){var t=i.createShader(a[e][0]);if(i.shaderSource(t,a[e][1]),i.compileShader(t),!i.getShaderParameter(t,i.COMPILE_STATUS))throw"An error occurred compiling the shaders: "+i.getShaderInfoLog(t);return t}super(e),this.supported=!1;let n=this.c3d=e.canvas3d=document.createElement("canvas");if(n.classList.add(`${e.randomText}_fullfill`),n.id=`${e.randomText}_text3d`,e.context3d=n.getContext("webgl")||n.getContext("experimental-webgl"),!e.context3d)return void console.warn("text 3d not supported");e.container.appendChild(n);const i=this.gl=e.context3d;var a={danmakuFrag:[i.FRAGMENT_SHADER,`
\t\t\t\t#pragma optimize(on)
\t\t\t\tprecision lowp float;
\t\t\t\tvarying lowp vec2 vDanmakuTexCoord;
\t\t\t\tuniform sampler2D uSampler;
\t\t\t\tvoid main(void) {
\t\t\t\t\tvec4 co=texture2D(uSampler,vDanmakuTexCoord);
\t\t\t\t\tif(co.a == 0.0)discard;
\t\t\t\t\tgl_FragColor = co;
\t\t\t\t}`],danmakuVert:[i.VERTEX_SHADER,`
\t\t\t\t#pragma optimize(on)
\t\t\t\tattribute vec2 aVertexPosition;
\t\t\t\tattribute vec2 aDanmakuTexCoord;
\t\t\t\tuniform mat4 u2dCoordinate;
\t\t\t\tvarying lowp vec2 vDanmakuTexCoord;
\t\t\t\tvoid main(void) {
\t\t\t\t\tgl_Position = u2dCoordinate * vec4(aVertexPosition,0,1);
\t\t\t\t\tvDanmakuTexCoord = aDanmakuTexCoord;
\t\t\t\t}`]},r=t("danmakuFrag"),o=t("danmakuVert"),s=this.shaderProgram=i.createProgram();if(i.attachShader(s,o),i.attachShader(s,r),i.linkProgram(s),!i.getProgramParameter(s,i.LINK_STATUS))return void console.error("Unable to initialize the shader program.");i.useProgram(s),i.clearColor(0,0,0,0),i.enable(i.BLEND),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA),this.maxTexSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.uSampler=i.getUniformLocation(s,"uSampler"),this.u2dCoord=i.getUniformLocation(s,"u2dCoordinate"),this.aVertexPosition=i.getAttribLocation(s,"aVertexPosition"),this.atextureCoord=i.getAttribLocation(s,"aDanmakuTexCoord"),i.enableVertexAttribArray(this.aVertexPosition),i.enableVertexAttribArray(this.atextureCoord),this.commonTexCoordBuffer=i.createBuffer(),this.commonVertCoordBuffer=i.createBuffer(),i.activeTexture(i.TEXTURE0),i.uniform1i(this.uSampler,0),this.supported=!0}draw(e){const t=this.gl,n=this.dText.DanmakuText.length;let i,a,r,o=this.c3d.width;for(let e,s=0;s<n;s++)(e=this.dText.DanmakuText[s])&&e.glDanmaku&&(i=e.style.x-e.estimatePadding,a=i+e._cache.width,r=e._cache.width+(i<0?i:0)-(a>o?a-o:0),i>o||a<0||(e.vertCoord[0]=e.vertCoord[4]=i<0?0:i,e.vertCoord[2]=e.vertCoord[6]=e.vertCoord[0]+r,t.bindBuffer(t.ARRAY_BUFFER,this.commonVertCoordBuffer),t.bufferData(t.ARRAY_BUFFER,e.vertCoord,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.aVertexPosition,2,t.FLOAT,!1,0,0),d[0]=d[4]=i<0?-i/e._cache.width:0,d[2]=d[6]=d[0]+r/e._cache.width,t.bindBuffer(t.ARRAY_BUFFER,this.commonTexCoordBuffer),t.bufferData(t.ARRAY_BUFFER,d,t.DYNAMIC_DRAW),t.vertexAttribPointer(this.atextureCoord,2,t.FLOAT,!1,0,0),t.bindTexture(t.TEXTURE_2D,e.texture),t.drawArrays(t.TRIANGLE_STRIP,0,4)));t.flush()}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}deleteTextObject(e){const t=this.gl;e.texture&&t.deleteTexture(e.texture)}resize(e,t){const n=this.gl,i=this.c3d;i.width=this.dText.width,i.height=this.dText.height,n.viewport(0,0,i.width,i.height),n.uniformMatrix4fv(this.u2dCoord,!1,r.default.Identity(4).translate3d(-1,1,0).scale3d(2/i.width,-2/i.height,0).array)}enable(){this.dText.DanmakuText.forEach(e=>{this.newDanmaku(e,!1)}),this.dText.useImageBitmap=this.c3d.hidden=!1,requestAnimationFrame(()=>this.draw())}disable(){this.clear(),this.c3d.hidden=!0}newDanmaku(e,t=!0){const n=this.gl;if(e.glDanmaku=!1,e._cache.height>this.maxTexSize||e._cache.width>this.maxTexSize)return void console.warn("Ignore a danmaku width too large size",e.danmaku);let i;(i=e.texture)||(i=e.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),t?u(()=>{n.bindTexture(n.TEXTURE_2D,i);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e._cache);e.glDanmaku=!0}):(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e._cache),e.glDanmaku=!0);let a=e.style.y-e.estimatePadding;e.vertCoord=new Float32Array([0,a,0,a,0,a+e._cache.height,0,a+e._cache.height])}}const d=new Float32Array([0,0,1,0,0,1,1,1]);n.default=c},{"../lib/Mat/Mat.js":4,"./textModuleTemplate.js":10}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./textModuleTemplate.js"),a=function(e){return e&&e.__esModule?e:{default:e}}(i);class r extends a.default{constructor(e){super(e),this.supported=e.text2d.supported,this.supported&&(e.frame.addStyle([`#${e.randomText}_textCanvasContainer canvas{will-change:transform;top:0;left:0;position:absolute;}`,`#${e.randomText}_textCanvasContainer.moving canvas{transition:transform 500s linear;}`,`#${e.randomText}_textCanvasContainer{will-change:transform;pointer-events:none;overflow:hidden;}`]),this.container=e.textCanvasContainer=document.createElement("div"),this.container.classList.add(`${e.randomText}_fullfill`),this.container.id=`${e.randomText}_textCanvasContainer`,e.container.appendChild(this.container))}_toggle(e){let t=this.dText,n=t.frame.time;this.container.classList[e?"add":"remove"]("moving");for(let i,a=t.DanmakuText.length;a--;)(i=t.DanmakuText[a]).danmaku.mode>=2||(e?requestAnimationFrame(()=>this._move(i)):this._move(i,n))}pause(){this._toggle(!1)}start(){this._toggle(!0)}rate(){this.resetPos()}_move(e,t){e.danmaku&&(void 0===t&&(t=this.dText.frame.time+5e5),e._cache.style.transform=`translate3d(${(10*(this.dText._calcSideDanmakuPosition(e,t)-e.estimatePadding)|0)/10}px,${e.style.y-e.estimatePadding}px,0)`)}resetPos(){this.pause(),this.dText.paused||requestAnimationFrame(()=>this.start())}resize(){this.resetPos()}remove(e){e._cache.parentNode&&this.container.removeChild(e._cache)}enable(){this.dText.DanmakuText.forEach(e=>this.newDanmaku(e)),this.container.hidden=!1}disable(){this.container.hidden=!0,this.container.innerHTML=""}newDanmaku(e){e._cache.style.transform=`translate3d(${e.style.x-e.estimatePadding}px,${e.style.y-e.estimatePadding}px,0)`,this.container.appendChild(e._cache),e.danmaku.mode<2&&!this.dText.paused&&requestAnimationFrame(()=>this._move(e))}}n.default=r},{"./textModuleTemplate.js":10}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i{constructor(e){this.dText=e}draw(){}rate(){}pause(){}start(){}clear(){}resize(){}remove(){}enable(){}disable(){}newDanmaku(){}deleteTextObject(){}}n.default=i},{}],11:[function(e,t,n){function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function r(e){if(l===setTimeout)return setTimeout(e,0);if((l===i||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function o(e){if(h===clearTimeout)return clearTimeout(e);if((h===a||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function s(){p&&m&&(p=!1,m.length?g=m.concat(g):y=-1,g.length&&u())}function u(){if(!p){var e=r(s);p=!0;for(var t=g.length;t;){for(m=g,g=[];++y<t;)m&&m[y].run();y=-1,t=g.length}m=null,p=!1,o(e)}}function c(e,t){this.fun=e,this.array=t}function d(){}var l,h,f=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:i}catch(e){l=i}try{h="function"==typeof clearTimeout?clearTimeout:a}catch(e){h=a}}();var m,g=[],p=!1,y=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];g.push(new c(e,t)),1!==g.length||p||r(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=d,f.addListener=d,f.once=d,f.off=d,f.removeListener=d,f.removeAllListeners=d,f.emit=d,f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],12:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){Array.isArray(e)||(e=[e]);for(let n in t)n.split(/\,/g).forEach(function(i){e.forEach(function(e){e.addEventListener(i,t[n])})})}function r(e){try{(e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen).call(e)}catch(e){console.error(e),alert(x("Failed to change to fullscreen mode"))}}function o(){const e=document;(e.exitFullscreen||e.msExitFullscreen||e.mozCancelFullScreen||e.webkitCancelFullScreen).call(e)}function s(){const e=document;return!!(e.fullscreen||e.mozFullScreen||e.webkitIsFullScreen||e.msFullscreenElement)}function u(e,t){let n,i=0|e,a=i/3600|0;return t>=3600&&(i%=3600),n=[c(i/60|0),c(i%60)],t>=3600&&n.unshift(a),n.join(":")}function c(e){return e>9&&e||`0${e}`}function d(e,t){for(let n in t)e.setAttribute(n,t[n])}function l(e,t,n){return e<t?t:e>n?n:e}function h(e,t){return e+Math.random()*(t-e)+.5|0}function f(e){return e instanceof Array?e.slice():void 0!==e.length?Array.prototype.slice.call(e):[...e]}Object.defineProperty(n,"__esModule",{value:!0}),n.toArray=n.limitIn=n.setAttrs=n.padTime=n.rand=n.formatTime=n.isFullscreen=n.exitFullscreen=n.requestFullscreen=n.addEvents=n.NyaPlayerCore=void 0;var m=e("./i18n.js"),g=e("./danmaku.js"),p=i(g),y=e("../lib/Object2HTML/Object2HTML.js"),v=i(y);const x=m.i18n._;window.Object2HTML=v.default;const T={muted:!1,volume:1,loop:!1,defaultDanmakuColor:null,defaultDanmakuMode:0,defaultDanmakuSize:24,danmakuSend:(e,t)=>{t(!1)},textStyle:{},danmakuOption:{}};class w{constructor(){this._events={}}emit(e,...t){this._resolve(e,...t),this.globalHandle(e,...t)}_resolve(e,...t){if(e in this._events){const n=this._events[e];try{n.forEach(e=>{e.apply(this,t)})}catch(e){console.error(e)}}}on(e,t){t instanceof Function&&(e in this._events||(this._events[e]=[]),this._events[e].push(t))}removeEvent(e,t){if(e in this._events){if(1===arguments.length)return void delete this._events[e];let n;(n=this._events[e].indexOf(t)>=0)&&this._events[e].splice(n,1),0===this._events[e].length&&delete this._events[e]}}globalHandle(e,...t){}}class _ extends w{constructor(e){super(),e=this.opt=Object.assign({},T,e);const t=this.$={document:document,window:window};this._={},this._.video=(0,v.default)({_:"video",attr:{id:"main_video"}}),this.container=(0,v.default)({_:"div",prop:{id:"danmaku_container"}}),this.videoFrame=(0,v.default)({_:"div",attr:{id:"video_frame"},child:[this.video,this.container,{_:"div",attr:{id:"loading_frame"},child:[{_:"div",attr:{id:"loading_anime"},child:["(๑•́ ω •̀๑)"]},{_:"div",attr:{id:"loading_info"}}]}]}),this.collectEles(this.videoFrame),this.loadingInfo(x("Loading danmaku frame")),this.Danmaku=new p.default(this),this._.loadingAnimeInterval=setInterval(()=>{t.loading_anime.style.transform="translate("+h(-20,20)+"px,"+h(-20,20)+"px) rotate("+h(-10,10)+"deg)"},80),setTimeout(t=>{["src","muted","volume","loop"].forEach(t=>{void 0!==e[t]&&(this.video[t]=e[t])})},0);{let e=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"loop");Object.defineProperty(this.video,"loop",{get:e.get,set:function(t){t!==this.loop&&(this.dispatchEvent(Object.assign(new Event("_loopChange"),{value:t})),e.set.call(this,t))}})}a(this.video,{loadedmetadata:e=>{clearInterval(this._.loadingAnimeInterval);t.loading_frame.parentNode.removeChild(t.loading_frame)},error:e=>{clearInterval(this._.loadingAnimeInterval);loading_anime.style.transform="";loading_anime.innerHTML="(๑• . •๑)"}}),this.emit("coreLoad")}playToggle(e=this.video.paused){this.video[e?"play":"pause"]()}loadingInfo(e){this.$.loading_info.appendChild((0,v.default)({_:"div",child:[e]}))}collectEles(e){const t=this.$;e.id&&!t[e.id]&&(t[e.id]=e),f(e.querySelectorAll("*")).forEach(e=>{e.id&&!t[e.id]&&(t[e.id]=e)})}get danmakuFrame(){return this.Danmaku.danmakuFrame}get player(){return this._.player}get video(){return this._.video}get src(){return this.video.src}set src(e){this.video.src=e}get TextDanmaku(){return this.danmakuFrame.modules.TextDanmaku}get videoSize(){return[this.video.videoWidth,this.video.videoHeight]}}String.prototype.startsWith||(String.prototype.startsWith=function(e,t=0){return this.substr(t,e.length)===e}),Object.assign||(Object.assign=function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var a=arguments[i];if(null!=a)for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(n[r]=a[r])}return n}),Array.from||(Array.from=function(e,t){e instanceof Array||(e=f(e));for(var n=new Array(e.length),i=e.length;i--;)n[i]=t?t(e[i],i):e[i];return n}),Number.isInteger||(Number.isInteger=function(e){return(0|e)===e}),n.default=_,n.NyaPlayerCore=_,n.addEvents=a,n.requestFullscreen=r,n.exitFullscreen=o,n.isFullscreen=s,n.formatTime=u,n.rand=h,n.padTime=c,n.setAttrs=d,n.limitIn=l,n.toArray=f},{"../lib/Object2HTML/Object2HTML.js":1,"./danmaku.js":14,"./i18n.js":15}],13:[function(e,t,n){"use strict";function i(e,t,n,i){return Math.sqrt((e-n)*(e-n)+(t-i)*(t-i))}var a=e("./i18n.js"),r=e("../lib/Object2HTML/Object2HTML.js"),o=function(e){return e&&e.__esModule?e:{default:e}}(r),s=e("./NyaPCore.js");const u=a.i18n._,c={danmakuColors:["fff","6cf","ff0","f00","0f0","00f","f0f","000"],danmakuModes:[0,3,2,1],danmakuSizes:[20,24,36],dragToSeek:!0,dragToChangeVolume:!0};class d extends s.NyaPlayerCore{constructor(e){super(Object.assign({},c,e)),e=this.opt;const t=this,n=t.$,i=t.video;t.loadingInfo(u("Creating player")),t._.player=(0,r.Object2HTML)({_:"div",attr:{class:"NyaPTouch",id:"NyaPTouch"},child:[t.videoFrame,{_:"div",attr:{id:"controls"},child:[]},{_:"div",attr:{id:"msg_box"}}]}),t.collectEles(t._.player),Object.assign(t._,{currentDragMode:null,touchStartPoint:[0,0]}),f.touchdrag(n.main_video,{allowMultiTouch:!1,preventDefaultX:!0});const a={main_video:{click:e=>{e.preventDefault();t.playToggle()},touchstart:e=>{let n=e.changedTouches[0];if(t._.currentDragMode)return;t._.touchStartPoint=[n.clientX,n.clientY]},touchdrag:n=>{t._.currentDragMode||e.dragToSeek&&Math.abs(n.deltaX)>Math.abs(n.deltaY)&&(t._.currentDragMode="seek",t._.seekTo=i.currentTime);switch(t._.currentDragMode){case"volume":i.volume=(0,s.limitIn)(i.volume-n.deltaY/200,0,1);break;case"seek":{let e=Math.pow(1.016,Math.abs(n.touches[0].clientY-t._.touchStartPoint[1]));t._.seekTo=(0,s.limitIn)(t._.seekTo+n.deltaX/200*e,0,i.duration),t.emit("seekMark",t._.seekTo);break}}},touchend:e=>{"seek"===t._.currentDragMode&&(i.currentTime=t._.seekTo);t._.currentDragMode=null},contextmenu:n=>{n.preventDefault();if(!e.dragToChangeVolume)return;t._.currentDragMode="volume"}}};for(let e in n){let t=a[e];t&&(0,s.addEvents)(n[e],t)}e.playerFrame instanceof HTMLElement&&e.playerFrame.appendChild(t.player)}danmakuInput(){}playerMode(e="normal"){}send(){}msg(e,t="tip"){let n=new l(e,t);this.$.msg_box.appendChild(n.msg),requestAnimationFrame(()=>n.show())}}class l{constructor(e,t){this.using=!1,(this.msg=(0,o.default)({_:"div",attr:{class:`msg_type_${t}`},child:[e]})).addEventListener("click",()=>this.remove()),e instanceof HTMLElement&&(e=e.textContent);let n=String(e).match(/\w+|\S/g);this.timeout=setTimeout(()=>this.remove(),Math.max(.6*(n?n.length:0)*1e3,5e3))}show(){this.msg.style.opacity=0,setTimeout(()=>{this.using=!0;this.msg.style.opacity=1},0)}remove(){this.using&&(this.using=!1,this.msg.style.opacity=0,this.timeout&&(clearTimeout(this.timeout),this.timeout=0),setTimeout(()=>{this.msg.parentNode.removeChild(this.msg)},600))}}var h={touchdrag:{preventDefault:!1,preventDefaultX:!1,preventDefaultY:!1,allowMultiTouch:!1},doubletouch:{preventDefault:!0}},f={touchdrag:function(e,t){let n={};t=Object.assign({},h.touchdrag,t),e.addEventListener("touchstart",function(e){if(!t.allowMultiTouch&&e.changedTouches.length>1)return void(n={});let i=e.changedTouches;for(let e=i.length;e--;)n[i[e].identifier]=[i[e].clientX,i[e].clientY]}),e.addEventListener("touchmove",function(i){if(t.allowMultiTouch||!(i.touches.length>1)){let a=i.changedTouches;for(let r=a.length;r--;){let o=a[r].identifier;if(!(!o in n)){let s=new TouchEvent("touchdrag",i);s.deltaX=a[r].clientX-n[o][0],s.deltaY=a[r].clientY-n[o][1],n[o]=[a[r].clientX,a[r].clientY],(t.preventDefault||t.preventDefaultX&&Math.abs(s.deltaX)>Math.abs(s.deltaY)||t.preventDefaultY&&Math.abs(s.deltaX)<Math.abs(s.deltaY))&&i.preventDefault(),e.dispatchEvent(s)}}}})},doubletouch:function(e,t){let n=[],a=0,r=!1,o=!1,u=!1;return t=Object.assign({},h.doubletouch,t),e.addEventListener("touchstart",function(c){let d=c.touches.length>1?(0,s.toArray)(c.touches):[c.touches[0]],l=n;if(n=d,u){if(c.timeStamp-a>400)return void(u=!1)}else a=c.timeStamp,u=!0;if(d.length===l.length&&o){let n=[];for(let e=d.length;e--;)n.push([l[e].clientX,l[e].clientY]);for(let e=d.length;e--;)for(let t=n.length;t--;)i(d[e].clientX,d[e].clientY,n[t][0],n[t][1])<=6&&n.splice(t,1);if(0===n.length){t.preventDefault&&c.preventDefault();let n=new TouchEvent("doubletouch",c);n.points=d.length,e.dispatchEvent(n),u=o=!1,r=!0}}}),e.addEventListener("touchend",function(e){0!==e.touches.length||r||(o=!0),r=!1}),listeners}};window.NyaPTouch=d},{"../lib/Object2HTML/Object2HTML.js":1,"./NyaPCore.js":12,"./i18n.js":15}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../lib/danmaku-frame/src/danmaku-frame.js"),a=e("../lib/danmaku-text/src/danmaku-text.js");(0,function(e){return e&&e.__esModule?e:{default:e}}(a).default)(i.DanmakuFrame,i.DanmakuFrameModule);const r=["color","text","size","mode","time"];class o{constructor(e){this.core=e,this.danmakuFrame=new i.DanmakuFrame(e.container),this.danmakuFrame.setMedia(e.video),this.danmakuFrame.enable("TextDanmaku"),this.setTextDanmakuOptions(e.opt.danmakuOption),this.setDefaultTextStyle(e.opt.textStyle)}load(e){return this.danmakuFrame.load(e)}loadList(e){this.danmakuFrame.loadList(e)}remove(e){this.danmakuFrame.unload(e)}toggle(e,t){try{void 0==t&&(t=!this.module(e).enabled),this.danmakuFrame[t?"enable":"disable"](e),this.emit("danmakuToggle",e,this.module(e).enabled)}catch(e){return!1}return!0}at(e,t){return this.module("TextDanmaku").danmakuAt(e,t)}module(e){return this.danmakuFrame.modules[e]}send(e,t){for(let t of r)if(t in e==!1)return!1;return!(e.text||"").match(/^\s*$/)&&(e.color=this.isVaildColor(e.color),e.color?e.color=e.color.replace(/\$/g,()=>"0123456789abcdef"[limitIn(16*Math.random()|0,0,15)]):e.color=null,this.core.opt.danmakuSend instanceof Function&&(this.core.opt.danmakuSend(e,t||(()=>{})),!0))}isVaildColor(e){return"string"==typeof e&&(e=!!e.match(/^#?(([\da-f\$]{3}){1,2})$/i)&&e[1])}setDefaultTextStyle(e){if(e)for(let t in e)this.module("TextDanmaku").defaultStyle[t]=e[t]}setTextDanmakuOptions(e){if(e)for(let t in e)this.module("TextDanmaku").options[t]=e[t]}}n.default=o},{"../lib/danmaku-frame/src/danmaku-frame.js":3,"../lib/danmaku-text/src/danmaku-text.js":6}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i={lang:null,langs:{},_:(e,...t)=>{let n=i.lang&&i.langs[i.lang][e]||e;t.length&&t.forEach((e,t)=>{n=n.replace(`$${t}`,e)});return n}};i.langs["zh-CN"]={play:"播放",Send:"发送",pause:"暂停",muted:"静音",settings:"设置","loop(L)":"循环(L)","hex color":"Hex颜色","full page(P)":"全页模式(P)","Creating player":"创建播放器","full screen(F)":"全屏模式(F)","danmaku toggle(D)":"弹幕开关(D)","Input danmaku here":"在这里输入弹幕","Loading danmaku frame":"加载弹幕框架","danmaku input(Enter)":"弹幕输入框(回车)","volume($0)([shift]+↑↓)":"音量($0)([shift]+↑↓)","Failed to change to fullscreen mode":"无法切换到全屏模式"},navigator.languages||(navigator.languages=[navigator.language||navigator.browserLanguage]);for(let e of[...navigator.languages]){if(i.langs[e]){i.lang=e;break}let t=e.match(/^\w+/)[0];for(let e in i.langs)if(e.startsWith(t)){i.lang=e;break}if(i.lang)break}console.debug("Language:"+i.lang),n.i18n=i},{}]},{},[13]);