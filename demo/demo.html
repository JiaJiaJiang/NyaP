<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>NyaP demo</title>
	<style type="text/css">
		body{margin: 0;display:flex;background-color: #000;align-items: center;height: 100%;justify-content: center;position: absolute;width: 100%;}
	</style>
</head>
<body>
<div id="player_container" style="position:relative;width:920px;height:550px;"></div>

<script>
var touchMode=false,//(window.navigator.userAgent.match(/mobile/)?true:false);
	scriptVer='es2016';
try{
	'use strict';
	[
		'class a{}',//class
		'()=>{}',//lambda
		'{window}',//concise property
		'[...[]]',//expand array
		'let a;const b;',//let const
	].forEach(function(s){eval(s)});
}catch(e){
	scriptVer='es2015';
}
var playerName='NyaP'+(touchMode?"Touch":"");
console.log('load player',playerName,scriptVer);
document.write(
	"<style>@import url('"+"../dist/"+playerName+".css')</style>"+
	"<script src='../dist/"+playerName+"."+scriptVer+".js'><\/script>"
);
</script>

<script>
var tests={
	1:['danmaku.js','//dn-jia-io.qbox.me/video/osu%20Dont%20cry%2020140811%20001526.mp4','osu.mp4'],
	2:['danmaku2.js','//dn-jia-io.qbox.me/video/27107IOSYSTheLovelyFreezingTomboyishBathCirnosHotSpring.mp4','9.mp4'],
	3:['','//dn-jia-io.qbox.me/video/%E5%98%98%E3%81%AE%E7%81%AB%E8%8A%B1.mp4','嘘の火花.mp4']
}

var number=location.hash.match(/\#(\d+)$/);
number=(number)?Number(number[1]):1;

var dm=document.createElement('script');
dm.src=tests[number][0];
document.head.appendChild(dm);

if(!navigator.userAgent.match(/mobile/i)){//normal player

}else{//touch player

}

var NP=new NyaP({
	src:((location.protocol==='file:'))?tests[number][2]:tests[number][1],
	//muted:true,
	volume:0.3,
	danmakuOption:{
		allowLines:true,
		screenLimit:0,
	},
	danmakuSend:function(d,callback){
		console.log(d);
		var d2={_:'text',text:d.text,time:d.time,mode:d.mode,style:{fontSize:d.size},date:Date.now(),id:0};
		if(d.color){
			d2.style.color=d.color;
		}
		callback(d2);
	}
});
document.querySelector('#player_container').appendChild(NP.player);

window.addEventListener('load',function(){
	var danmakus=[],textDM={_:'text'};
	for(var i=0;i<rawDanmakuList.length;i++){
		var item=rawDanmakuList[i];
		item.s=item.s*0.85;
		danmakus.push(Object.assign(Object.create(textDM),{text:item.c,time:item.t,mode:item.ty,style:{fontSize:item.s,color:'#'+(item.co||'fff')},date:item.d,id:item.id}));
	}
	NP.loadDanmakuList(danmakus);
	//NP.text2d.COL.debug.on();
	//NP.video.play()
	//NP.loop(true);
});

clearInterval(NP._.loadingAnimeInterval)
NP.msg('this is a tip')
NP.msg('this is an info','info')
NP.msg('this is an error,and these messages\' time depends on the words\' count','error')

function changeMode(n){
	if(NP.danmakuFrame.modules.TextDanmaku.setRenderMode(n)){
		NP.msg('mode '+n,'info');
	}else{
		NP.msg('the browser does not support this mode or already on this mode.','info');
	}
}
</script>

<div style="position:fixed;top:0;left:0;color:#fff;">本演示发送的弹幕不会提交至服务器，仅本地预览。
<div>
	<button onclick="changeMode(1)">CSS Transition</button>
	<button onclick="changeMode(2)">Canvas2d</button>
	<button onclick="changeMode(3)">WebGL</button>
</div>
</div>

</body>
</html>